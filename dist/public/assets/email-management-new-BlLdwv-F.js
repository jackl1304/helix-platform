import{U as K,r as u,f as W,g as N,h as U,j as e,B as p,l as z,m as O,n as v,H as b,C as n,a as f,b as y,a5 as Q,P as w,c as r,W as k,$,a9 as S,k as G,a8 as J,ar as m,R as F,J as h,I as j}from"./index-Dm22qi9h.js";import{S as V}from"./server-DASeiYJS.js";import{S as M}from"./square-pen-BRq2if-8.js";function se(){var P,E,L;const{t:s}=K(),[c,R]=u.useState(null),[_,X]=u.useState(!1),[d,C]=u.useState(""),[t,x]=u.useState({customerName:"Max Mustermann",companyName:"Beispiel GmbH",subscriptionPlan:"Professional",dashboardUrl:"https://helix-platform.com/dashboard",loginUrl:"https://max-mustermann.helix-platform.com/login",amount:"899",dueDate:"31.08.2025",invoiceUrl:"https://helix-platform.com/invoice/123",alertTitle:"Neue EU MDR Änderung",summary:"Wichtige Aktualisierung der Medical Device Regulation",urgency:"high",updatesCount:"23",legalCasesCount:"8",expiryDate:"20.08.2025",upgradeUrl:"https://helix-platform.com/upgrade",endDate:"31.08.2025"});W();const{data:T=[],isLoading:q}=N({queryKey:["/api/email/providers"]}),{data:A=[],isLoading:B}=N({queryKey:["/api/email/templates"]}),{data:i}=N({queryKey:["/api/email/statistics"]}),g=U({mutationFn:async()=>await F("/api/email/test","POST"),onSuccess:a=>{a.success?m({title:s("email.connectionSuccess"),description:s("email.connectionSuccessDesc")}):m({title:s("email.connectionFailed"),description:a.message||s("email.connectionError")})},onError:()=>{m({title:s("email.testFailed"),description:s("email.testFailedDesc")})}}),o=U({mutationFn:async({templateId:a,email:l})=>await F("/api/email/send","POST",{to:l,templateId:a,variables:t}),onSuccess:()=>{m({title:s("email.testEmailSent"),description:s("email.testEmailSentDesc").replace("{email}",d)}),C("")},onError:()=>{m({title:s("email.sendFailed"),description:s("email.sendFailedDesc")})}}),H=()=>{g.mutate()},D=a=>{if(!d){m({title:s("email.emailRequired"),description:s("email.emailRequiredDesc")});return}o.mutate({templateId:a,email:d})},I=a=>{switch(a){case"active":return e.jsx(h,{className:"bg-green-100 text-green-800",children:s("common.active")});case"error":return e.jsx(h,{className:"bg-red-100 text-red-800",children:s("email.appPasswordRequired")});default:return e.jsx(h,{className:"bg-gray-100 text-gray-800",children:s("common.inactive")})}};return q||B?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:s("email.loading")})]})}):e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:s("email.title")}),e.jsx("p",{className:"text-gray-600",children:s("email.subtitle")})]}),e.jsx(p,{onClick:H,disabled:g.isPending,children:g.isPending?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),s("email.testing")]}):e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),s("email.testConnection")]})})]}),e.jsxs(z,{defaultValue:"providers",className:"space-y-6",children:[e.jsxs(O,{className:"grid w-full grid-cols-3",children:[e.jsx(v,{value:"providers",children:s("email.providers")}),e.jsx(v,{value:"templates",children:s("email.templates")}),e.jsx(v,{value:"statistics",children:s("email.statistics")})]}),e.jsx(b,{value:"providers",className:"space-y-4",children:e.jsxs(n,{children:[e.jsxs(f,{children:[e.jsxs(y,{className:"flex items-center",children:[e.jsx(Q,{className:"w-5 h-5 mr-2"}),s("email.gmailProvider")]}),e.jsx(w,{children:s("email.gmailConfig")})]}),e.jsx(r,{children:T.length>0?e.jsx("div",{className:"space-y-4",children:T.map(a=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:a.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:[a.host,":",a.port]})]}),I(a.status)]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:s("email.user")}),e.jsx("p",{className:"font-medium",children:a.user})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:s("email.dailyLimit")}),e.jsx("p",{className:"font-medium",children:a.dailyLimit.toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:s("email.sentToday")}),e.jsx("p",{className:"font-medium",children:a.usedToday})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:s("email.security")}),e.jsx("p",{className:"font-medium",children:a.secure?"TLS/SSL":"STARTTLS"})]})]}),a.status==="error"&&e.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(k,{className:"w-5 h-5 text-red-600 mr-2 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-red-800",children:s("email.appPasswordRequired")}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:s("email.appPasswordDesc")}),e.jsxs("div",{className:"mt-2 text-sm text-red-700",children:[e.jsx("p",{children:e.jsx("strong",{children:s("email.stepsTitle")})}),e.jsxs("ol",{className:"list-decimal list-inside mt-1 space-y-1",children:[e.jsx("li",{children:s("email.step1")}),e.jsx("li",{children:s("email.step2")}),e.jsx("li",{children:s("email.step3")}),e.jsx("li",{children:s("email.step4")})]})]})]})]})})]},a.id))}):e.jsx("p",{className:"text-gray-600",children:s("email.noProviders")})})]})}),e.jsx(b,{value:"templates",className:"space-y-4",children:e.jsxs(n,{children:[e.jsxs(f,{children:[e.jsxs(y,{className:"flex items-center",children:[e.jsx(M,{className:"w-5 h-5 mr-2"}),s("email.templatesTitle")]}),e.jsx(w,{children:s("email.templatesDesc")})]}),e.jsx(r,{children:e.jsx("div",{className:"space-y-4",children:$(A,a=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:a.name}),e.jsx("p",{className:"text-sm text-gray-600",children:a.subject})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(h,{variant:a.isActive?"default":"secondary",children:a.isActive?s("common.active"):s("common.inactive")}),e.jsx(p,{size:"sm",variant:"outline",onClick:()=>R((c==null?void 0:c.id)===a.id?null:a),children:e.jsx(M,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"text-sm text-gray-600 mb-3",children:[e.jsx("strong",{children:s("email.templateType")})," ",a.type.replace("_"," ")]}),e.jsx("div",{className:"flex flex-wrap gap-1 mb-3",children:a.variables.map(l=>e.jsx(h,{variant:"outline",className:"text-xs",children:`{{${l}}}`},l))}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{placeholder:"test@example.com",value:d,onChange:l=>C(l.target.value),className:"flex-1"}),e.jsx(p,{size:"sm",onClick:()=>D(a.id),disabled:!d||o.isPending,children:o.isPending?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):e.jsx(S,{className:"w-4 h-4"})})]}),(c==null?void 0:c.id)===a.id&&e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:s("email.customerDataTitle")}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("label",{className:"font-medium",children:s("email.customer")}),e.jsx(j,{value:t.customerName,onChange:l=>x({...t,customerName:l.target.value}),className:"text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"font-medium",children:s("email.plan")}),e.jsxs("select",{className:"w-full p-1 border rounded text-sm",value:t.subscriptionPlan,onChange:l=>x({...t,subscriptionPlan:l.target.value}),children:[e.jsx("option",{value:"Starter",children:"Starter (€299)"}),e.jsx("option",{value:"Professional",children:"Professional (€899)"}),e.jsx("option",{value:"Enterprise",children:"Enterprise (€2.499)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"font-medium",children:s("email.dashboardUrl")}),e.jsx(j,{value:t.dashboardUrl,onChange:l=>x({...t,dashboardUrl:l.target.value}),className:"text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"font-medium",children:s("email.loginUrl")}),e.jsx(j,{value:t.loginUrl,onChange:l=>x({...t,loginUrl:l.target.value}),className:"text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"font-medium",children:s("email.amount")}),e.jsx(j,{value:t.amount,onChange:l=>x({...t,amount:l.target.value}),className:"text-sm"})]})]}),e.jsx("div",{className:"mt-3",children:e.jsxs(p,{onClick:()=>D(a.id),disabled:!d||o.isPending,className:"w-full bg-blue-600 hover:bg-blue-700 text-white",children:[o.isPending?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}):e.jsx(S,{className:"w-4 h-4 mr-2"}),s("email.sendWithData")]})})]})]})]},a.id))})})]})}),e.jsxs(b,{value:"statistics",className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(n,{children:e.jsx(r,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(S,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:s("email.totalSent")}),e.jsx("p",{className:"text-2xl font-bold",children:((P=i==null?void 0:i.totalSent)==null?void 0:P.toLocaleString())||"0"})]})]})})}),e.jsx(n,{children:e.jsx(r,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(G,{className:"w-8 h-8 text-green-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:s("email.delivered")}),e.jsx("p",{className:"text-2xl font-bold",children:((E=i==null?void 0:i.totalDelivered)==null?void 0:E.toLocaleString())||"0"})]})]})})}),e.jsx(n,{children:e.jsx(r,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(k,{className:"w-8 h-8 text-red-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:s("email.failed")}),e.jsx("p",{className:"text-2xl font-bold",children:((L=i==null?void 0:i.totalFailed)==null?void 0:L.toLocaleString())||"0"})]})]})})}),e.jsx(n,{children:e.jsx(r,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(J,{className:"w-8 h-8 text-purple-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:s("email.subscribers")}),e.jsx("p",{className:"text-2xl font-bold",children:(i==null?void 0:i.weeklyDigestSubscribers)||"0"})]})]})})})]}),e.jsxs(n,{children:[e.jsxs(f,{children:[e.jsx(y,{children:s("email.overview")}),e.jsx(w,{children:s("email.overviewDesc")})]}),e.jsx(r,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:s("email.sentTodayLabel")}),e.jsx("span",{className:"font-semibold",children:(i==null?void 0:i.dailySent)||0})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:s("email.weeklyDigest")}),e.jsx("span",{className:"font-semibold",children:(i==null?void 0:i.weeklyDigestSubscribers)||0})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:s("email.instantAlerts")}),e.jsx("span",{className:"font-semibold",children:(i==null?void 0:i.instantAlertSubscribers)||0})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:s("email.lastSent")}),e.jsx("span",{className:"font-semibold",children:i!=null&&i.lastSent?new Date(i.lastSent).toLocaleString():s("time.never")})]})]})})]})]})]})]})}export{se as default};
