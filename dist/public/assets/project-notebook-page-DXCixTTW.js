import{e as q,r as p,u as M,f as Q,g as L,h as z,j as e,ag as T,B as l,C as v,c as N,I as w,w as b,x as y,y as k,z as C,E as d,J as F,M as $,o as B,q as V,s as _,t as G,a6 as J}from"./index-Dm22qi9h.js";import{D as O}from"./download-CQfvf7I6.js";import{P as D}from"./plus-gaIGr6ZR.js";import{C as Z}from"./calendar-B2qkWIGY.js";import{S as W}from"./square-pen-BRq2if-8.js";import{T as X}from"./trash-2-2KpnWBrB.js";import{S as Y}from"./save-C2frAQoU.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=q("FolderOpen",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=q("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]),se=[{name:"Regulatorische Anforderungen",description:"Zulassungsbedingungen, MDR, FDA Guidelines",color:"blue",icon:"Shield"},{name:"Technische Dokumentation",description:"Spezifikationen, Handbücher, Schemas",color:"green",icon:"FileText"},{name:"Qualitätsmanagement",description:"QMS, ISO Standards, Prüfprotokolle",color:"purple",icon:"CheckCircle"},{name:"Rechtsprechung",description:"Urteile, Präzedenzfälle, Legal Updates",color:"orange",icon:"Scale"},{name:"Forschung & Entwicklung",description:"Studien, Patente, Innovation",color:"teal",icon:"Lightbulb"},{name:"Notizen & Ideen",description:"Persönliche Notizen und Gedanken",color:"gray",icon:"PenTool"}];function ae({isFloating:n=!1,onClose:S}){const[x,j]=p.useState("all"),[m,s]=p.useState(""),[r,u]=p.useState(!1),[a,i]=p.useState(null),{toast:g}=M(),f=Q(),{data:A=[],isLoading:K}=L({queryKey:["/api/project-notebook/entries"],queryFn:async()=>{const t=await fetch("/api/project-notebook/entries");if(!t.ok)throw new Error("Failed to fetch entries");return await t.json()},staleTime:6e4}),{data:E=[]}=L({queryKey:["/api/project-notebook/categories"],queryFn:async()=>{const t=await fetch("/api/project-notebook/categories");return t.ok?await t.json():se.map((o,h)=>({...o,id:`default-${h}`,entryCount:0}))},staleTime:3e5}),R=z({mutationFn:async t=>{const o=t.id?"PUT":"POST",h=t.id?`/api/project-notebook/entries/${t.id}`:"/api/project-notebook/entries",c=await fetch(h,{method:o,headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!c.ok)throw new Error("Failed to save entry");return await c.json()},onSuccess:()=>{f.invalidateQueries({queryKey:["/api/project-notebook/entries"]}),f.invalidateQueries({queryKey:["/api/project-notebook/categories"]}),u(!1),i(null),g({title:"Gespeichert",description:"Eintrag wurde erfolgreich gespeichert."})},onError:()=>{g({title:"Fehler",description:"Eintrag konnte nicht gespeichert werden.",variant:"destructive"})}}),U=z({mutationFn:async t=>{const o=await fetch(`/api/project-notebook/entries/${t}`,{method:"DELETE"});if(!o.ok)throw new Error("Failed to delete entry");return await o.json()},onSuccess:()=>{f.invalidateQueries({queryKey:["/api/project-notebook/entries"]}),f.invalidateQueries({queryKey:["/api/project-notebook/categories"]}),g({title:"Gelöscht",description:"Eintrag wurde erfolgreich gelöscht."})}}),P=A.filter(t=>{const o=x==="all"||t.category===x,h=!m||t.title.toLowerCase().includes(m.toLowerCase())||t.content.toLowerCase().includes(m.toLowerCase())||t.tags.some(c=>c.toLowerCase().includes(m.toLowerCase()));return o&&h}),I=async()=>{try{const t=await fetch("/api/project-notebook/export/pdf",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tenantId:localStorage.getItem("tenant_id"),includeCategories:"all",format:"professional"})});if(t.ok){const o=await t.blob(),h=window.URL.createObjectURL(o),c=document.createElement("a");c.href=h,c.download=`Projektmappe_${new Date().toISOString().split("T")[0]}.pdf`,document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(h),g({title:"Export erfolgreich",description:"PDF wurde heruntergeladen."})}}catch{g({title:"Export fehlgeschlagen",description:"PDF konnte nicht erstellt werden.",variant:"destructive"})}},H=n?"fixed right-4 top-20 bottom-4 w-96 bg-white border shadow-lg rounded-lg z-50 flex flex-col":"max-w-6xl mx-auto p-6 space-y-6";return e.jsxs("div",{className:H,children:[n&&e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsxs("h2",{className:"font-semibold flex items-center gap-2",children:[e.jsx(T,{className:"h-5 w-5"}),"Projektmappe"]}),e.jsx(l,{variant:"ghost",size:"sm",onClick:S,children:"×"})]}),e.jsxs("div",{className:n?"flex-1 overflow-y-auto p-4":"",children:[!n&&e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-3",children:[e.jsx(T,{className:"h-8 w-8"}),"Persönliche Projektmappe"]}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Sammeln, organisieren und exportieren Sie projektrelevante Informationen"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(l,{onClick:I,variant:"outline",children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"PDF Export"]}),e.jsxs(l,{onClick:()=>u(!0),children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),"Neuer Eintrag"]})]})]}),e.jsx(v,{className:"mb-6",children:e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(w,{placeholder:"Einträge durchsuchen...",value:m,onChange:t=>s(t.target.value),className:"w-full"})}),e.jsx("div",{className:"w-48",children:e.jsxs(b,{value:x,onValueChange:j,children:[e.jsx(y,{children:e.jsx(k,{placeholder:"Kategorie"})}),e.jsxs(C,{children:[e.jsx(d,{value:"all",children:"Alle Kategorien"}),E.map(t=>e.jsxs(d,{value:t.name,children:[t.name," (",t.entryCount,")"]},t.id))]})]})})]})})}),!n&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:E.map(t=>e.jsx(v,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>j(t.name),children:e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:t.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[t.entryCount," Einträge"]})]}),e.jsx("div",{className:`w-3 h-3 rounded-full bg-${t.color}-500`})]})})},t.id))}),e.jsx("div",{className:"space-y-4",children:K?e.jsx("div",{className:"text-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"})}):P.length===0?e.jsx(v,{children:e.jsxs(N,{className:"text-center py-8",children:[e.jsx(T,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Keine Einträge gefunden"}),e.jsx("p",{className:"text-gray-500 mb-4",children:m||x!=="all"?"Ihre Suchkriterien ergaben keine Treffer.":"Erstellen Sie Ihren ersten Eintrag."}),e.jsxs(l,{onClick:()=>u(!0),children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),"Ersten Eintrag erstellen"]})]})}):P.map(t=>e.jsx(v,{className:"hover:shadow-md transition-shadow",children:e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"font-medium",children:t.title}),e.jsx(F,{variant:"outline",children:t.type}),e.jsx(F,{className:`bg-${t.priority==="high"?"red":t.priority==="medium"?"yellow":"gray"}-100`,children:t.priority})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-2 line-clamp-2",children:t.content}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ee,{className:"h-3 w-3"}),t.category]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Z,{className:"h-3 w-3"}),new Date(t.createdAt).toLocaleDateString("de-DE")]}),t.tags.length>0&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(te,{className:"h-3 w-3"}),t.tags.slice(0,2).join(", "),t.tags.length>2&&` +${t.tags.length-2}`]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[t.url&&e.jsx(l,{size:"sm",variant:"outline",asChild:!0,children:e.jsx("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",children:e.jsx($,{className:"h-4 w-4"})})}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>i(t),children:e.jsx(W,{className:"h-4 w-4"})}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>U.mutate(t.id),children:e.jsx(X,{className:"h-4 w-4"})})]})]})})},t.id))})]}),e.jsx(ne,{entry:a,categories:E,isOpen:r||!!a,onClose:()=>{u(!1),i(null)},onSave:t=>R.mutate(t)}),n&&e.jsx("div",{className:"p-4 border-t",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(l,{size:"sm",onClick:()=>u(!0),className:"flex-1",children:[e.jsx(D,{className:"h-4 w-4 mr-1"}),"Hinzufügen"]}),e.jsx(l,{size:"sm",variant:"outline",onClick:I,children:e.jsx(O,{className:"h-4 w-4"})})]})})]})}function ne({entry:n,categories:S,isOpen:x,onClose:j,onSave:m}){const[s,r]=p.useState({type:"note",title:"",content:"",category:"",tags:"",url:"",priority:"medium"});p.useEffect(()=>{r(n?{type:n.type,title:n.title,content:n.content,category:n.category,tags:n.tags.join(", "),url:n.url||"",priority:n.priority}:{type:"note",title:"",content:"",category:"",tags:"",url:"",priority:"medium"})},[n]);const u=()=>{if(!s.title.trim()||!s.content.trim())return;const a={...n&&{id:n.id},type:s.type,title:s.title.trim(),content:s.content.trim(),category:s.category||"Notizen & Ideen",tags:s.tags.split(",").map(i=>i.trim()).filter(Boolean),url:s.url.trim()||void 0,priority:s.priority,tenantId:localStorage.getItem("tenant_id")||"demo",userId:localStorage.getItem("user_id")||null};m(a)};return e.jsx(B,{open:x,onOpenChange:j,children:e.jsxs(V,{className:"max-w-2xl",children:[e.jsx(_,{children:e.jsx(G,{children:n?"Eintrag bearbeiten":"Neuer Eintrag"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Typ"}),e.jsxs(b,{value:s.type,onValueChange:a=>r(i=>({...i,type:a})),children:[e.jsx(y,{children:e.jsx(k,{})}),e.jsxs(C,{children:[e.jsx(d,{value:"note",children:"Notiz"}),e.jsx(d,{value:"link",children:"Link"}),e.jsx(d,{value:"article",children:"Artikel"}),e.jsx(d,{value:"document",children:"Dokument"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Priorität"}),e.jsxs(b,{value:s.priority,onValueChange:a=>r(i=>({...i,priority:a})),children:[e.jsx(y,{children:e.jsx(k,{})}),e.jsxs(C,{children:[e.jsx(d,{value:"low",children:"Niedrig"}),e.jsx(d,{value:"medium",children:"Mittel"}),e.jsx(d,{value:"high",children:"Hoch"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Titel"}),e.jsx(w,{value:s.title,onChange:a=>r(i=>({...i,title:a.target.value})),placeholder:"Titel des Eintrags"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Kategorie"}),e.jsxs(b,{value:s.category,onValueChange:a=>r(i=>({...i,category:a})),children:[e.jsx(y,{children:e.jsx(k,{placeholder:"Kategorie wählen"})}),e.jsx(C,{children:S.map(a=>e.jsx(d,{value:a.name,children:a.name},a.id))})]})]}),(s.type==="link"||s.type==="document")&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"URL"}),e.jsx(w,{value:s.url,onChange:a=>r(i=>({...i,url:a.target.value})),placeholder:"https://..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Inhalt/Notizen"}),e.jsx(J,{value:s.content,onChange:a=>r(i=>({...i,content:a.target.value})),placeholder:"Beschreibung, Notizen oder Inhalt...",rows:6})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Tags (kommagetrennt)"}),e.jsx(w,{value:s.tags,onChange:a=>r(i=>({...i,tags:a.target.value})),placeholder:"tag1, tag2, tag3"})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(l,{variant:"outline",onClick:j,children:"Abbrechen"}),e.jsxs(l,{onClick:u,disabled:!s.title.trim()||!s.content.trim(),children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Speichern"]})]})]})]})})}function he(){return e.jsx(ae,{isFloating:!1})}export{he as default};
