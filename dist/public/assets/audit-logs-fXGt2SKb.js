import{e as le,r as c,g as ae,j as e,B as S,C as V,a as G,b as $,c as M,a7 as re,I as w,w as f,x as b,y as p,z as E,E as l,P as ie,J as D,a0 as K,N as W,D as ne,a5 as ce,W as de,k as oe}from"./index-Dm22qi9h.js";import{T as q,a as H,b as T,c as r,d as J,e as i}from"./table-CD4zTI82.js";import{D as y}from"./download-CQfvf7I6.js";import{F as me}from"./filter-CBkaAuG_.js";import{E as xe}from"./eye-KEHLO33x.js";import{L as Q}from"./lock-DBHjhAGA.js";import{T as he}from"./trash-2-2KpnWBrB.js";import{S as ue}from"./square-pen-BRq2if-8.js";import{U as je}from"./user-B59OzLQb.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=le("LockOpen",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]),C={USER_CREATED:"Benutzerverwaltung",USER_UPDATED:"Benutzerverwaltung",USER_DELETED:"Benutzerverwaltung",LOGIN_SUCCESS:"Authentifizierung",LOGIN_FAILED:"Authentifizierung",LOGOUT:"Authentifizierung",CONTENT_APPROVED:"Genehmigung",CONTENT_REJECTED:"Genehmigung",SETTINGS_UPDATED:"Systemkonfiguration",DATA_EXPORT:"Datenexport",DATA_IMPORT:"Datenimport",NEWSLETTER_SENT:"Newsletter",BACKUP_CREATED:"System",SYSTEM_RESTART:"System"},ve={low:"bg-blue-100 text-blue-800 border-blue-200",medium:"bg-yellow-100 text-yellow-800 border-yellow-200",high:"bg-orange-100 text-orange-800 border-orange-200",critical:"bg-red-100 text-red-800 border-red-200"},Ne={success:"bg-green-100 text-green-800",failure:"bg-red-100 text-red-800"},Se={USER_CREATED:je,USER_UPDATED:ue,USER_DELETED:he,LOGIN_SUCCESS:ge,LOGIN_FAILED:Q,LOGOUT:Q,CONTENT_APPROVED:oe,CONTENT_REJECTED:de,SETTINGS_UPDATED:W,DATA_EXPORT:y,DATA_IMPORT:y,NEWSLETTER_SENT:ce,BACKUP_CREATED:ne,SYSTEM_RESTART:W};function ke(){const[x,k]=c.useState(""),[h,L]=c.useState("all"),[u,R]=c.useState("all"),[j,I]=c.useState("all"),[g,O]=c.useState("all"),[d,_]=c.useState(),[o,U]=c.useState(),[t,P]=c.useState(null),{data:v=[],isLoading:fe}=ae({queryKey:["/api/audit-logs",{search:x,action:h==="all"?void 0:h,severity:u==="all"?void 0:u,status:j==="all"?void 0:j,user:g==="all"?void 0:g,dateFrom:d==null?void 0:d.toISOString(),dateTo:o==null?void 0:o.toISOString()}],enabled:!0}),N=v.filter(s=>{const m=x===""||s.details.toLowerCase().includes(x.toLowerCase())||s.userName.toLowerCase().includes(x.toLowerCase())||s.action.toLowerCase().includes(x.toLowerCase()),n=h==="all"||s.action===h,A=u==="all"||s.severity===u,a=j==="all"||s.status===j,ee=g==="all"||s.userId===g,F=new Date(s.timestamp),se=!d||F>=d,te=!o||F<=o;return m&&n&&A&&a&&ee&&se&&te}),Z=Array.from(new Set(v.map(s=>s.action))),X=Array.from(new Set(v.map(s=>({id:s.userId,name:s.userName})))),z=s=>new Date(s).toLocaleDateString("de-DE",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}),B=s=>{const m=Se[s]||K;return e.jsx(m,{className:"h-4 w-4"})},Y=()=>{const s=["Zeitstempel,Benutzer,Aktion,Resource,Details,Schweregrad,Status,IP-Adresse",...N.map(a=>`"${a.timestamp}","${a.userName}","${a.action}","${a.resource}","${a.details}","${a.severity}","${a.status}","${a.ipAddress}"`)].join(`
`),m=new Blob([s],{type:"text/csv;charset=utf-8;"}),n=document.createElement("a"),A=URL.createObjectURL(m);n.setAttribute("href",A),n.setAttribute("download",`audit-logs-${new Date().toISOString().split("T")[0]}.csv`),n.style.visibility="hidden",document.body.appendChild(n),n.click(),document.body.removeChild(n)};return e.jsxs("div",{className:"container mx-auto py-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Audit-Protokolle"}),e.jsx("p",{className:"text-muted-foreground",children:"Vollständige Aufzeichnung aller Systemaktivitäten und Änderungen"})]}),e.jsxs(S,{onClick:Y,children:[e.jsx(y,{className:"mr-2 h-4 w-4"}),"Protokolle exportieren"]})]}),e.jsxs("div",{className:"grid gap-6",children:[e.jsxs(V,{children:[e.jsx(G,{children:e.jsxs($,{className:"flex items-center",children:[e.jsx(me,{className:"mr-2 h-5 w-5"}),"Filter & Suche"]})}),e.jsxs(M,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Suche"}),e.jsxs("div",{className:"relative",children:[e.jsx(re,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(w,{placeholder:"Details, Benutzer, Aktion...",value:x,onChange:s=>k(s.target.value),className:"pl-10"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Aktion"}),e.jsxs(f,{value:h,onValueChange:L,children:[e.jsx(b,{children:e.jsx(p,{})}),e.jsxs(E,{children:[e.jsx(l,{value:"all",children:"Alle Aktionen"}),Z.map(s=>e.jsx(l,{value:s,children:C[s]||s},s))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Schweregrad"}),e.jsxs(f,{value:u,onValueChange:R,children:[e.jsx(b,{children:e.jsx(p,{})}),e.jsxs(E,{children:[e.jsx(l,{value:"all",children:"Alle Schweregrade"}),e.jsx(l,{value:"critical",children:"🔴 Kritisch"}),e.jsx(l,{value:"high",children:"🟠 Hoch"}),e.jsx(l,{value:"medium",children:"🟡 Mittel"}),e.jsx(l,{value:"low",children:"🔵 Niedrig"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Status"}),e.jsxs(f,{value:j,onValueChange:I,children:[e.jsx(b,{children:e.jsx(p,{})}),e.jsxs(E,{children:[e.jsx(l,{value:"all",children:"Alle Status"}),e.jsx(l,{value:"success",children:"✅ Erfolgreich"}),e.jsx(l,{value:"failure",children:"❌ Fehlgeschlagen"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Benutzer"}),e.jsxs(f,{value:g,onValueChange:O,children:[e.jsx(b,{children:e.jsx(p,{})}),e.jsxs(E,{children:[e.jsx(l,{value:"all",children:"Alle Benutzer"}),X.map(s=>e.jsx(l,{value:s.id,children:s.name},s.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Von Datum"}),e.jsx(w,{type:"date",value:d?d.toISOString().split("T")[0]:"",onChange:s=>_(s.target.value?new Date(s.target.value):void 0)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Bis Datum"}),e.jsx(w,{type:"date",value:o?o.toISOString().split("T")[0]:"",onChange:s=>U(s.target.value?new Date(s.target.value):void 0)})]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:[N.length," von ",v.length," Einträgen gefunden"]}),e.jsx(S,{variant:"outline",onClick:()=>{k(""),L("all"),R("all"),I("all"),O("all"),_(void 0),U(void 0)},children:"Filter zurücksetzen"})]})]})]}),e.jsxs(V,{children:[e.jsxs(G,{children:[e.jsx($,{children:"Systemaktivitäten"}),e.jsx(ie,{children:"Chronologische Auflistung aller wichtigen Systemereignisse"})]}),e.jsxs(M,{children:[e.jsxs(q,{children:[e.jsx(H,{children:e.jsxs(T,{children:[e.jsx(r,{children:"Zeitstempel"}),e.jsx(r,{children:"Benutzer"}),e.jsx(r,{children:"Aktion"}),e.jsx(r,{children:"Resource"}),e.jsx(r,{children:"Schweregrad"}),e.jsx(r,{children:"Status"}),e.jsx(r,{className:"text-right",children:"Details"})]})}),e.jsx(J,{children:N.map(s=>e.jsxs(T,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>P(s),children:[e.jsx(i,{className:"font-mono text-xs",children:z(s.timestamp)}),e.jsx(i,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.userName}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.userRole})]})}),e.jsx(i,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[B(s.action),e.jsx("span",{className:"text-sm",children:C[s.action]||s.action})]})}),e.jsx(i,{children:e.jsx(D,{variant:"outline",children:s.resource})}),e.jsx(i,{children:e.jsx(D,{className:ve[s.severity],variant:"outline",children:s.severity})}),e.jsx(i,{children:e.jsx(D,{className:Ne[s.status],variant:"secondary",children:s.status==="success"?"Erfolg":"Fehler"})}),e.jsx(i,{className:"text-right",children:e.jsx(S,{variant:"ghost",size:"sm",children:e.jsx(xe,{className:"h-4 w-4"})})})]},s.id))})]}),N.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(K,{className:"mx-auto h-16 w-16 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Keine Protokolleinträge gefunden"}),e.jsx("p",{className:"text-muted-foreground",children:"Passen Sie Ihre Filter an oder erweitern Sie den Zeitraum."})]})]})]})]}),t&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Aktivitätsdetails"}),e.jsx("p",{className:"text-muted-foreground",children:z(t.timestamp)})]}),e.jsx(S,{variant:"ghost",onClick:()=>P(null),children:"✕"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Benutzer"}),e.jsx("p",{className:"font-medium",children:t.userName}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.userRole})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Aktion"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[B(t.action),e.jsx("span",{children:C[t.action]||t.action})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Details"}),e.jsx("p",{className:"bg-muted p-3 rounded text-sm",children:t.details})]}),t.changes&&t.changes.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Änderungen"}),e.jsx("div",{className:"border rounded overflow-hidden",children:e.jsxs(q,{children:[e.jsx(H,{children:e.jsxs(T,{children:[e.jsx(r,{children:"Feld"}),e.jsx(r,{children:"Alter Wert"}),e.jsx(r,{children:"Neuer Wert"})]})}),e.jsx(J,{children:t.changes.map((s,m)=>e.jsxs(T,{children:[e.jsx(i,{className:"font-medium",children:s.field}),e.jsx(i,{className:"font-mono text-sm text-red-600",children:s.oldValue||"(leer)"}),e.jsx(i,{className:"font-mono text-sm text-green-600",children:s.newValue||"(leer)"})]},m))})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"IP-Adresse"}),e.jsx("p",{className:"font-mono",children:t.ipAddress})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"User Agent"}),e.jsx("p",{className:"text-xs break-all",children:t.userAgent})]})]})]})]})})]})}export{ke as default};
