import{r as N,f as Z,g as v,h as E,j as e,_ as S,B as y,a1 as K,A as T,C as c,a as d,b as x,T as P,c as o,a8 as H,J as u}from"./index-Dm22qi9h.js";import{T as D,a as I,b as A,c as m,d as Q,e as h}from"./table-CD4zTI82.js";import{M as $}from"./monitor-60QAM5UT.js";function W(){const[l,g]=N.useState("overview"),[j,w]=N.useState(0),p=Z();N.useEffect(()=>()=>{p.cancelQueries({queryKey:["/api/analytics"]})},[p]);const{data:s,isLoading:L}=v({queryKey:["/api/analytics/overview"],refetchInterval:3e4}),{data:i,isLoading:G}=v({queryKey:["/api/analytics/access-log",j],enabled:l==="access-log"}),{data:n,isLoading:O}=v({queryKey:["/api/analytics/live"],enabled:l==="live",refetchInterval:5e3}),b=E({mutationFn:async()=>{await p.invalidateQueries({queryKey:["/api/analytics"]})},onSuccess:()=>{console.log("Analytics-Daten erfolgreich aktualisiert")}}),k=r=>new Date(r).toLocaleString("de-DE"),M=()=>{var r,t,f,C;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs(c,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"text-sm font-medium",children:"Gesamt-Zugriffe"}),e.jsx(P,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold",children:(r=s==null?void 0:s.totalViews)==null?void 0:r.toLocaleString()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Alle Zeit"})]})]}),e.jsxs(c,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"text-sm font-medium",children:"Heute"}),e.jsx(T,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold",children:s==null?void 0:s.todayViews}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Seitenaufrufe heute"})]})]}),e.jsxs(c,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"text-sm font-medium",children:"Eindeutige Besucher"}),e.jsx(H,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold",children:s==null?void 0:s.uniqueToday}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Heute"})]})]})]}),e.jsxs(c,{children:[e.jsx(d,{children:e.jsx(x,{children:"Meistbesuchte Seiten (letzte 7 Tage)"})}),e.jsx(o,{children:e.jsx("div",{className:"space-y-3",children:(t=s==null?void 0:s.topPages)==null?void 0:t.map((a,q)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(u,{variant:"outline",children:q+1}),e.jsx("span",{className:"font-medium",children:a.page})]}),e.jsxs(u,{variant:"secondary",children:[a.views," Aufrufe"]})]},a.page))})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(c,{children:[e.jsx(d,{children:e.jsx(x,{children:"Browser-Statistiken"})}),e.jsx(o,{children:e.jsx("div",{className:"space-y-2",children:(f=s==null?void 0:s.browserStats)==null?void 0:f.map(a=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:a.browser}),e.jsx(u,{variant:"outline",children:a.count})]},a.browser))})})]}),e.jsxs(c,{children:[e.jsx(d,{children:e.jsx(x,{children:"Gerät-Statistiken"})}),e.jsx(o,{children:e.jsx("div",{className:"space-y-2",children:(C=s==null?void 0:s.deviceStats)==null?void 0:C.map(a=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:a.device}),e.jsx(u,{variant:"outline",children:a.count})]},a.device))})})]})]})]})},B=()=>{var r;return e.jsxs(c,{children:[e.jsx(d,{children:e.jsx(x,{children:"Detailliertes Zugriffs-Protokoll"})}),e.jsxs(o,{children:[e.jsxs(D,{children:[e.jsx(I,{children:e.jsxs(A,{children:[e.jsx(m,{children:"Zeitstempel"}),e.jsx(m,{children:"Seite"}),e.jsx(m,{children:"IP-Adresse"}),e.jsx(m,{children:"Standort"}),e.jsx(m,{children:"Browser"}),e.jsx(m,{children:"Gerät"})]})}),e.jsx(Q,{children:(r=i==null?void 0:i.accessLog)==null?void 0:r.map(t=>e.jsxs(A,{children:[e.jsx(h,{className:"text-sm",children:k(t.timestamp)}),e.jsx(h,{children:e.jsx(u,{variant:"outline",children:t.page})}),e.jsx(h,{className:"font-mono text-xs",children:t.ipAddress}),e.jsx(h,{children:t.location}),e.jsx(h,{className:"text-sm",children:t.browser}),e.jsx(h,{children:t.device})]},t.id))})]}),(i==null?void 0:i.pagination)&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Zeige ",i.pagination.offset+1," - ",Math.min(i.pagination.offset+i.pagination.limit,i.pagination.total)," von ",i.pagination.total," Einträgen"]}),e.jsxs("div",{className:"space-x-2",children:[e.jsx(y,{variant:"outline",size:"sm",onClick:()=>w(Math.max(0,j-100)),disabled:j===0,children:"Vorherige"}),e.jsx(y,{variant:"outline",size:"sm",onClick:()=>w(j+100),disabled:!i.pagination.hasMore,children:"Nächste"})]})]})]})]})},z=()=>{var r;return e.jsx("div",{className:"space-y-6",children:e.jsxs(c,{children:[e.jsx(d,{children:e.jsxs(x,{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),"Live-Aktivität (letzte 5 Minuten)"]})}),e.jsxs(o,{children:[e.jsxs("div",{className:"text-3xl font-bold text-green-600 mb-4",children:[(n==null?void 0:n.activeUsers)||0," aktive Benutzer"]}),e.jsx("div",{className:"space-y-3",children:(r=n==null?void 0:n.recentActivity)==null?void 0:r.map((t,f)=>e.jsxs("div",{className:"flex items-center justify-between border-l-2 border-green-500 pl-4 py-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t.page}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[t.location," • ",t.browser," • ",t.device]})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:k(t.timestamp)})]},f))}),(!(n!=null&&n.recentActivity)||n.recentActivity.length===0)&&e.jsx("div",{className:"text-center text-muted-foreground py-8",children:"Keine aktuelle Aktivität in den letzten 5 Minuten"})]})]})})};return L&&l==="overview"?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(S,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Website Analytics"}),e.jsx("p",{className:"text-muted-foreground",children:"Überwachen Sie Zugriffe und Benutzeraktivität auf Ihrer Website"})]}),e.jsxs(y,{onClick:()=>b.mutate(),disabled:b.isPending,size:"sm",children:[e.jsx(S,{className:`h-4 w-4 mr-2 ${b.isPending?"animate-spin":""}`}),"Aktualisieren"]})]}),e.jsxs("div",{className:"flex space-x-4 border-b",children:[e.jsxs("button",{onClick:()=>g("overview"),className:`px-4 py-2 font-medium text-sm transition-colors ${l==="overview"?"border-b-2 border-blue-600 text-blue-600":"text-muted-foreground hover:text-foreground"}`,children:[e.jsx(K,{className:"h-4 w-4 inline mr-2"}),"Übersicht"]}),e.jsxs("button",{onClick:()=>g("access-log"),className:`px-4 py-2 font-medium text-sm transition-colors ${l==="access-log"?"border-b-2 border-blue-600 text-blue-600":"text-muted-foreground hover:text-foreground"}`,children:[e.jsx($,{className:"h-4 w-4 inline mr-2"}),"Zugriffs-Protokoll"]}),e.jsxs("button",{onClick:()=>g("live"),className:`px-4 py-2 font-medium text-sm transition-colors ${l==="live"?"border-b-2 border-blue-600 text-blue-600":"text-muted-foreground hover:text-foreground"}`,children:[e.jsx(T,{className:"h-4 w-4 inline mr-2"}),"Live-Aktivität"]})]}),e.jsxs("div",{className:"min-h-[400px]",children:[l==="overview"&&M(),l==="access-log"&&B(),l==="live"&&z()]})]})}export{W as default};
