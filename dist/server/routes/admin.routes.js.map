{"version":3,"file":"admin.routes.js","sourceRoot":"","sources":["../../../server/routes/admin.routes.ts"],"names":[],"mappings":"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","sourcesContent":["import { Router, Request, Response } from 'express';\r\nimport { logger } from '../services/logger.service';\r\nimport { asyncHandler } from '../middleware/error.middleware';\r\nimport { validateBody, validateParams } from '../middleware/validation.middleware';\r\nimport { z } from 'zod';\r\nimport { db } from '../storage/database';\r\nimport { tenants } from '../../shared/schema';\r\n\r\nconst router = Router();\r\n\r\n// Validation schemas\r\nconst credentialsSchema = z.record(z.string());\r\nconst sourceIdSchema = z.object({\r\n  sourceId: z.string().min(1)\r\n});\r\n\r\n// Mock data store for credentials (in production, use database)\r\nconst credentialsStore: Record<string, Record<string, string>> = {};\r\n\r\n// Get all data sources configuration\r\nrouter.get('/data-sources', asyncHandler(async (req: Request, res: Response) => {\r\n  logger.info('API: Fetching data sources configuration');\r\n  \r\n  // In production, this would fetch from database\r\n  const dataSources = [\r\n    {\r\n      id: 'fda_510k',\r\n      name: 'FDA 510(k) Database',\r\n      status: 'inactive',\r\n      hasCredentials: !!credentialsStore['fda_510k']\r\n    },\r\n    {\r\n      id: 'ema_epar',\r\n      name: 'EMA EPAR Database',\r\n      status: 'active',\r\n      hasCredentials: !!credentialsStore['ema_epar']\r\n    },\r\n    // Add more sources as needed\r\n  ];\r\n  \r\n  res.json(dataSources);\r\n}));\r\n\r\n// Save credentials for a data source\r\nrouter.post('/data-sources/:sourceId/credentials', \r\n  validateParams(sourceIdSchema),\r\n  validateBody(credentialsSchema),\r\n  asyncHandler(async (req: Request, res: Response) => {\r\n    const { sourceId } = req.params;\r\n    const credentials = req.body;\r\n    \r\n    if (!sourceId) {\r\n      return res.status(400).json({\r\n        success: false,\r\n        error: 'Datenquellen-ID ist erforderlich',\r\n        timestamp: new Date().toISOString()\r\n      });\r\n    }\r\n    \r\n    logger.info('API: Saving credentials for data source', { sourceId });\r\n    \r\n    // In production, encrypt and store in database\r\n    credentialsStore[sourceId] = credentials;\r\n    \r\n    logger.info('API: Credentials saved successfully', { sourceId });\r\n    \r\n    return res.json({\r\n      success: true,\r\n      message: 'Zugangsdaten erfolgreich gespeichert',\r\n      timestamp: new Date().toISOString()\r\n    });\r\n  })\r\n);\r\n\r\n// Test connection for a data source\r\nrouter.post('/data-sources/:sourceId/test',\r\n  validateParams(sourceIdSchema),\r\n  asyncHandler(async (req: Request, res: Response) => {\r\n    const { sourceId } = req.params;\r\n    \r\n    if (!sourceId) {\r\n      return res.status(400).json({\r\n        success: false,\r\n        error: 'Datenquellen-ID ist erforderlich',\r\n        timestamp: new Date().toISOString()\r\n      });\r\n    }\r\n    \r\n    logger.info('API: Testing connection for data source', { sourceId });\r\n    \r\n    const credentials = credentialsStore[sourceId];\r\n    if (!credentials) {\r\n      return res.status(400).json({\r\n        success: false,\r\n        error: 'Keine Zugangsdaten für diese Datenquelle gefunden',\r\n        timestamp: new Date().toISOString()\r\n      });\r\n    }\r\n    \r\n    // In production, actually test the connection to the data source\r\n    // For now, simulate a test\r\n    const isSuccess = Math.random() > 0.3; // 70% success rate for demo\r\n    \r\n    if (isSuccess) {\r\n      logger.info('API: Connection test successful', { sourceId });\r\n      return res.json({\r\n        success: true,\r\n        message: 'Verbindung erfolgreich getestet',\r\n        timestamp: new Date().toISOString()\r\n      });\r\n    } else {\r\n      logger.warn('API: Connection test failed', { sourceId });\r\n      return res.status(400).json({\r\n        success: false,\r\n        error: 'Verbindungstest fehlgeschlagen - Überprüfen Sie die Zugangsdaten',\r\n        timestamp: new Date().toISOString()\r\n      });\r\n    }\r\n  })\r\n);\r\n\r\n// Get credentials for a data source (masked for security)\r\nrouter.get('/data-sources/:sourceId/credentials',\r\n  validateParams(sourceIdSchema),\r\n  asyncHandler(async (req: Request, res: Response) => {\r\n    const { sourceId } = req.params;\r\n    \r\n    if (!sourceId) {\r\n      return res.status(400).json({\r\n        success: false,\r\n        error: 'Datenquellen-ID ist erforderlich',\r\n        timestamp: new Date().toISOString()\r\n      });\r\n    }\r\n    \r\n    logger.info('API: Fetching masked credentials for data source', { sourceId });\r\n    \r\n    const credentials = credentialsStore[sourceId];\r\n    if (!credentials) {\r\n      return res.json({\r\n        success: true,\r\n        data: {},\r\n        timestamp: new Date().toISOString()\r\n      });\r\n    }\r\n    \r\n    // Mask sensitive values\r\n    const maskedCredentials: Record<string, string> = {};\r\n    Object.keys(credentials).forEach(key => {\r\n      const value = credentials[key];\r\n      if (value && typeof value === 'string') {\r\n        if (key.toLowerCase().includes('password') || key.toLowerCase().includes('secret') || key.toLowerCase().includes('key')) {\r\n          maskedCredentials[key] = '****' + value.slice(-4);\r\n        } else {\r\n          maskedCredentials[key] = value;\r\n        }\r\n      }\r\n    });\r\n    \r\n    return res.json({\r\n      success: true,\r\n      data: maskedCredentials,\r\n      timestamp: new Date().toISOString()\r\n    });\r\n  })\r\n);\r\n\r\n// TENANT MANAGEMENT ROUTES\r\n\r\n// Validation schema für Tenant-Erstellung\r\nconst createTenantSchema = z.object({\r\n  name: z.string().min(1, 'Firmenname ist erforderlich'),\r\n  slug: z.string().min(1, 'Slug ist erforderlich'),\r\n  subscriptionPlan: z.enum(['starter', 'professional', 'enterprise']),\r\n  subscriptionStatus: z.enum(['trial', 'active', 'cancelled', 'suspended']),\r\n  billingEmail: z.string().email('Gültige E-Mail-Adresse erforderlich'),\r\n  contactName: z.string().min(1, 'Kontaktname ist erforderlich'),\r\n  contactEmail: z.string().email('Gültige Kontakt-E-Mail erforderlich'),\r\n  maxUsers: z.number().min(1),\r\n  maxDataSources: z.number().min(1),\r\n  apiAccessEnabled: z.boolean().default(true)\r\n});\r\n\r\n// POST /api/admin/tenants - Neuen Tenant erstellen\r\nrouter.post('/tenants', async (req: Request, res: Response) => {\r\n  try {\r\n    console.log('[ADMIN] Creating new tenant:', req.body);\r\n    \r\n    // Validate input\r\n    const validatedData = createTenantSchema.parse(req.body);\r\n    \r\n    // Import tenant service dynamically\r\n    const { TenantService } = await import('../services/tenantService');\r\n    \r\n    // Create tenant with email service integration\r\n    const newTenant = await TenantService.createTenant({\r\n      name: validatedData.name,\r\n      slug: validatedData.slug,\r\n      subscriptionPlan: validatedData.subscriptionPlan,\r\n      subscriptionStatus: validatedData.subscriptionStatus,\r\n      billingEmail: validatedData.billingEmail,\r\n      maxUsers: validatedData.maxUsers,\r\n      maxDataSources: validatedData.maxDataSources,\r\n      apiAccessEnabled: validatedData.apiAccessEnabled,\r\n      contactName: validatedData.contactName,\r\n      contactEmail: validatedData.contactEmail\r\n    });\r\n\r\n    console.log('[ADMIN] Tenant created successfully:', newTenant.id);\r\n    \r\n    return res.status(201).json({\r\n      success: true,\r\n      data: newTenant,\r\n      message: 'Tenant erfolgreich erstellt'\r\n    });\r\n    \r\n  } catch (error: any) {\r\n    console.error('[ADMIN] Error creating tenant:', error);\r\n    \r\n    if (error.message === 'Slug already exists') {\r\n      return res.status(409).json({\r\n        success: false,\r\n        error: 'Slug bereits vergeben - bitte wählen Sie einen anderen',\r\n        timestamp: new Date().toISOString()\r\n      });\r\n    }\r\n    \r\n    return res.status(500).json({\r\n      success: false,\r\n      error: error.message || 'Fehler beim Erstellen des Tenants',\r\n      timestamp: new Date().toISOString()\r\n    });\r\n  }\r\n});\r\n\r\n// GET /api/admin/tenants - Alle Tenants auflisten\r\nrouter.get('/tenants', async (req: Request, res: Response) => {\r\n  try {\r\n    // Direct SQL query für bessere Kompatibilität\r\n    const { neon } = await import('@neondatabase/serverless');\r\n    const sql = neon(process.env.DATABASE_URL!);\r\n    \r\n    const result = await sql`\r\n      SELECT \r\n        id,\r\n        name,\r\n        slug,\r\n        subscription_plan as \"subscriptionPlan\",\r\n        subscription_status as \"subscriptionStatus\", \r\n        billing_email as \"billingEmail\",\r\n        max_users as \"maxUsers\",\r\n        max_data_sources as \"maxDataSources\",\r\n        api_access_enabled as \"apiAccessEnabled\",\r\n        custom_branding_enabled as \"customBrandingEnabled\",\r\n        customer_permissions as \"customerPermissions\",\r\n        trial_ends_at as \"trialEndsAt\",\r\n        created_at as \"createdAt\",\r\n        updated_at as \"updatedAt\"\r\n      FROM tenants \r\n      ORDER BY created_at DESC\r\n    `;\r\n    \r\n    console.log('[ADMIN] Fetched tenants for frontend:', result.length);\r\n    \r\n    return res.json(result);\r\n  } catch (error: any) {\r\n    console.error('[ADMIN] Error fetching tenants:', error);\r\n    return res.status(500).json({\r\n      success: false,\r\n      error: error.message || 'Fehler beim Laden der Tenants'\r\n    });\r\n  }\r\n});\r\n\r\n// PUT /api/admin/tenants/:id - Tenant bearbeiten\r\nrouter.put('/tenants/:id', async (req: Request, res: Response) => {\r\n  try {\r\n    const { id } = req.params;\r\n    const updateData = req.body;\r\n    \r\n    console.log('[ADMIN] Updating tenant:', id, updateData);\r\n    \r\n    // Use direct SQL query for better compatibility\r\n    const { neon } = await import('@neondatabase/serverless');\r\n    const sql = neon(process.env.DATABASE_URL!);\r\n    \r\n    // Build SQL update statement\r\n    const updates: string[] = [];\r\n    const values: any[] = [];\r\n    let paramIndex = 1;\r\n    \r\n    if (updateData.name) {\r\n      updates.push(`name = $${paramIndex++}`);\r\n      values.push(updateData.name);\r\n    }\r\n    if (updateData.subscriptionPlan) {\r\n      updates.push(`subscription_plan = $${paramIndex++}`);\r\n      values.push(updateData.subscriptionPlan);\r\n    }\r\n    if (updateData.subscriptionStatus) {\r\n      updates.push(`subscription_status = $${paramIndex++}`);\r\n      values.push(updateData.subscriptionStatus);\r\n    }\r\n    if (updateData.billingEmail) {\r\n      updates.push(`billing_email = $${paramIndex++}`);\r\n      values.push(updateData.billingEmail);\r\n    }\r\n    if (updateData.maxUsers !== undefined) {\r\n      updates.push(`max_users = $${paramIndex++}`);\r\n      values.push(updateData.maxUsers);\r\n    }\r\n    if (updateData.maxDataSources !== undefined) {\r\n      updates.push(`max_data_sources = $${paramIndex++}`);\r\n      values.push(updateData.maxDataSources);\r\n    }\r\n    if (updateData.apiAccessEnabled !== undefined) {\r\n      updates.push(`api_access_enabled = $${paramIndex++}`);\r\n      values.push(updateData.apiAccessEnabled);\r\n    }\r\n    if (updateData.customBrandingEnabled !== undefined) {\r\n      updates.push(`custom_branding_enabled = $${paramIndex++}`);\r\n      values.push(updateData.customBrandingEnabled);\r\n    }\r\n    \r\n    if (updates.length === 0) {\r\n      return res.status(400).json({\r\n        success: false,\r\n        error: 'Keine Daten zum Aktualisieren'\r\n      });\r\n    }\r\n    \r\n    updates.push(`updated_at = $${paramIndex++}`);\r\n    values.push(new Date());\r\n    values.push(id);\r\n    \r\n    // Build proper parameterized query\r\n    const updateQuery = `\r\n      UPDATE tenants \r\n      SET ${updates.join(', ')}\r\n      WHERE id = $${paramIndex}\r\n      RETURNING *\r\n    `;\r\n    \r\n    const result = await sql(updateQuery, values);\r\n    \r\n    if (result.length === 0) {\r\n      return res.status(404).json({\r\n        success: false,\r\n        error: 'Tenant nicht gefunden'\r\n      });\r\n    }\r\n    \r\n    console.log('[ADMIN] Tenant updated successfully:', result[0]?.id);\r\n    \r\n    return res.json({\r\n      success: true,\r\n      data: result[0],\r\n      message: 'Tenant erfolgreich aktualisiert'\r\n    });\r\n    \r\n  } catch (error: any) {\r\n    console.error('[ADMIN] Error updating tenant:', error);\r\n    return res.status(500).json({\r\n      success: false,\r\n      error: error.message || 'Fehler beim Aktualisieren des Tenants'\r\n    });\r\n  }\r\n});\r\n\r\n// DELETE /api/admin/tenants/:id - Tenant löschen\r\nrouter.delete('/tenants/:id', async (req: Request, res: Response) => {\r\n  try {\r\n    const { id } = req.params;\r\n    \r\n    console.log('[ADMIN] Deleting tenant:', id);\r\n    \r\n    // Use direct SQL query for better compatibility\r\n    const { neon } = await import('@neondatabase/serverless');\r\n    const sql = neon(process.env.DATABASE_URL!);\r\n    \r\n    // First, delete related data access records\r\n    await sql`DELETE FROM tenant_data_access WHERE tenant_id = ${id}`;\r\n    \r\n    // Delete any tenant users if they exist\r\n    try {\r\n      await sql`DELETE FROM tenant_users WHERE tenant_id = ${id}`;\r\n    } catch (err) {\r\n      // Table might not exist, continue\r\n    }\r\n    \r\n    // Now delete the tenant\r\n    const result = await sql`\r\n      DELETE FROM tenants \r\n      WHERE id = ${id}\r\n      RETURNING id\r\n    `;\r\n    \r\n    if (result.length === 0) {\r\n      return res.status(404).json({\r\n        success: false,\r\n        error: 'Tenant nicht gefunden'\r\n      });\r\n    }\r\n    \r\n    console.log('[ADMIN] Tenant deleted successfully:', id);\r\n    \r\n    return res.json({\r\n      success: true,\r\n      message: 'Tenant erfolgreich gelöscht'\r\n    });\r\n    \r\n  } catch (error: any) {\r\n    console.error('[ADMIN] Error deleting tenant:', error);\r\n    return res.status(500).json({\r\n      success: false,\r\n      error: error.message || 'Fehler beim Löschen des Tenants'\r\n    });\r\n  }\r\n});\r\n\r\n// PUT /api/admin/tenants/:id/permissions - Customer permissions verwalten\r\nrouter.put('/tenants/:id/permissions', async (req: Request, res: Response) => {\r\n  try {\r\n    const { id } = req.params;\r\n    const { customerPermissions } = req.body;\r\n    \r\n    console.log('[ADMIN] Updating customer permissions for tenant:', id);\r\n    console.log('[ADMIN] New permissions:', customerPermissions);\r\n    \r\n    // Validate permissions structure\r\n    if (!customerPermissions || typeof customerPermissions !== 'object') {\r\n      return res.status(400).json({\r\n        success: false,\r\n        error: 'Ungültige Berechtigungsstruktur',\r\n        timestamp: new Date().toISOString()\r\n      });\r\n    }\r\n    \r\n    // Use Drizzle ORM instead of direct SQL\r\n    const { db } = await import('../db');\r\n    const { tenants } = await import('../../shared/schema');\r\n    const { eq } = await import('drizzle-orm');\r\n    \r\n    const result = await db\r\n      .update(tenants)\r\n      .set({\r\n        customerPermissions: customerPermissions,\r\n        updatedAt: new Date()\r\n      })\r\n      .where(eq(tenants.id, id))\r\n      .returning({\r\n        id: tenants.id,\r\n        name: tenants.name,\r\n        customerPermissions: tenants.customerPermissions\r\n      });\r\n    \r\n    if (result.length === 0) {\r\n      return res.status(404).json({\r\n        success: false,\r\n        error: 'Tenant nicht gefunden'\r\n      });\r\n    }\r\n    \r\n    console.log('[ADMIN] Customer permissions updated successfully for tenant:', id);\r\n    \r\n    return res.json({\r\n      success: true,\r\n      data: result[0],\r\n      message: 'Kundenberechtigungen erfolgreich aktualisiert'\r\n    });\r\n    \r\n  } catch (error: any) {\r\n    console.error('[ADMIN] Error updating customer permissions:', error);\r\n    return res.status(500).json({\r\n      success: false,\r\n      error: error.message || 'Fehler beim Aktualisieren der Berechtigungen'\r\n    });\r\n  }\r\n});\r\n\r\nexport default router;"]}