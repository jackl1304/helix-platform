{"version":3,"file":"tenant-auth-simple.js","sourceRoot":"","sources":["../../../server/routes/tenant-auth-simple.ts"],"names":[],"mappings":"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","sourcesContent":["import express from 'express';\r\nimport { neon } from \"@neondatabase/serverless\";\r\n\r\nconst router = express.Router();\r\nconst sql = neon(process.env.DATABASE_URL!);\r\n\r\n// Simple tenant login for demo\r\nrouter.post('/login', async (req, res) => {\r\n  try {\r\n    const { email, password } = req.body;\r\n\r\n    console.log('[TENANT AUTH] Login attempt:', { email, password });\r\n\r\n    if (!email || !password) {\r\n      return res.status(400).json({ \r\n        error: 'Email und Passwort sind erforderlich' \r\n      });\r\n    }\r\n\r\n    // Demo tenant\r\n    const tenant = {\r\n      id: '2d224347-b96e-4b61-acac-dbd414a0e048',\r\n      name: 'Demo Medical Corp',\r\n      subdomain: 'demo-medical',\r\n      subscription_tier: 'professional'\r\n    };\r\n\r\n    // Demo mode - create demo user if needed\r\n    let user;\r\n    \r\n    // Check for demo credentials first\r\n    if (email === 'admin@demo-medical.local' && password === 'demo123') {\r\n      // Demo user - bypass database lookup\r\n      user = {\r\n        id: 'demo-user-001',\r\n        email: 'admin@demo-medical.local',\r\n        name: 'Demo Admin',\r\n        role: 'admin',\r\n        created_at: new Date()\r\n      };\r\n      console.log('[TENANT AUTH] Demo user authenticated');\r\n    } else {\r\n      // Find user in database\r\n      const userResult = await sql`\r\n        SELECT id, email, name, role, created_at\r\n        FROM users \r\n        WHERE email = ${email}\r\n      `;\r\n\r\n      user = userResult[0];\r\n      console.log('[TENANT AUTH] User found:', user ? 'Yes' : 'No');\r\n\r\n      if (!user) {\r\n        return res.status(401).json({ \r\n          error: 'Ungültige Anmeldedaten' \r\n        });\r\n      }\r\n    }\r\n\r\n    // Verify password\r\n    let validPassword = false;\r\n    \r\n    if (email === 'admin@demo-medical.local') {\r\n      validPassword = password === 'demo123';\r\n    } else {\r\n      // For real users, check actual password (simplified for demo)\r\n      validPassword = password === 'demo123';\r\n    }\r\n    \r\n    console.log('[TENANT AUTH] Password valid:', validPassword);\r\n\r\n    if (!validPassword) {\r\n      return res.status(401).json({ \r\n        error: 'Ungültige Anmeldedaten' \r\n      });\r\n    }\r\n\r\n    // Successful login\r\n    const response = {\r\n      success: true,\r\n      user: {\r\n        id: user.id,\r\n        email: user.email,\r\n        name: user.name,\r\n        role: user.role\r\n      },\r\n      tenant: {\r\n        id: tenant.id,\r\n        name: tenant.name,\r\n        subdomain: tenant.subdomain,\r\n        colorScheme: 'blue',\r\n        subscriptionTier: tenant.subscription_tier\r\n      }\r\n    };\r\n\r\n    console.log('[TENANT AUTH] Login successful for:', user.email);\r\n    res.json(response);\r\n\r\n  } catch (error) {\r\n    console.error('[TENANT AUTH] Login error:', error);\r\n    res.status(500).json({ \r\n      error: 'Anmeldung fehlgeschlagen',\r\n      message: 'Bitte versuchen Sie es erneut'\r\n    });\r\n  }\r\n});\r\n\r\n// Simple logout\r\nrouter.post('/logout', (req, res) => {\r\n  res.json({ success: true, message: 'Erfolgreich abgemeldet' });\r\n});\r\n\r\n// Get current user profile\r\nrouter.get('/profile', (req, res) => {\r\n  res.json({\r\n    user: { id: 'demo', email: 'admin@demo-medical.local', name: 'Demo Admin', role: 'admin' },\r\n    tenant: { id: 'demo', name: 'Demo Medical Corp', subdomain: 'demo-medical' }\r\n  });\r\n});\r\n\r\nexport default router;"]}