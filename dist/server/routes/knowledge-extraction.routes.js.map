{"version":3,"file":"knowledge-extraction.routes.js","sourceRoot":"","sources":["../../../server/routes/knowledge-extraction.routes.ts"],"names":[],"mappings":"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","sourcesContent":["import { Router, Request, Response } from 'express';\r\nimport { z } from 'zod';\r\nimport { KnowledgeExtractionService } from '../services/knowledge-extraction.service';\r\nimport { storage } from '../storage';\r\nimport { Logger } from '../services/logger.service';\r\nimport { asyncHandler } from '../middleware/error.middleware';\r\n// Define createApiResponse locally since @shared/types doesn't exist\r\nconst createApiResponse = <T = any>(data: T, success: boolean = true, message?: string) => ({\r\n  success,\r\n  data,\r\n  message\r\n});\r\n\r\nconst router = Router();\r\nconst logger = new Logger('KnowledgeExtractionRoutes');\r\n// Use type assertion to bypass interface mismatch temporarily\r\nconst extractionService = new KnowledgeExtractionService(storage as any);\r\n\r\n// Schema für spezifische Quellen-Extraktion\r\nconst SpecificSourcesSchema = z.object({\r\n  sourceIds: z.array(z.string()).min(1, 'At least one source ID is required')\r\n});\r\n\r\n/**\r\n * GET /api/knowledge-extraction/status\r\n * Überprüft den aktuellen Status der Knowledge Base\r\n */\r\nrouter.get('/status', asyncHandler(async (req: Request, res: Response) => {\r\n  logger.info('Fetching knowledge extraction status');\r\n  \r\n  try {\r\n    const [articles, regulatoryUpdates, legalCases] = await Promise.all([\r\n      storage.getAllKnowledgeArticles(),\r\n      storage.getAllRegulatoryUpdates(),\r\n      storage.getAllLegalCases()\r\n    ]);\r\n\r\n    const autoExtractedArticles = articles.filter(article => \r\n      article.tags.includes('auto-extracted')\r\n    );\r\n\r\n    const needsReviewArticles = articles.filter(article => \r\n      article.tags.includes('needs-review')\r\n    );\r\n\r\n    const status = {\r\n      totalArticles: articles.length,\r\n      autoExtractedArticles: autoExtractedArticles.length,\r\n      needsReviewArticles: needsReviewArticles.length,\r\n      publishedArticles: articles.filter(a => a.isPublished).length,\r\n      draftArticles: articles.filter(a => !a.isPublished).length,\r\n      availableSourceData: {\r\n        regulatoryUpdates: regulatoryUpdates.length,\r\n        legalCases: legalCases.length,\r\n        totalSources: regulatoryUpdates.length + legalCases.length\r\n      },\r\n      extractionPotential: {\r\n        unprocessedRegulatory: regulatoryUpdates.filter(update => \r\n          !articles.some(article => article.title.includes(update.title.substring(0, 50)))\r\n        ).length,\r\n        unprocessedLegal: legalCases.filter(legalCase => \r\n          !articles.some(article => article.title.includes(legalCase.title.substring(0, 50)))\r\n        ).length\r\n      }\r\n    };\r\n\r\n    logger.info('Knowledge extraction status retrieved', {\r\n      totalArticles: status.totalArticles,\r\n      extractionPotential: status.extractionPotential\r\n    });\r\n\r\n    res.json(status);\r\n  } catch (error) {\r\n    logger.error('Failed to fetch knowledge extraction status', { error });\r\n    res.status(500).json({ \r\n      error: 'Failed to fetch status',\r\n      totalArticles: 0,\r\n      autoExtractedArticles: 0,\r\n      needsReviewArticles: 0,\r\n      publishedArticles: 0,\r\n      draftArticles: 0,\r\n      availableSourceData: {\r\n        regulatoryUpdates: 0,\r\n        legalCases: 0,\r\n        totalSources: 0\r\n      },\r\n      extractionPotential: {\r\n        unprocessedRegulatory: 0,\r\n        unprocessedLegal: 0\r\n      }\r\n    });\r\n  }\r\n}));\r\n\r\n/**\r\n * POST /api/knowledge-extraction/extract-all\r\n * Startet die vollständige Extraktion aller verfügbaren Artikel\r\n */\r\nrouter.post('/extract-all', asyncHandler(async (req: Request, res: Response) => {\r\n  logger.info('Starting full knowledge article extraction');\r\n  \r\n  try {\r\n    const stats = await extractionService.extractArticlesFromAllSources();\r\n    \r\n    logger.info('Full knowledge extraction completed', { \r\n      totalProcessed: stats.totalProcessed,\r\n      articlesExtracted: stats.articlesExtracted,\r\n      duplicatesSkipped: stats.duplicatesSkipped,\r\n      errorsEncountered: stats.errorsEncountered\r\n    });\r\n    \r\n    res.json(createApiResponse(true, {\r\n      message: 'Knowledge article extraction completed successfully',\r\n      stats\r\n    }));\r\n  } catch (error) {\r\n    logger.error('Failed to extract knowledge articles', { error });\r\n    res.status(500).json(createApiResponse(false, undefined, 'Knowledge extraction failed'));\r\n  }\r\n}));\r\n\r\n/**\r\n * POST /api/knowledge-extraction/extract-sources\r\n * Extrahiert Artikel aus spezifischen Datenquellen\r\n */\r\nrouter.post('/extract-sources', asyncHandler(async (req: Request, res: Response) => {\r\n  logger.info('Starting specific source extraction', { body: req.body });\r\n  \r\n  try {\r\n    const { sourceIds } = SpecificSourcesSchema.parse(req.body);\r\n    \r\n    const stats = await extractionService.extractFromSpecificSources(sourceIds);\r\n    \r\n    logger.info('Specific source extraction completed', { sourceIds, stats });\r\n    \r\n    res.json(createApiResponse(true, {\r\n      message: `Knowledge article extraction completed for ${sourceIds.length} sources`,\r\n      sourceIds,\r\n      stats\r\n    }));\r\n  } catch (error) {\r\n    logger.error('Failed to extract from specific sources', { error });\r\n    res.status(500).json(createApiResponse(false, undefined, 'Specific source extraction failed'));\r\n  }\r\n}));\r\n\r\n/**\r\n * GET /api/knowledge-extraction/preview\r\n * Zeigt eine Vorschau der extrahierbaren Artikel an\r\n */\r\nrouter.get('/preview', asyncHandler(async (req: Request, res: Response) => {\r\n  logger.info('Generating extraction preview');\r\n  \r\n  try {\r\n    const limit = parseInt(req.query.limit as string) || 10;\r\n    \r\n    const [regulatoryUpdates, legalCases, existingArticles] = await Promise.all([\r\n      storage.getRecentRegulatoryUpdates(limit),\r\n      storage.getAllLegalCases(),\r\n      storage.getAllKnowledgeArticles()\r\n    ]);\r\n\r\n    const recentLegalCases = legalCases.slice(0, limit);\r\n\r\n    // Extrahierbare Artikel identifizieren\r\n    const extractableRegulatory = regulatoryUpdates\r\n      .filter(update => update.url && update.title)\r\n      .filter(update => !existingArticles.some(article => \r\n        article.title.includes(update.title.substring(0, 50))\r\n      ))\r\n      .map(update => ({\r\n        id: update.id,\r\n        title: update.title,\r\n        source: update.source,\r\n        region: update.region,\r\n        type: 'regulatory',\r\n        url: update.url,\r\n        category: update.category\r\n      }));\r\n\r\n    const extractableLegal = recentLegalCases\r\n      .filter(legalCase => legalCase.title)\r\n      .filter(legalCase => !existingArticles.some(article => \r\n        article.title.includes(legalCase.title.substring(0, 50))\r\n      ))\r\n      .map(legalCase => ({\r\n        id: legalCase.id,\r\n        title: legalCase.title,\r\n        source: legalCase.court,\r\n        region: legalCase.jurisdiction,\r\n        type: 'legal',\r\n        url: `#legal-case-${legalCase.id}`,\r\n        category: 'Legal Case'\r\n      }));\r\n\r\n    const preview = {\r\n      extractableCount: extractableRegulatory.length + extractableLegal.length,\r\n      regulatory: extractableRegulatory,\r\n      legal: extractableLegal,\r\n      summary: {\r\n        totalExtractable: extractableRegulatory.length + extractableLegal.length,\r\n        regulatoryCount: extractableRegulatory.length,\r\n        legalCount: extractableLegal.length,\r\n        existingArticles: existingArticles.length\r\n      }\r\n    };\r\n\r\n    logger.info('Extraction preview generated', {\r\n      extractableCount: preview.extractableCount,\r\n      summary: preview.summary\r\n    });\r\n\r\n    res.json(createApiResponse(true, preview));\r\n  } catch (error) {\r\n    logger.error('Failed to generate extraction preview', { error });\r\n    res.status(500).json(createApiResponse(false, undefined, 'Failed to generate preview'));\r\n  }\r\n}));\r\n\r\n/**\r\n * DELETE /api/knowledge-extraction/auto-extracted\r\n * Löscht alle automatisch extrahierten Artikel (für Reset)\r\n */\r\nrouter.delete('/auto-extracted', asyncHandler(async (req: Request, res: Response) => {\r\n  logger.info('Deleting all auto-extracted knowledge articles');\r\n  \r\n  try {\r\n    const articles = await storage.getAllKnowledgeArticles();\r\n    const autoExtractedArticles = articles.filter(article => \r\n      article.tags.includes('auto-extracted')\r\n    );\r\n\r\n    let deletedCount = 0;\r\n    for (const article of autoExtractedArticles) {\r\n      await storage.deleteKnowledgeArticle(article.id);\r\n      deletedCount++;\r\n    }\r\n\r\n    logger.info('Auto-extracted articles deleted', { deletedCount });\r\n    \r\n    res.json(createApiResponse(true, {\r\n      message: `${deletedCount} auto-extracted articles deleted successfully`,\r\n      deletedCount\r\n    }));\r\n  } catch (error) {\r\n    logger.error('Failed to delete auto-extracted articles', { error });\r\n    res.status(500).json(createApiResponse(false, undefined, 'Failed to delete auto-extracted articles'));\r\n  }\r\n}));\r\n\r\nexport default router;"]}