{"version":3,"file":"newsletterExtractionService.js","sourceRoot":"","sources":["../../../server/services/newsletterExtractionService.ts"],"names":[],"mappings":"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","sourcesContent":["import { Logger } from './logger.service';\r\nimport { storage } from '../storage';\r\n\r\ninterface NewsletterSource {\r\n  id: string;\r\n  name: string;\r\n  url: string;\r\n  category: 'industry_newsletter' | 'regulatory_newsletter';\r\n  authority: string;\r\n  region: string;\r\n  language: string;\r\n  priority: 'high' | 'medium' | 'low';\r\n  extractorType: 'newsletter' | 'industry_news';\r\n  rssUrl?: string;\r\n  apiEndpoint?: string;\r\n}\r\n\r\ninterface NewsletterArticle {\r\n  title: string;\r\n  content: string;\r\n  summary: string;\r\n  url: string;\r\n  publishedAt: Date;\r\n  category: string;\r\n  tags: string[];\r\n  authority: string;\r\n  region: string;\r\n  language: string;\r\n  newsletterSource: string;\r\n}\r\n\r\n/**\r\n * Newsletter Extraction Service für MedTech-Informationsquellen\r\n * Sammelt Newsletter-Inhalte von Branchenverbänden und Informationsanbietern\r\n */\r\nexport class NewsletterExtractionService {\r\n  private logger = new Logger('NewsletterExtractionService');\r\n\r\n  private newsletterSources: NewsletterSource[] = [\r\n    // Deutsche MedTech Newsletter\r\n    {\r\n      id: 'bvmed_newsletter',\r\n      name: 'BVMed - Bundesverband Medizintechnologie',\r\n      url: 'https://www.bvmed.de/de/aktuelles/pressemitteilungen',\r\n      category: 'industry_newsletter',\r\n      authority: 'BVMed',\r\n      region: 'Germany',\r\n      language: 'de',\r\n      priority: 'high',\r\n      extractorType: 'newsletter',\r\n      rssUrl: 'https://www.bvmed.de/de/service/newsletter'\r\n    },\r\n    {\r\n      id: 'spectaris_medtech',\r\n      name: 'SPECTARIS - MedTech News Deutschland',\r\n      url: 'https://www.spectaris.de/presse-medien/pressemitteilungen/',\r\n      category: 'industry_newsletter', \r\n      authority: 'SPECTARIS',\r\n      region: 'Germany',\r\n      language: 'de',\r\n      priority: 'medium',\r\n      extractorType: 'newsletter'\r\n    },\r\n    {\r\n      id: 'medica_magazine',\r\n      name: 'MEDICA Magazine Newsletter',\r\n      url: 'https://www.medica.de/de/News',\r\n      category: 'industry_newsletter',\r\n      authority: 'MEDICA',\r\n      region: 'Germany',\r\n      language: 'de',\r\n      priority: 'high',\r\n      extractorType: 'newsletter'\r\n    },\r\n    {\r\n      id: 'mt_medizintechnik',\r\n      name: 'mt-medizintechnik Newsletter',\r\n      url: 'https://mt-medizintechnik.de/news/',\r\n      category: 'industry_newsletter',\r\n      authority: 'mt-medizintechnik',\r\n      region: 'Germany',\r\n      language: 'de',\r\n      priority: 'medium',\r\n      extractorType: 'newsletter'\r\n    },\r\n    \r\n    // Internationale MedTech Newsletter\r\n    {\r\n      id: 'medtech_dive',\r\n      name: 'MedTech Dive - Industry Newsletter',\r\n      url: 'https://www.medtechdive.com/',\r\n      category: 'industry_newsletter',\r\n      authority: 'Industry Dive',\r\n      region: 'Global',\r\n      language: 'en',\r\n      priority: 'high',\r\n      extractorType: 'newsletter',\r\n      rssUrl: 'https://www.medtechdive.com/feeds/'\r\n    },\r\n    {\r\n      id: 'medtech_breakthrough',\r\n      name: 'MedTech Breakthrough News',\r\n      url: 'https://medtechbreakthrough.com/news/',\r\n      category: 'industry_newsletter',\r\n      authority: 'MedTech Breakthrough',\r\n      region: 'Global',\r\n      language: 'en',\r\n      priority: 'high',\r\n      extractorType: 'industry_news'\r\n    },\r\n    {\r\n      id: 'meddevice_online',\r\n      name: 'Medical Device and Diagnostic Industry',\r\n      url: 'https://www.mddionline.com/',\r\n      category: 'industry_newsletter',\r\n      authority: 'MDDI',\r\n      region: 'Global',\r\n      language: 'en',\r\n      priority: 'high',\r\n      extractorType: 'industry_news'\r\n    },\r\n    {\r\n      id: 'medtech_europe',\r\n      name: 'MedTech Europe Newsletter',\r\n      url: 'https://www.medtecheurope.org/news-and-events/news/',\r\n      category: 'industry_newsletter',\r\n      authority: 'MedTech Europe',\r\n      region: 'European Union',\r\n      language: 'en',\r\n      priority: 'high',\r\n      extractorType: 'newsletter'\r\n    },\r\n    \r\n    // Regulatory Newsletter\r\n    {\r\n      id: 'emergo_newsletter',\r\n      name: 'Emergo by UL Newsletter',\r\n      url: 'https://www.emergobyul.com/newsletter',\r\n      category: 'regulatory_newsletter',\r\n      authority: 'Emergo by UL',\r\n      region: 'Global',\r\n      language: 'en',\r\n      priority: 'high',\r\n      extractorType: 'newsletter'\r\n    },\r\n    {\r\n      id: 'rephine_newsletter',\r\n      name: 'Rephine Regulatory Newsletter',\r\n      url: 'https://www.rephine.com/newsletter/',\r\n      category: 'regulatory_newsletter',\r\n      authority: 'Rephine',\r\n      region: 'European Union',\r\n      language: 'en',\r\n      priority: 'high',\r\n      extractorType: 'newsletter'\r\n    }\r\n  ];\r\n\r\n  /**\r\n   * Newsletter-Extraktion von authentischen MedTech-Quellen\r\n   * Aktiviert echte RSS-Feeds und Newsletter-APIs\r\n   */\r\n  async extractFromAllNewsletterSources(): Promise<{\r\n    processedSources: number;\r\n    articlesExtracted: number;\r\n    errors: string[];\r\n  }> {\r\n    this.logger.info('Starting authentic newsletter extraction from MedTech sources');\r\n\r\n    const results = {\r\n      processedSources: 0,\r\n      articlesExtracted: 0,\r\n      errors: [] as string[]\r\n    };\r\n\r\n    // Aktiviere echte Newsletter-Quellen\r\n    const activeNewsletterSources = this.newsletterSources.filter(source => \r\n      source.priority === 'high' && source.rssUrl\r\n    );\r\n\r\n    for (const source of activeNewsletterSources.slice(0, 3)) {\r\n      try {\r\n        this.logger.info(`Processing authentic newsletter source: ${source.name}`);\r\n        \r\n        // Echte RSS-Feed-Extraktion\r\n        const articles = await this.extractFromRSSFeed(source);\r\n        \r\n        for (const article of articles) {\r\n          await this.saveNewsletterToKnowledgeBase(article, source);\r\n          results.articlesExtracted++;\r\n        }\r\n        \r\n        results.processedSources++;\r\n        \r\n        await this.delay(2000);\r\n        \r\n      } catch (error: any) {\r\n        const errorMsg = `Error processing ${source.name}: ${error.message}`;\r\n        results.errors.push(errorMsg);\r\n        this.logger.error(errorMsg, error);\r\n      }\r\n    }\r\n\r\n    this.logger.info('Authentic newsletter extraction completed', results);\r\n    return results;\r\n  }\r\n\r\n  /**\r\n   * Extrahiert Newsletter-Artikel von einer spezifischen Quelle\r\n   * **PRODUCTION MODE**: Keine Demo-Daten mehr, nur echte RSS/API-Anbindung\r\n   */\r\n  private async extractNewsletterArticles(source: NewsletterSource): Promise<NewsletterArticle[]> {\r\n    this.logger.warn(`DEAKTIVIERT: ${source.name} - Keine Demo-Newsletter, nur echte RSS-Feeds`);\r\n\r\n    // **PRODUCTION MODE**: NO DEMO ARTICLES\r\n    return [];\r\n    \r\n    // Deutsche Quellen\r\n    if (source.language === 'de') {\r\n      demoArticles.push({\r\n        title: `${source.authority} Newsletter Update: Neue MDR-Anforderungen für 2025`,\r\n        content: `Aktuelle Entwicklungen in der Medizintechnik-Regulierung: ${source.authority} berichtet über neue MDR-Anforderungen, die 2025 in Kraft treten. Die wichtigsten Änderungen betreffen Klassifizierung von KI-gestützten Medizinprodukten, erweiterte Cybersecurity-Anforderungen und neue Post-Market-Surveillance-Verpflichtungen.`,\r\n        summary: `${source.authority} Newsletter über neue MDR-Anforderungen 2025`,\r\n        url: `${source.url}#newsletter-${Date.now()}`,\r\n        publishedAt: new Date(),\r\n        category: source.category,\r\n        tags: ['Newsletter', 'MDR', 'Regulierung', '2025', source.authority],\r\n        authority: source.authority,\r\n        region: source.region,\r\n        language: source.language,\r\n        newsletterSource: source.name\r\n      });\r\n\r\n      demoArticles.push({\r\n        title: `${source.authority} Branchen-Update: Digitalisierung in der MedTech`,\r\n        content: `Newsletter-Beitrag zur fortschreitenden Digitalisierung in der Medizintechnik-Branche. ${source.authority} analysiert aktuelle Trends bei vernetzten Medizinprodukten, KI-Integration und Digital Health Lösungen. Besonderer Fokus auf Cybersecurity und Datenschutz-Compliance.`,\r\n        summary: `${source.authority} über Digitalisierung und Digital Health Trends`,\r\n        url: `${source.url}#newsletter-digital-${Date.now()}`,\r\n        publishedAt: new Date(Date.now() - 86400000), // Gestern\r\n        category: source.category,\r\n        tags: ['Newsletter', 'Digitalisierung', 'Digital Health', 'KI', source.authority],\r\n        authority: source.authority,\r\n        region: source.region,\r\n        language: source.language,\r\n        newsletterSource: source.name\r\n      });\r\n    } else {\r\n      // Englische Quellen\r\n      demoArticles.push({\r\n        title: `${source.authority} Newsletter: Global MedTech Market Trends Q4 2024`,\r\n        content: `Latest newsletter from ${source.authority} covering global medical technology market trends for Q4 2024. Key topics include regulatory harmonization efforts, emerging market expansion, and breakthrough technologies in diagnostics and therapeutics. Special focus on AI/ML integration and personalized medicine advancements.`,\r\n        summary: `${source.authority} newsletter on global MedTech market trends`,\r\n        url: `${source.url}#newsletter-q4-${Date.now()}`,\r\n        publishedAt: new Date(),\r\n        category: source.category,\r\n        tags: ['Newsletter', 'Market Trends', 'Global', 'Q4 2024', source.authority],\r\n        authority: source.authority,\r\n        region: source.region,\r\n        language: source.language,\r\n        newsletterSource: source.name\r\n      });\r\n\r\n      demoArticles.push({\r\n        title: `${source.authority} Industry Update: Regulatory Changes and Compliance`,\r\n        content: `Newsletter update from ${source.authority} on recent regulatory changes affecting the medical device industry. Coverage includes FDA guidance updates, EU MDR implementation progress, and emerging cybersecurity requirements. Expert insights on compliance strategies and best practices.`,\r\n        summary: `${source.authority} on regulatory changes and compliance strategies`,\r\n        url: `${source.url}#newsletter-regulatory-${Date.now()}`,\r\n        publishedAt: new Date(Date.now() - 172800000), // 2 Tage her\r\n        category: source.category,\r\n        tags: ['Newsletter', 'Regulatory', 'Compliance', 'FDA', 'EU MDR', source.authority],\r\n        authority: source.authority,\r\n        region: source.region,\r\n        language: source.language,\r\n        newsletterSource: source.name\r\n      });\r\n    }\r\n\r\n    return demoArticles;\r\n  }\r\n\r\n  /**\r\n   * Speichert Newsletter-Artikel in der Knowledge Base\r\n   */\r\n  private async saveNewsletterToKnowledgeBase(article: NewsletterArticle, source: NewsletterSource): Promise<void> {\r\n    try {\r\n      const knowledgeArticle = {\r\n        title: article.title,\r\n        content: article.content,\r\n        category: article.category,\r\n        tags: JSON.stringify(article.tags),\r\n        source: article.newsletterSource,\r\n        authority: article.authority,\r\n        region: article.region,\r\n        priority: source.priority,\r\n        language: article.language,\r\n        summary: article.summary,\r\n        published_at: article.publishedAt,\r\n        is_published: true\r\n      };\r\n\r\n      // Prüfe auf Duplikate\r\n      const existingArticles = await storage.getAllKnowledgeArticles();\r\n      const isDuplicate = existingArticles.some(existing => \r\n        existing.title === article.title && \r\n        existing.authority === article.authority\r\n      );\r\n\r\n      if (!isDuplicate) {\r\n        await storage.createKnowledgeArticle(knowledgeArticle);\r\n        this.logger.info(`Saved newsletter article: ${article.title}`, {\r\n          source: source.name,\r\n          authority: article.authority,\r\n          category: article.category\r\n        });\r\n      } else {\r\n        this.logger.info(`Skipped duplicate newsletter article: ${article.title}`);\r\n      }\r\n\r\n    } catch (error: any) {\r\n      this.logger.error(`Failed to save newsletter article: ${article.title}`, error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Ruft Status aller Newsletter-Quellen ab\r\n   */\r\n  async getNewsletterSourcesStatus() {\r\n    return {\r\n      totalSources: this.newsletterSources.length,\r\n      sourcesByCategory: {\r\n        industry_newsletter: this.newsletterSources.filter(s => s.category === 'industry_newsletter').length,\r\n        regulatory_newsletter: this.newsletterSources.filter(s => s.category === 'regulatory_newsletter').length\r\n      },\r\n      sourcesByRegion: {\r\n        Germany: this.newsletterSources.filter(s => s.region === 'Germany').length,\r\n        'European Union': this.newsletterSources.filter(s => s.region === 'European Union').length,\r\n        Global: this.newsletterSources.filter(s => s.region === 'Global').length\r\n      },\r\n      sourcesByLanguage: {\r\n        de: this.newsletterSources.filter(s => s.language === 'de').length,\r\n        en: this.newsletterSources.filter(s => s.language === 'en').length\r\n      },\r\n      highPrioritySources: this.newsletterSources.filter(s => s.priority === 'high').length\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Einfacher RSS-Feed-Parser für echte Newsletter-Extraktion\r\n   */\r\n  private parseRSSContent(feedContent: string, source: NewsletterSource): any[] {\r\n    const articles: any[] = [];\r\n    \r\n    try {\r\n      // Einfache XML-Parsing für RSS-Feeds\r\n      const itemMatches = feedContent.match(/<item[^>]*>([\\s\\S]*?)<\\/item>/gi);\r\n      \r\n      if (!itemMatches) {\r\n        this.logger.warn(`No RSS items found in feed from ${source.name}`);\r\n        return [];\r\n      }\r\n      \r\n      for (const item of itemMatches.slice(0, 5)) { // Begrenzt auf 5 Artikel pro Quelle\r\n        const title = this.extractXMLContent(item, 'title');\r\n        const description = this.extractXMLContent(item, 'description');\r\n        const link = this.extractXMLContent(item, 'link');\r\n        const pubDate = this.extractXMLContent(item, 'pubDate');\r\n        \r\n        if (title && description) {\r\n          articles.push({\r\n            title: title.substring(0, 200),\r\n            content: description.substring(0, 1000),\r\n            summary: description.substring(0, 300),\r\n            url: link,\r\n            publishedAt: pubDate ? new Date(pubDate) : new Date(),\r\n            category: source.category,\r\n            tags: ['Newsletter', source.authority, 'RSS Feed'],\r\n            authority: source.authority,\r\n            region: source.region,\r\n            language: source.language,\r\n            newsletterSource: source.name\r\n          });\r\n        }\r\n      }\r\n      \r\n      this.logger.info(`Parsed ${articles.length} articles from RSS feed ${source.name}`);\r\n      return articles;\r\n      \r\n    } catch (error) {\r\n      this.logger.error(`Error parsing RSS content from ${source.name}:`, error);\r\n      return [];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Hilfsfunktion zum Extrahieren von XML-Inhalten\r\n   */\r\n  private extractXMLContent(xml: string, tag: string): string {\r\n    const regex = new RegExp(`<${tag}[^>]*>([\\\\s\\\\S]*?)<\\\\/${tag}>`, 'i');\r\n    const match = xml.match(regex);\r\n    return match ? match[1].replace(/<!\\[CDATA\\[(.*?)\\]\\]>/g, '$1').trim() : '';\r\n  }\r\n\r\n\r\n\r\n  /**\r\n   * Delay Hilfsfunktion\r\n   */\r\n  private delay(ms: number): Promise<void> {\r\n    return new Promise(resolve => setTimeout(resolve, ms));\r\n  }\r\n}"]}