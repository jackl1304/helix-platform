{"version":3,"file":"dataSourceIntegrationService.js","sourceRoot":"","sources":["../../../server/services/dataSourceIntegrationService.ts"],"names":[],"mappings":"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","sourcesContent":["import { storage } from '../storage';\r\nimport { enhancedFdaOpenApiService } from './enhancedFdaOpenApiService';\r\nimport { mhraScrapingService } from './mhraScrapingService';\r\nimport { openFdaDataExtractor } from './openFdaDataExtractor';\r\nimport { enhancedLegalAnalysisService } from './enhancedLegalAnalysisService';\r\nimport { intelligentDataQualityService } from './intelligentDataQualityService';\r\nimport { dataCollectionService } from './dataCollectionService';\r\nimport { logger } from './logger.service';\r\n\r\ninterface IntegrationResult {\r\n  success: boolean;\r\n  servicesRun: string[];\r\n  errors: string[];\r\n  dataCollected: {\r\n    regulatoryUpdates: number;\r\n    legalCases: number;\r\n    qualityScore: number;\r\n  };\r\n  recommendations: string[];\r\n}\r\n\r\ninterface ScheduledCollection {\r\n  sourceId: string;\r\n  service: string;\r\n  frequency: 'hourly' | 'daily' | 'weekly';\r\n  lastRun: Date;\r\n  nextRun: Date;\r\n  enabled: boolean;\r\n}\r\n\r\nexport class DataSourceIntegrationService {\r\n  private scheduledCollections: ScheduledCollection[] = [\r\n    {\r\n      sourceId: 'fda_510k',\r\n      service: 'enhancedFdaOpenApiService',\r\n      frequency: 'daily',\r\n      lastRun: new Date(0),\r\n      nextRun: new Date(),\r\n      enabled: true\r\n    },\r\n    {\r\n      sourceId: 'fda_recalls',\r\n      service: 'openFdaDataExtractor',\r\n      frequency: 'daily',\r\n      lastRun: new Date(0),\r\n      nextRun: new Date(),\r\n      enabled: true\r\n    },\r\n    {\r\n      sourceId: 'mhra_guidance',\r\n      service: 'mhraScrapingService',\r\n      frequency: 'daily',\r\n      lastRun: new Date(0),\r\n      nextRun: new Date(),\r\n      enabled: true\r\n    }\r\n  ];\r\n\r\n  async runComprehensiveDataCollection(): Promise<IntegrationResult> {\r\n    logger.info('[Data Integration] Starting comprehensive data collection...');\r\n\r\n    const result: IntegrationResult = {\r\n      success: false,\r\n      servicesRun: [],\r\n      errors: [],\r\n      dataCollected: {\r\n        regulatoryUpdates: 0,\r\n        legalCases: 0,\r\n        qualityScore: 0\r\n      },\r\n      recommendations: []\r\n    };\r\n\r\n    try {\r\n      // 1. Enhanced FDA Data Collection\r\n      try {\r\n        logger.info('[Data Integration] Running Enhanced FDA OpenAPI Service...');\r\n        await enhancedFdaOpenApiService.collect510kDevices(100);\r\n        await enhancedFdaOpenApiService.collectRecalls(50);\r\n        result.servicesRun.push('Enhanced FDA OpenAPI Service');\r\n        logger.info('[Data Integration] ✓ Enhanced FDA collection completed');\r\n      } catch (error) {\r\n        const errorMsg = `Enhanced FDA Service error: ${error}`;\r\n        result.errors.push(errorMsg);\r\n        logger.error('[Data Integration]', errorMsg);\r\n      }\r\n\r\n      // 2. OpenFDA Data Extractor\r\n      try {\r\n        logger.info('[Data Integration] Running OpenFDA Data Extractor...');\r\n        const extractorResults = await openFdaDataExtractor.runCompleteExtraction();\r\n        result.servicesRun.push('OpenFDA Data Extractor');\r\n        result.dataCollected.regulatoryUpdates += extractorResults.totalProcessed;\r\n        logger.info(`[Data Integration] ✓ OpenFDA extraction completed: ${extractorResults.totalProcessed} items`);\r\n      } catch (error) {\r\n        const errorMsg = `OpenFDA Extractor error: ${error}`;\r\n        result.errors.push(errorMsg);\r\n        logger.error('[Data Integration]', errorMsg);\r\n      }\r\n\r\n      // 3. MHRA Scraping Service\r\n      try {\r\n        logger.info('[Data Integration] Running MHRA Scraping Service...');\r\n        await mhraScrapingService.collectMHRADeviceRegistrations();\r\n        await mhraScrapingService.collectMHRASafetyAlerts();\r\n        result.servicesRun.push('MHRA Scraping Service');\r\n        logger.info('[Data Integration] ✓ MHRA collection completed');\r\n      } catch (error) {\r\n        const errorMsg = `MHRA Service error: ${error}`;\r\n        result.errors.push(errorMsg);\r\n        logger.error('[Data Integration]', errorMsg);\r\n      }\r\n\r\n      // 4. Enhanced Legal Analysis\r\n      try {\r\n        logger.info('[Data Integration] Running Enhanced Legal Analysis...');\r\n        const legalCases = await storage.getAllLegalCases();\r\n        const legalAnalysis = await enhancedLegalAnalysisService.analyzeLegalCases(legalCases);\r\n        const trendAnalysis = await enhancedLegalAnalysisService.analyzeLegalTrends(legalCases);\r\n        \r\n        result.servicesRun.push('Enhanced Legal Analysis Service');\r\n        result.dataCollected.legalCases = legalCases.length;\r\n        \r\n        // Add trend-based recommendations\r\n        result.recommendations.push(...trendAnalysis.preventiveRecommendations);\r\n        \r\n        logger.info(`[Data Integration] ✓ Legal analysis completed: ${legalCases.length} cases analyzed`);\r\n      } catch (error) {\r\n        const errorMsg = `Legal Analysis error: ${error}`;\r\n        result.errors.push(errorMsg);\r\n        logger.error('[Data Integration]', errorMsg);\r\n      }\r\n\r\n      // 5. Data Quality Assessment\r\n      try {\r\n        logger.info('[Data Integration] Running Intelligent Data Quality Assessment...');\r\n        const qualityReport = await intelligentDataQualityService.assessDataQuality();\r\n        \r\n        result.servicesRun.push('Intelligent Data Quality Service');\r\n        result.dataCollected.qualityScore = Math.round(qualityReport.overallScore * 100);\r\n        result.recommendations.push(...qualityReport.recommendations);\r\n        \r\n        // Run automatic cleanup if quality score is below threshold\r\n        if (qualityReport.overallScore < 0.8) {\r\n          logger.info('[Data Integration] Quality score below 80%, running automatic cleanup...');\r\n          const cleanupResults = await intelligentDataQualityService.performAutomaticCleanup();\r\n          result.recommendations.push(`Automated cleanup completed: ${cleanupResults.fixedIssues} issues fixed`);\r\n        }\r\n        \r\n        logger.info(`[Data Integration] ✓ Data quality assessment completed: ${result.dataCollected.qualityScore}% score`);\r\n      } catch (error) {\r\n        const errorMsg = `Data Quality Service error: ${error}`;\r\n        result.errors.push(errorMsg);\r\n        logger.error('[Data Integration]', errorMsg);\r\n      }\r\n\r\n      // 6. Global Data Collection (fallback for other sources)\r\n      try {\r\n        logger.info('[Data Integration] Running Global Data Collection Service...');\r\n        await dataCollectionService.collectAllGlobalData();\r\n        result.servicesRun.push('Global Data Collection Service');\r\n        logger.info('[Data Integration] ✓ Global data collection completed');\r\n      } catch (error) {\r\n        const errorMsg = `Global Data Collection error: ${error}`;\r\n        result.errors.push(errorMsg);\r\n        logger.error('[Data Integration]', errorMsg);\r\n      }\r\n\r\n      // Final assessment\r\n      result.success = result.errors.length < result.servicesRun.length / 2; // Success if majority of services succeeded\r\n      \r\n      // Update collection schedules\r\n      await this.updateCollectionSchedules();\r\n\r\n      // Generate final recommendations\r\n      if (result.dataCollected.qualityScore < 70) {\r\n        result.recommendations.unshift('Critical: Data quality below 70% - immediate attention required');\r\n      } else if (result.dataCollected.qualityScore < 85) {\r\n        result.recommendations.unshift('Warning: Data quality below 85% - optimization recommended');\r\n      }\r\n\r\n      if (result.errors.length > 0) {\r\n        result.recommendations.push(`${result.errors.length} service errors detected - review error logs`);\r\n      }\r\n\r\n      logger.info(`[Data Integration] Comprehensive collection completed: ${result.servicesRun.length} services run, ${result.errors.length} errors`);\r\n      \r\n    } catch (error) {\r\n      logger.error('[Data Integration] Critical error in comprehensive collection:', error);\r\n      result.errors.push(`Critical integration error: ${error}`);\r\n      result.success = false;\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  async runScheduledCollections(): Promise<void> {\r\n    logger.info('[Data Integration] Checking scheduled collections...');\r\n\r\n    const now = new Date();\r\n    const collectionsToRun = this.scheduledCollections.filter(sc => \r\n      sc.enabled && sc.nextRun <= now\r\n    );\r\n\r\n    if (collectionsToRun.length === 0) {\r\n      logger.info('[Data Integration] No scheduled collections due');\r\n      return;\r\n    }\r\n\r\n    logger.info(`[Data Integration] Running ${collectionsToRun.length} scheduled collections...`);\r\n\r\n    for (const collection of collectionsToRun) {\r\n      try {\r\n        logger.info(`[Data Integration] Running scheduled collection: ${collection.service} for ${collection.sourceId}`);\r\n        \r\n        switch (collection.service) {\r\n          case 'enhancedFdaOpenApiService':\r\n            await enhancedFdaOpenApiService.collect510kDevices(50);\r\n            break;\r\n          case 'openFdaDataExtractor':\r\n            await openFdaDataExtractor.extractDeviceRecalls(50);\r\n            break;\r\n          case 'mhraScrapingService':\r\n            await mhraScrapingService.collectMHRADeviceRegistrations();\r\n            break;\r\n          default:\r\n            logger.warn(`[Data Integration] Unknown service: ${collection.service}`);\r\n        }\r\n\r\n        // Update last run and calculate next run\r\n        collection.lastRun = now;\r\n        collection.nextRun = this.calculateNextRun(now, collection.frequency);\r\n        \r\n        logger.info(`[Data Integration] ✓ Scheduled collection completed: ${collection.service}`);\r\n        \r\n      } catch (error) {\r\n        logger.error(`[Data Integration] Scheduled collection failed: ${collection.service}`, error);\r\n      }\r\n    }\r\n  }\r\n\r\n  async getDataSourceStatus(): Promise<{\r\n    totalSources: number;\r\n    activeSources: number;\r\n    lastSync: Record<string, Date>;\r\n    collectionHealth: Record<string, 'healthy' | 'warning' | 'error'>;\r\n  }> {\r\n    try {\r\n      const sources = await storage.getAllDataSources();\r\n      const activeSources = sources.filter(s => s.is_active);\r\n      \r\n      const lastSync: Record<string, Date> = {};\r\n      const collectionHealth: Record<string, 'healthy' | 'warning' | 'error'> = {};\r\n      \r\n      for (const source of sources) {\r\n        if (source.last_sync_at) {\r\n          lastSync[source.id] = new Date(source.last_sync_at);\r\n          \r\n          // Determine health based on last sync\r\n          const hoursSinceSync = (Date.now() - new Date(source.last_sync_at).getTime()) / (1000 * 60 * 60);\r\n          \r\n          if (hoursSinceSync < 24) {\r\n            collectionHealth[source.id] = 'healthy';\r\n          } else if (hoursSinceSync < 72) {\r\n            collectionHealth[source.id] = 'warning';\r\n          } else {\r\n            collectionHealth[source.id] = 'error';\r\n          }\r\n        } else {\r\n          collectionHealth[source.id] = 'error';\r\n        }\r\n      }\r\n\r\n      return {\r\n        totalSources: sources.length,\r\n        activeSources: activeSources.length,\r\n        lastSync,\r\n        collectionHealth\r\n      };\r\n      \r\n    } catch (error) {\r\n      logger.error('[Data Integration] Error getting data source status:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  private calculateNextRun(from: Date, frequency: 'hourly' | 'daily' | 'weekly'): Date {\r\n    const next = new Date(from);\r\n    \r\n    switch (frequency) {\r\n      case 'hourly':\r\n        next.setHours(next.getHours() + 1);\r\n        break;\r\n      case 'daily':\r\n        next.setDate(next.getDate() + 1);\r\n        break;\r\n      case 'weekly':\r\n        next.setDate(next.getDate() + 7);\r\n        break;\r\n    }\r\n    \r\n    return next;\r\n  }\r\n\r\n  private async updateCollectionSchedules(): Promise<void> {\r\n    try {\r\n      // Update data source last sync times\r\n      for (const collection of this.scheduledCollections) {\r\n        if (collection.lastRun > new Date(0)) {\r\n          await storage.updateDataSourceLastSync(collection.sourceId, collection.lastRun);\r\n        }\r\n      }\r\n      \r\n      logger.info('[Data Integration] Collection schedules updated');\r\n    } catch (error) {\r\n      logger.error('[Data Integration] Error updating collection schedules:', error);\r\n    }\r\n  }\r\n\r\n  async getIntegrationMetrics(): Promise<{\r\n    totalDataPoints: number;\r\n    qualityScore: number;\r\n    sourceCoverage: number;\r\n    lastUpdate: Date;\r\n    trends: {\r\n      weekly: number;\r\n      monthly: number;\r\n      growth: number;\r\n    };\r\n  }> {\r\n    try {\r\n      const [regulatoryUpdates, legalCases, sources] = await Promise.all([\r\n        storage.getAllRegulatoryUpdates(),\r\n        storage.getAllLegalCases(),\r\n        storage.getAllDataSources()\r\n      ]);\r\n\r\n      const totalDataPoints = regulatoryUpdates.length + legalCases.length;\r\n      const activeSources = sources.filter(s => s.is_active).length;\r\n      const sourceCoverage = (activeSources / sources.length) * 100;\r\n\r\n      // Calculate recent trends\r\n      const now = new Date();\r\n      const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);\r\n      const monthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);\r\n\r\n      const weeklyUpdates = regulatoryUpdates.filter(u => \r\n        u.publishedAt && new Date(u.publishedAt) >= weekAgo\r\n      ).length;\r\n\r\n      const monthlyUpdates = regulatoryUpdates.filter(u => \r\n        u.publishedAt && new Date(u.publishedAt) >= monthAgo\r\n      ).length;\r\n\r\n      // Simple growth calculation\r\n      const growth = weeklyUpdates > 0 ? (weeklyUpdates / Math.max(monthlyUpdates - weeklyUpdates, 1)) * 100 : 0;\r\n\r\n      // Get quality score from last assessment\r\n      const qualityReport = await intelligentDataQualityService.assessDataQuality();\r\n\r\n      return {\r\n        totalDataPoints,\r\n        qualityScore: Math.round(qualityReport.overallScore * 100),\r\n        sourceCoverage: Math.round(sourceCoverage),\r\n        lastUpdate: new Date(),\r\n        trends: {\r\n          weekly: weeklyUpdates,\r\n          monthly: monthlyUpdates,\r\n          growth: Math.round(growth)\r\n        }\r\n      };\r\n\r\n    } catch (error) {\r\n      logger.error('[Data Integration] Error getting integration metrics:', error);\r\n      throw error;\r\n    }\r\n  }\r\n}\r\n\r\nexport const dataSourceIntegrationService = new DataSourceIntegrationService();"]}