{"version":3,"file":"openFdaDataExtractor.js","sourceRoot":"","sources":["../../../server/services/openFdaDataExtractor.ts"],"names":[],"mappings":"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","sourcesContent":["import { storage } from '../storage';\r\nimport { nlpService } from './nlpService';\r\nimport type { InsertRegulatoryUpdate } from '@shared/schema';\r\n\r\ninterface OpenFDARecall {\r\n  cfres_id?: string;\r\n  product_res_number?: string;\r\n  event_date_initiated?: string;\r\n  event_date_posted?: string;\r\n  recall_status?: string;\r\n  event_date_terminated?: string;\r\n  res_event_number?: string;\r\n  product_code?: string;\r\n  k_numbers?: string[];\r\n  product_description?: string;\r\n  code_info?: string;\r\n  recalling_firm?: string;\r\n  address_1?: string;\r\n  city?: string;\r\n  state?: string;\r\n  postal_code?: string;\r\n  additional_info_contact?: string;\r\n  reason_for_recall?: string;\r\n  root_cause_description?: string;\r\n  action?: string;\r\n  product_quantity?: string;\r\n  distribution_pattern?: string;\r\n  openfda?: {\r\n    device_name?: string;\r\n    medical_specialty_description?: string;\r\n    regulation_number?: string;\r\n    device_class?: string;\r\n    fei_number?: string[];\r\n    registration_number?: string[];\r\n    k_number?: string[];\r\n  };\r\n}\r\n\r\ninterface OpenFDAResponse {\r\n  meta: {\r\n    disclaimer: string;\r\n    terms: string;\r\n    license: string;\r\n    last_updated: string;\r\n    results: {\r\n      skip: number;\r\n      limit: number;\r\n      total: number;\r\n    };\r\n  };\r\n  results: OpenFDARecall[];\r\n}\r\n\r\nexport class OpenFDADataExtractor {\r\n  private baseUrl = 'https://api.fda.gov';\r\n  private rateLimitDelay = 1000; // 1 second between requests\r\n\r\n  async extractDeviceRecalls(limit: number = 100): Promise<void> {\r\n    console.log(`[OpenFDA Extractor] Starting device recalls extraction (limit: ${limit})`);\r\n    \r\n    try {\r\n      const endpoint = `${this.baseUrl}/device/recall.json?limit=${limit}`;\r\n      const response = await fetch(endpoint);\r\n      \r\n      if (!response.ok) {\r\n        throw new Error(`OpenFDA API error: ${response.status} ${response.statusText}`);\r\n      }\r\n      \r\n      const data: OpenFDAResponse = await response.json();\r\n      \r\n      if (!data.results || !Array.isArray(data.results)) {\r\n        throw new Error('Invalid OpenFDA response format');\r\n      }\r\n      \r\n      console.log(`[OpenFDA Extractor] Found ${data.results.length} recalls (total available: ${data.meta.results.total})`);\r\n      \r\n      let processedCount = 0;\r\n      for (const recall of data.results) {\r\n        try {\r\n          await this.processRecall(recall);\r\n          processedCount++;\r\n          \r\n          // Rate limiting\r\n          await this.delay(this.rateLimitDelay);\r\n        } catch (error) {\r\n          console.error(`[OpenFDA Extractor] Error processing recall ${recall.cfres_id}:`, error);\r\n        }\r\n      }\r\n      \r\n      console.log(`[OpenFDA Extractor] Successfully processed ${processedCount}/${data.results.length} recalls`);\r\n    } catch (error) {\r\n      console.error('[OpenFDA Extractor] Error extracting device recalls:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  async extractDevice510k(limit: number = 100): Promise<void> {\r\n    console.log(`[OpenFDA Extractor] Starting 510(k) extraction (limit: ${limit})`);\r\n    \r\n    try {\r\n      const endpoint = `${this.baseUrl}/device/510k.json?limit=${limit}&sort=date_received:desc`;\r\n      const response = await fetch(endpoint);\r\n      \r\n      if (!response.ok) {\r\n        throw new Error(`OpenFDA API error: ${response.status} ${response.statusText}`);\r\n      }\r\n      \r\n      const data = await response.json();\r\n      \r\n      if (!data.results || !Array.isArray(data.results)) {\r\n        throw new Error('Invalid OpenFDA 510k response format');\r\n      }\r\n      \r\n      console.log(`[OpenFDA Extractor] Found ${data.results.length} 510(k) clearances`);\r\n      \r\n      let processedCount = 0;\r\n      for (const device of data.results) {\r\n        try {\r\n          await this.process510kDevice(device);\r\n          processedCount++;\r\n          \r\n          // Rate limiting\r\n          await this.delay(this.rateLimitDelay);\r\n        } catch (error) {\r\n          console.error(`[OpenFDA Extractor] Error processing 510k device ${device.k_number}:`, error);\r\n        }\r\n      }\r\n      \r\n      console.log(`[OpenFDA Extractor] Successfully processed ${processedCount}/${data.results.length} 510(k) clearances`);\r\n    } catch (error) {\r\n      console.error('[OpenFDA Extractor] Error extracting 510k devices:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  async extractDevicePMA(limit: number = 50): Promise<void> {\r\n    console.log(`[OpenFDA Extractor] Starting PMA extraction (limit: ${limit})`);\r\n    \r\n    try {\r\n      const endpoint = `${this.baseUrl}/device/pma.json?limit=${limit}&sort=date_received:desc`;\r\n      const response = await fetch(endpoint);\r\n      \r\n      if (!response.ok) {\r\n        throw new Error(`OpenFDA API error: ${response.status} ${response.statusText}`);\r\n      }\r\n      \r\n      const data = await response.json();\r\n      \r\n      if (!data.results || !Array.isArray(data.results)) {\r\n        throw new Error('Invalid OpenFDA PMA response format');\r\n      }\r\n      \r\n      console.log(`[OpenFDA Extractor] Found ${data.results.length} PMA approvals`);\r\n      \r\n      let processedCount = 0;\r\n      for (const device of data.results) {\r\n        try {\r\n          await this.processPMADevice(device);\r\n          processedCount++;\r\n          \r\n          // Rate limiting\r\n          await this.delay(this.rateLimitDelay);\r\n        } catch (error) {\r\n          console.error(`[OpenFDA Extractor] Error processing PMA device ${device.pma_number}:`, error);\r\n        }\r\n      }\r\n      \r\n      console.log(`[OpenFDA Extractor] Successfully processed ${processedCount}/${data.results.length} PMA approvals`);\r\n    } catch (error) {\r\n      console.error('[OpenFDA Extractor] Error extracting PMA devices:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  private async processRecall(recall: OpenFDARecall): Promise<void> {\r\n    try {\r\n      const content = this.formatRecallContent(recall);\r\n      const categories = await nlpService.categorizeContent(content);\r\n      const sourceId = await this.getFDASourceId('recalls');\r\n\r\n      const regulatoryUpdate: InsertRegulatoryUpdate = {\r\n        title: `FDA Device Recall: ${recall.product_description || 'Medical Device'} (${recall.cfres_id || 'Unknown'})`,\r\n        content,\r\n        sourceId,\r\n        sourceUrl: this.generateRecallUrl(recall),\r\n        region: 'US',\r\n        updateType: 'recall',\r\n        priority: this.determineRecallPriority(recall),\r\n        deviceClasses: this.extractDeviceClasses(recall),\r\n        categories: [...categories.categories, 'Device Recall', 'Safety Alert'],\r\n        rawData: recall,\r\n        publishedAt: this.parseDate(recall.event_date_initiated || recall.event_date_posted) || new Date(),\r\n      };\r\n      \r\n      await storage.createRegulatoryUpdate(regulatoryUpdate);\r\n      console.log(`[OpenFDA Extractor] Created recall update: ${recall.product_description || 'Unknown Product'}`);\r\n    } catch (error) {\r\n      console.error('[OpenFDA Extractor] Error processing recall:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  private async process510kDevice(device: any): Promise<void> {\r\n    try {\r\n      const content = this.format510kContent(device);\r\n      const categories = await nlpService.categorizeContent(content);\r\n      const sourceId = await this.getFDASourceId('510k');\r\n\r\n      const regulatoryUpdate: InsertRegulatoryUpdate = {\r\n        title: `FDA 510(k) Clearance: ${device.device_name || 'Medical Device'} (${device.k_number || 'Unknown'})`,\r\n        content,\r\n        sourceId,\r\n        sourceUrl: this.generate510kUrl(device),\r\n        region: 'US',\r\n        updateType: 'approval',\r\n        priority: this.determine510kPriority(device),\r\n        deviceClasses: this.extract510kDeviceClasses(device),\r\n        categories: [...categories.categories, '510(k) Clearance', 'FDA Approval'],\r\n        rawData: device,\r\n        publishedAt: this.parseDate(device.date_received || device.decision_date) || new Date(),\r\n      };\r\n      \r\n      await storage.createRegulatoryUpdate(regulatoryUpdate);\r\n      console.log(`[OpenFDA Extractor] Created 510(k) update: ${device.device_name || 'Unknown Device'}`);\r\n    } catch (error) {\r\n      console.error('[OpenFDA Extractor] Error processing 510k device:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  private async processPMADevice(device: any): Promise<void> {\r\n    try {\r\n      const content = this.formatPMAContent(device);\r\n      const categories = await nlpService.categorizeContent(content);\r\n      const sourceId = await this.getFDASourceId('pma');\r\n\r\n      const regulatoryUpdate: InsertRegulatoryUpdate = {\r\n        title: `FDA PMA Approval: ${device.device_name || 'Medical Device'} (${device.pma_number || 'Unknown'})`,\r\n        content,\r\n        sourceId,\r\n        sourceUrl: this.generatePMAUrl(device),\r\n        region: 'US',\r\n        updateType: 'approval',\r\n        priority: 'high', // PMA is always high priority (Class III devices)\r\n        deviceClasses: this.extractPMADeviceClasses(device),\r\n        categories: [...categories.categories, 'PMA Approval', 'FDA Approval', 'Class III Device'],\r\n        rawData: device,\r\n        publishedAt: this.parseDate(device.date_received || device.decision_date) || new Date(),\r\n      };\r\n      \r\n      await storage.createRegulatoryUpdate(regulatoryUpdate);\r\n      console.log(`[OpenFDA Extractor] Created PMA update: ${device.device_name || 'Unknown Device'}`);\r\n    } catch (error) {\r\n      console.error('[OpenFDA Extractor] Error processing PMA device:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  private formatRecallContent(recall: OpenFDARecall): string {\r\n    const sections = [];\r\n    \r\n    sections.push(`=== FDA Device Recall Information ===`);\r\n    \r\n    if (recall.product_description) {\r\n      sections.push(`Product: ${recall.product_description}`);\r\n    }\r\n    \r\n    if (recall.reason_for_recall) {\r\n      sections.push(`\\nReason for Recall:\\n${recall.reason_for_recall}`);\r\n    }\r\n    \r\n    if (recall.recalling_firm) {\r\n      sections.push(`\\nRecalling Firm: ${recall.recalling_firm}`);\r\n    }\r\n    \r\n    if (recall.distribution_pattern) {\r\n      sections.push(`\\nDistribution Pattern: ${recall.distribution_pattern}`);\r\n    }\r\n    \r\n    if (recall.product_quantity) {\r\n      sections.push(`\\nProduct Quantity: ${recall.product_quantity}`);\r\n    }\r\n    \r\n    if (recall.recall_status) {\r\n      sections.push(`\\nRecall Status: ${recall.recall_status}`);\r\n    }\r\n    \r\n    if (recall.action) {\r\n      sections.push(`\\nAction Taken:\\n${recall.action}`);\r\n    }\r\n    \r\n    if (recall.code_info) {\r\n      sections.push(`\\nProduct Codes: ${recall.code_info}`);\r\n    }\r\n    \r\n    if (recall.k_numbers && recall.k_numbers.length > 0) {\r\n      sections.push(`\\nRelated 510(k) Numbers: ${recall.k_numbers.join(', ')}`);\r\n    }\r\n    \r\n    if (recall.openfda) {\r\n      sections.push(`\\n=== Additional Device Information ===`);\r\n      if (recall.openfda.device_class) {\r\n        sections.push(`Device Class: ${recall.openfda.device_class}`);\r\n      }\r\n      if (recall.openfda.medical_specialty_description) {\r\n        sections.push(`Medical Specialty: ${recall.openfda.medical_specialty_description}`);\r\n      }\r\n      if (recall.openfda.regulation_number) {\r\n        sections.push(`Regulation Number: ${recall.openfda.regulation_number}`);\r\n      }\r\n    }\r\n    \r\n    return sections.join('\\n');\r\n  }\r\n\r\n  private format510kContent(device: any): string {\r\n    const sections = [];\r\n    \r\n    sections.push(`=== FDA 510(k) Clearance Information ===`);\r\n    \r\n    if (device.device_name) {\r\n      sections.push(`Device Name: ${device.device_name}`);\r\n    }\r\n    \r\n    if (device.applicant) {\r\n      sections.push(`Applicant: ${device.applicant}`);\r\n    }\r\n    \r\n    if (device.decision) {\r\n      sections.push(`Decision: ${device.decision}`);\r\n    }\r\n    \r\n    if (device.statement_or_summary) {\r\n      sections.push(`\\nSummary:\\n${device.statement_or_summary}`);\r\n    }\r\n    \r\n    if (device.product_code) {\r\n      sections.push(`\\nProduct Code: ${device.product_code}`);\r\n    }\r\n    \r\n    if (device.regulation_number) {\r\n      sections.push(`Regulation Number: ${device.regulation_number}`);\r\n    }\r\n    \r\n    if (device.review_advisory_committee) {\r\n      sections.push(`Review Committee: ${device.review_advisory_committee}`);\r\n    }\r\n    \r\n    if (device.clearance_type) {\r\n      sections.push(`Clearance Type: ${device.clearance_type}`);\r\n    }\r\n    \r\n    if (device.expedited_review_flag === 'Y') {\r\n      sections.push(`Expedited Review: Yes`);\r\n    }\r\n    \r\n    if (device.third_party_flag === 'Y') {\r\n      sections.push(`Third Party Review: Yes`);\r\n    }\r\n    \r\n    if (device.openfda) {\r\n      sections.push(`\\n=== Device Classification ===`);\r\n      if (device.openfda.device_class) {\r\n        sections.push(`Device Class: ${device.openfda.device_class}`);\r\n      }\r\n      if (device.openfda.medical_specialty_description) {\r\n        sections.push(`Medical Specialty: ${device.openfda.medical_specialty_description}`);\r\n      }\r\n    }\r\n    \r\n    return sections.join('\\n');\r\n  }\r\n\r\n  private formatPMAContent(device: any): string {\r\n    const sections = [];\r\n    \r\n    sections.push(`=== FDA PMA Approval Information ===`);\r\n    \r\n    if (device.device_name) {\r\n      sections.push(`Device Name: ${device.device_name}`);\r\n    }\r\n    \r\n    if (device.applicant) {\r\n      sections.push(`Applicant: ${device.applicant}`);\r\n    }\r\n    \r\n    if (device.supplement_reason) {\r\n      sections.push(`Supplement Reason: ${device.supplement_reason}`);\r\n    }\r\n    \r\n    if (device.statement_or_summary) {\r\n      sections.push(`\\nSummary:\\n${device.statement_or_summary}`);\r\n    }\r\n    \r\n    if (device.product_code) {\r\n      sections.push(`\\nProduct Code: ${device.product_code}`);\r\n    }\r\n    \r\n    if (device.advisory_committee) {\r\n      sections.push(`Advisory Committee: ${device.advisory_committee}`);\r\n    }\r\n    \r\n    sections.push(`\\nNote: This is a Class III medical device requiring PMA approval, indicating the highest level of regulatory oversight.`);\r\n    \r\n    return sections.join('\\n');\r\n  }\r\n\r\n  private determineRecallPriority(recall: OpenFDARecall): 'high' | 'medium' | 'low' {\r\n    const riskIndicators = [\r\n      'death', 'life-threatening', 'serious injury', 'class i',\r\n      'immediate', 'urgent', 'critical', 'emergency'\r\n    ];\r\n    \r\n    const content = `${recall.reason_for_recall || ''} ${recall.action || ''}`.toLowerCase();\r\n    \r\n    if (riskIndicators.some(indicator => content.includes(indicator))) {\r\n      return 'high';\r\n    }\r\n    \r\n    if (recall.recall_status === 'Ongoing') {\r\n      return 'medium';\r\n    }\r\n    \r\n    return 'low';\r\n  }\r\n\r\n  private determine510kPriority(device: any): 'high' | 'medium' | 'low' {\r\n    if (device.expedited_review_flag === 'Y') {\r\n      return 'high';\r\n    }\r\n    \r\n    if (device.openfda?.device_class === 'Class II') {\r\n      return 'medium';\r\n    }\r\n    \r\n    return 'low';\r\n  }\r\n\r\n  private extractDeviceClasses(recall: OpenFDARecall): string[] {\r\n    const classes: string[] = [];\r\n    \r\n    if (recall.openfda?.device_class) {\r\n      classes.push(recall.openfda.device_class);\r\n    }\r\n    \r\n    if (recall.product_code) {\r\n      classes.push(`Product Code: ${recall.product_code}`);\r\n    }\r\n    \r\n    return classes.length > 0 ? classes : ['Unknown Class'];\r\n  }\r\n\r\n  private extract510kDeviceClasses(device: any): string[] {\r\n    const classes: string[] = [];\r\n    \r\n    if (device.openfda?.device_class) {\r\n      classes.push(device.openfda.device_class);\r\n    } else {\r\n      classes.push('Class II'); // Most 510(k) devices are Class II\r\n    }\r\n    \r\n    if (device.product_code) {\r\n      classes.push(`Product Code: ${device.product_code}`);\r\n    }\r\n    \r\n    return classes;\r\n  }\r\n\r\n  private extractPMADeviceClasses(device: any): string[] {\r\n    return ['Class III', `Product Code: ${device.product_code || 'Unknown'}`];\r\n  }\r\n\r\n  private generateRecallUrl(recall: OpenFDARecall): string {\r\n    if (recall.cfres_id) {\r\n      return `https://www.fda.gov/medical-devices/medical-device-recalls/recall-${recall.cfres_id}`;\r\n    }\r\n    return 'https://www.fda.gov/medical-devices/medical-device-recalls';\r\n  }\r\n\r\n  private generate510kUrl(device: any): string {\r\n    if (device.k_number) {\r\n      return `https://www.accessdata.fda.gov/scripts/cdrh/cfdocs/cfpmn/pmn.cfm?ID=${device.k_number}`;\r\n    }\r\n    return 'https://www.accessdata.fda.gov/scripts/cdrh/cfdocs/cfpmn/pmn.cfm';\r\n  }\r\n\r\n  private generatePMAUrl(device: any): string {\r\n    if (device.pma_number) {\r\n      return `https://www.accessdata.fda.gov/scripts/cdrh/cfdocs/cfpma/pma.cfm?ID=${device.pma_number}`;\r\n    }\r\n    return 'https://www.accessdata.fda.gov/scripts/cdrh/cfdocs/cfpma/pma.cfm';\r\n  }\r\n\r\n  private parseDate(dateString?: string): Date | null {\r\n    if (!dateString) return null;\r\n    try {\r\n      // Handle different date formats from FDA API\r\n      if (dateString.includes('-')) {\r\n        return new Date(dateString);\r\n      } else if (dateString.length === 8) {\r\n        // Format: YYYYMMDD\r\n        const year = parseInt(dateString.substring(0, 4));\r\n        const month = parseInt(dateString.substring(4, 6)) - 1;\r\n        const day = parseInt(dateString.substring(6, 8));\r\n        return new Date(year, month, day);\r\n      }\r\n      return new Date(dateString);\r\n    } catch {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  private async getFDASourceId(type: 'recalls' | '510k' | 'pma'): Promise<string> {\r\n    try {\r\n      const sources = await storage.getAllDataSources();\r\n      let sourceId: string;\r\n      \r\n      switch (type) {\r\n        case 'recalls':\r\n          sourceId = sources.find(s => s.id === 'fda_recalls' || s.name?.includes('FDA Recalls'))?.id || 'fda_recalls';\r\n          break;\r\n        case '510k':\r\n          sourceId = sources.find(s => s.id === 'fda_510k' || s.name?.includes('FDA 510'))?.id || 'fda_510k';\r\n          break;\r\n        case 'pma':\r\n          sourceId = sources.find(s => s.id === 'fda_pma' || s.name?.includes('FDA PMA'))?.id || 'fda_pma';\r\n          break;\r\n      }\r\n      \r\n      return sourceId;\r\n    } catch (error) {\r\n      console.error('Error getting FDA source ID:', error);\r\n      return `fda_${type}`;\r\n    }\r\n  }\r\n\r\n  private async delay(ms: number): Promise<void> {\r\n    return new Promise(resolve => setTimeout(resolve, ms));\r\n  }\r\n\r\n  async runCompleteExtraction(): Promise<{\r\n    recalls: number;\r\n    clearances510k: number;\r\n    pmaApprovals: number;\r\n    totalProcessed: number;\r\n  }> {\r\n    console.log('[OpenFDA Extractor] Starting complete FDA data extraction...');\r\n    \r\n    const results = {\r\n      recalls: 0,\r\n      clearances510k: 0,\r\n      pmaApprovals: 0,\r\n      totalProcessed: 0\r\n    };\r\n\r\n    try {\r\n      // Extract device recalls\r\n      await this.extractDeviceRecalls(100);\r\n      results.recalls = 100;\r\n      \r\n      // Extract 510(k) clearances\r\n      await this.extractDevice510k(100);\r\n      results.clearances510k = 100;\r\n      \r\n      // Extract PMA approvals\r\n      await this.extractDevicePMA(50);\r\n      results.pmaApprovals = 50;\r\n      \r\n      results.totalProcessed = results.recalls + results.clearances510k + results.pmaApprovals;\r\n      \r\n      console.log(`[OpenFDA Extractor] Complete extraction finished: ${results.totalProcessed} total items processed`);\r\n    } catch (error) {\r\n      console.error('[OpenFDA Extractor] Error during complete extraction:', error);\r\n      throw error;\r\n    }\r\n\r\n    return results;\r\n  }\r\n}\r\n\r\nexport const openFdaDataExtractor = new OpenFDADataExtractor();"]}