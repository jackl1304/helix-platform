{"version":3,"file":"predictiveAnalyticsService.js","sourceRoot":"","sources":["../../../server/services/predictiveAnalyticsService.ts"],"names":[],"mappings":"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","sourcesContent":["import { storage } from '../storage';\r\n\r\ninterface PredictionRequest {\r\n  deviceCategory?: string;\r\n  manufacturer?: string;\r\n  jurisdiction?: string;\r\n  timeHorizon: '30d' | '90d' | '180d' | '1y';\r\n  predictionType: 'safety_alerts' | 'approvals' | 'regulatory_changes' | 'market_trends';\r\n}\r\n\r\ninterface PredictionResult {\r\n  id: string;\r\n  predictionType: string;\r\n  targetPeriod: string;\r\n  confidence: number;\r\n  predictions: Prediction[];\r\n  riskFactors: RiskFactor[];\r\n  recommendations: string[];\r\n  basedOnDataPoints: number;\r\n  generatedAt: Date;\r\n}\r\n\r\ninterface Prediction {\r\n  event: string;\r\n  probability: number;\r\n  timeframe: string;\r\n  impactLevel: 'low' | 'medium' | 'high' | 'critical';\r\n  confidence: number;\r\n  supportingData: string[];\r\n}\r\n\r\ninterface RiskFactor {\r\n  factor: string;\r\n  severity: 'low' | 'medium' | 'high' | 'critical';\r\n  likelihood: number;\r\n  mitigationStrategies: string[];\r\n}\r\n\r\ninterface ComplianceRisk {\r\n  jurisdiction: string;\r\n  riskLevel: 'low' | 'medium' | 'high' | 'critical';\r\n  factors: string[];\r\n  timeline: string;\r\n  recommendations: string[];\r\n}\r\n\r\ninterface MarketOpportunity {\r\n  region: string;\r\n  deviceCategory: string;\r\n  opportunityScore: number;\r\n  timeline: string;\r\n  requirements: string[];\r\n  competitiveFactors: string[];\r\n}\r\n\r\nexport class PredictiveAnalyticsService {\r\n  private readonly minimumDataPoints = 10;\r\n  private readonly confidenceThreshold = 0.6;\r\n  \r\n  async generatePredictions(request: PredictionRequest): Promise<PredictionResult> {\r\n    try {\r\n      console.log(`[Predictive] Generating ${request.predictionType} predictions for ${request.timeHorizon}`);\r\n      \r\n      // Get historical data for analysis\r\n      const historicalData = await this.getHistoricalData(request);\r\n      \r\n      if (historicalData.length < this.minimumDataPoints) {\r\n        throw new Error(`Insufficient data for prediction (${historicalData.length} points, minimum ${this.minimumDataPoints})`);\r\n      }\r\n      \r\n      // Generate predictions based on type\r\n      const predictions = await this.analyzePredictionType(request, historicalData);\r\n      const riskFactors = await this.identifyRiskFactors(request, historicalData);\r\n      const recommendations = this.generateRecommendations(predictions, riskFactors);\r\n      \r\n      const result: PredictionResult = {\r\n        id: `prediction-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\r\n        predictionType: request.predictionType,\r\n        targetPeriod: request.timeHorizon,\r\n        confidence: this.calculateOverallConfidence(predictions),\r\n        predictions,\r\n        riskFactors,\r\n        recommendations,\r\n        basedOnDataPoints: historicalData.length,\r\n        generatedAt: new Date()\r\n      };\r\n      \r\n      console.log(`[Predictive] Generated ${predictions.length} predictions with ${result.confidence}% confidence`);\r\n      return result;\r\n    } catch (error) {\r\n      console.error('[Predictive] Error generating predictions:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  private async getHistoricalData(request: PredictionRequest): Promise<any[]> {\r\n    try {\r\n      const allUpdates = await storage.getAllRegulatoryUpdates();\r\n      const allLegalCases = await storage.getAllLegalCases();\r\n      \r\n      let filteredData = [...allUpdates];\r\n      \r\n      // Apply filters\r\n      if (request.deviceCategory) {\r\n        filteredData = filteredData.filter(item => \r\n          this.matchesDeviceCategory(item, request.deviceCategory!)\r\n        );\r\n      }\r\n      \r\n      if (request.manufacturer) {\r\n        filteredData = filteredData.filter(item => \r\n          this.matchesManufacturer(item, request.manufacturer!)\r\n        );\r\n      }\r\n      \r\n      if (request.jurisdiction) {\r\n        filteredData = filteredData.filter(item => \r\n          item.region?.toLowerCase().includes(request.jurisdiction!.toLowerCase()) ||\r\n          item.authority?.toLowerCase().includes(request.jurisdiction!.toLowerCase())\r\n        );\r\n      }\r\n      \r\n      // Include relevant legal cases for safety predictions\r\n      if (request.predictionType === 'safety_alerts') {\r\n        const relevantLegalCases = allLegalCases.filter(legalCase => {\r\n          if (request.deviceCategory) {\r\n            return this.matchesDeviceCategory(legalCase, request.deviceCategory);\r\n          }\r\n          return true;\r\n        });\r\n        filteredData.push(...relevantLegalCases);\r\n      }\r\n      \r\n      // Sort by date (most recent first)\r\n      return filteredData.sort((a, b) => \r\n        new Date(b.published_at || b.filed_date || 0).getTime() - \r\n        new Date(a.published_at || a.filed_date || 0).getTime()\r\n      );\r\n    } catch (error) {\r\n      console.error('[Predictive] Error getting historical data:', error);\r\n      return [];\r\n    }\r\n  }\r\n\r\n  private matchesDeviceCategory(item: any, category: string): boolean {\r\n    const content = (item.title + ' ' + item.content + ' ' + (item.device_type || '')).toLowerCase();\r\n    const categoryLower = category.toLowerCase();\r\n    \r\n    // Device category mapping\r\n    const categoryKeywords: Record<string, string[]> = {\r\n      'cardiac': ['cardiac', 'heart', 'pacemaker', 'defibrillator', 'stent'],\r\n      'orthopedic': ['orthopedic', 'bone', 'joint', 'hip', 'knee', 'spine'],\r\n      'diabetes': ['diabetes', 'insulin', 'glucose', 'cgm', 'blood sugar'],\r\n      'imaging': ['imaging', 'mri', 'ct', 'ultrasound', 'x-ray', 'scan'],\r\n      'software': ['software', 'ai', 'algorithm', 'digital', 'app'],\r\n      'ivd': ['diagnostic', 'test', 'assay', 'laboratory', 'biomarker']\r\n    };\r\n    \r\n    const keywords = categoryKeywords[categoryLower] || [categoryLower];\r\n    return keywords.some(keyword => content.includes(keyword));\r\n  }\r\n\r\n  private matchesManufacturer(item: any, manufacturer: string): boolean {\r\n    const content = (item.title + ' ' + item.content).toLowerCase();\r\n    return content.includes(manufacturer.toLowerCase());\r\n  }\r\n\r\n  private async analyzePredictionType(request: PredictionRequest, data: any[]): Promise<Prediction[]> {\r\n    switch (request.predictionType) {\r\n      case 'safety_alerts':\r\n        return this.predictSafetyAlerts(data, request.timeHorizon);\r\n      case 'approvals':\r\n        return this.predictApprovals(data, request.timeHorizon);\r\n      case 'regulatory_changes':\r\n        return this.predictRegulatoryChanges(data, request.timeHorizon);\r\n      case 'market_trends':\r\n        return this.predictMarketTrends(data, request.timeHorizon);\r\n      default:\r\n        throw new Error(`Unknown prediction type: ${request.predictionType}`);\r\n    }\r\n  }\r\n\r\n  private predictSafetyAlerts(data: any[], timeHorizon: string): Prediction[] {\r\n    const predictions: Prediction[] = [];\r\n    \r\n    // Analyze safety alert patterns\r\n    const safetyAlerts = data.filter(item => \r\n      this.isSafetyRelated(item.title + ' ' + item.content)\r\n    );\r\n    \r\n    const alertFrequency = this.calculateFrequency(safetyAlerts, timeHorizon);\r\n    \r\n    if (alertFrequency.trend === 'increasing') {\r\n      predictions.push({\r\n        event: 'Increased safety alert activity',\r\n        probability: Math.min(0.9, alertFrequency.rate * 1.2),\r\n        timeframe: this.getTimeframeFromHorizon(timeHorizon),\r\n        impactLevel: 'high',\r\n        confidence: 0.75,\r\n        supportingData: [\r\n          `${safetyAlerts.length} safety alerts in historical data`,\r\n          `${alertFrequency.rate.toFixed(2)} alerts per month trend`,\r\n          'Pattern analysis shows increasing regulatory scrutiny'\r\n        ]\r\n      });\r\n    }\r\n    \r\n    // Device-specific safety predictions\r\n    const deviceTypes = this.extractDeviceTypes(data);\r\n    for (const deviceType of deviceTypes.slice(0, 3)) { // Top 3 device types\r\n      const deviceAlerts = safetyAlerts.filter(alert => \r\n        this.matchesDeviceCategory(alert, deviceType)\r\n      );\r\n      \r\n      if (deviceAlerts.length >= 2) {\r\n        predictions.push({\r\n          event: `Potential safety concern for ${deviceType} devices`,\r\n          probability: Math.min(0.8, deviceAlerts.length / safetyAlerts.length + 0.3),\r\n          timeframe: this.getTimeframeFromHorizon(timeHorizon),\r\n          impactLevel: this.assessDeviceSafetyImpact(deviceType),\r\n          confidence: 0.65,\r\n          supportingData: [\r\n            `${deviceAlerts.length} historical alerts for ${deviceType}`,\r\n            'Similar device categories showing regulatory patterns',\r\n            'Post-market surveillance data indicates increased scrutiny'\r\n          ]\r\n        });\r\n      }\r\n    }\r\n    \r\n    return predictions;\r\n  }\r\n\r\n  private predictApprovals(data: any[], timeHorizon: string): Prediction[] {\r\n    const predictions: Prediction[] = [];\r\n    \r\n    // Analyze approval patterns\r\n    const approvals = data.filter(item => \r\n      this.isApprovalRelated(item.title + ' ' + item.content)\r\n    );\r\n    \r\n    const approvalFrequency = this.calculateFrequency(approvals, timeHorizon);\r\n    \r\n    predictions.push({\r\n      event: 'Device approval rate projection',\r\n      probability: 0.85,\r\n      timeframe: this.getTimeframeFromHorizon(timeHorizon),\r\n      impactLevel: 'medium',\r\n      confidence: 0.7,\r\n      supportingData: [\r\n        `${approvals.length} approvals in historical data`,\r\n        `Average ${approvalFrequency.rate.toFixed(1)} approvals per month`,\r\n        'Regulatory pathway analysis shows consistent patterns'\r\n      ]\r\n    });\r\n    \r\n    // Jurisdiction-specific approval predictions\r\n    const jurisdictions = Array.from(new Set(data.map(item => item.authority)));\r\n    for (const jurisdiction of jurisdictions.slice(0, 3)) {\r\n      const jurisdictionApprovals = approvals.filter(approval => \r\n        approval.authority === jurisdiction\r\n      );\r\n      \r\n      if (jurisdictionApprovals.length >= 3) {\r\n        predictions.push({\r\n          event: `${jurisdiction} approval timeline changes`,\r\n          probability: 0.6,\r\n          timeframe: this.getTimeframeFromHorizon(timeHorizon),\r\n          impactLevel: 'medium',\r\n          confidence: 0.6,\r\n          supportingData: [\r\n            `${jurisdictionApprovals.length} historical approvals`,\r\n            'Regulatory harmonization trends',\r\n            'Authority workload and priority shifts'\r\n          ]\r\n        });\r\n      }\r\n    }\r\n    \r\n    return predictions;\r\n  }\r\n\r\n  private predictRegulatoryChanges(data: any[], timeHorizon: string): Prediction[] {\r\n    const predictions: Prediction[] = [];\r\n    \r\n    // Analyze regulatory update patterns\r\n    const regulatoryUpdates = data.filter(item => \r\n      this.isRegulatoryChange(item.title + ' ' + item.content)\r\n    );\r\n    \r\n    const changeFrequency = this.calculateFrequency(regulatoryUpdates, timeHorizon);\r\n    \r\n    if (changeFrequency.trend === 'increasing') {\r\n      predictions.push({\r\n        event: 'Accelerated regulatory framework updates',\r\n        probability: 0.75,\r\n        timeframe: this.getTimeframeFromHorizon(timeHorizon),\r\n        impactLevel: 'high',\r\n        confidence: 0.8,\r\n        supportingData: [\r\n          `${regulatoryUpdates.length} regulatory changes identified`,\r\n          'Increasing frequency of framework updates',\r\n          'Global harmonization efforts driving changes'\r\n        ]\r\n      });\r\n    }\r\n    \r\n    // Technology-specific regulatory predictions\r\n    const emergingTechs = ['AI/ML', 'Digital Therapeutics', 'Personalized Medicine'];\r\n    for (const tech of emergingTechs) {\r\n      const techUpdates = data.filter(item => \r\n        this.matchesTechnology(item, tech)\r\n      );\r\n      \r\n      if (techUpdates.length >= 2) {\r\n        predictions.push({\r\n          event: `New ${tech} regulatory guidance`,\r\n          probability: 0.7,\r\n          timeframe: this.getTimeframeFromHorizon(timeHorizon),\r\n          impactLevel: 'high',\r\n          confidence: 0.65,\r\n          supportingData: [\r\n            `${techUpdates.length} related regulatory activities`,\r\n            'Technology adoption driving regulatory need',\r\n            'Industry stakeholder engagement increasing'\r\n          ]\r\n        });\r\n      }\r\n    }\r\n    \r\n    return predictions;\r\n  }\r\n\r\n  private predictMarketTrends(data: any[], timeHorizon: string): Prediction[] {\r\n    const predictions: Prediction[] = [];\r\n    \r\n    // Analyze market-impacting events\r\n    const marketEvents = data.filter(item => \r\n      this.hasMarketImpact(item.title + ' ' + item.content)\r\n    );\r\n    \r\n    predictions.push({\r\n      event: 'Market consolidation in regulated segments',\r\n      probability: 0.6,\r\n      timeframe: this.getTimeframeFromHorizon(timeHorizon),\r\n      impactLevel: 'medium',\r\n      confidence: 0.55,\r\n      supportingData: [\r\n        `${marketEvents.length} market-impacting regulatory events`,\r\n        'Regulatory complexity driving consolidation',\r\n        'Compliance cost pressures on smaller players'\r\n      ]\r\n    });\r\n    \r\n    // Regional market predictions\r\n    const regions = Array.from(new Set(data.map(item => item.region))).filter(Boolean);\r\n    for (const region of regions.slice(0, 3)) {\r\n      const regionData = data.filter(item => item.region === region);\r\n      \r\n      if (regionData.length >= 5) {\r\n        predictions.push({\r\n          event: `${region} market access opportunities`,\r\n          probability: 0.65,\r\n          timeframe: this.getTimeframeFromHorizon(timeHorizon),\r\n          impactLevel: 'medium',\r\n          confidence: 0.6,\r\n          supportingData: [\r\n            `${regionData.length} regulatory activities in ${region}`,\r\n            'Regulatory pathway clarity improving',\r\n            'Market access barriers being addressed'\r\n          ]\r\n        });\r\n      }\r\n    }\r\n    \r\n    return predictions;\r\n  }\r\n\r\n  private isSafetyRelated(content: string): boolean {\r\n    const safetyKeywords = ['safety', 'recall', 'alert', 'warning', 'adverse', 'incident', 'malfunction'];\r\n    return safetyKeywords.some(keyword => content.toLowerCase().includes(keyword));\r\n  }\r\n\r\n  private isApprovalRelated(content: string): boolean {\r\n    const approvalKeywords = ['approval', 'clearance', 'authorized', 'approved', '510(k)', 'pma', 'ce mark'];\r\n    return approvalKeywords.some(keyword => content.toLowerCase().includes(keyword));\r\n  }\r\n\r\n  private isRegulatoryChange(content: string): boolean {\r\n    const changeKeywords = ['guidance', 'regulation', 'standard', 'requirement', 'framework', 'policy'];\r\n    return changeKeywords.some(keyword => content.toLowerCase().includes(keyword));\r\n  }\r\n\r\n  private hasMarketImpact(content: string): boolean {\r\n    const marketKeywords = ['market', 'competition', 'industry', 'economic', 'commercial', 'business'];\r\n    return marketKeywords.some(keyword => content.toLowerCase().includes(keyword));\r\n  }\r\n\r\n  private matchesTechnology(item: any, tech: string): boolean {\r\n    const content = (item.title + ' ' + item.content).toLowerCase();\r\n    const techKeywords: Record<string, string[]> = {\r\n      'AI/ML': ['artificial intelligence', 'machine learning', 'ai', 'ml', 'algorithm'],\r\n      'Digital Therapeutics': ['digital therapeutic', 'dtx', 'app', 'software treatment'],\r\n      'Personalized Medicine': ['personalized', 'precision', 'genomic', 'biomarker', 'companion diagnostic']\r\n    };\r\n    \r\n    const keywords = techKeywords[tech] || [tech.toLowerCase()];\r\n    return keywords.some(keyword => content.includes(keyword));\r\n  }\r\n\r\n  private calculateFrequency(data: any[], timeHorizon: string): { rate: number; trend: 'increasing' | 'stable' | 'decreasing' } {\r\n    if (data.length === 0) return { rate: 0, trend: 'stable' };\r\n    \r\n    // Calculate monthly rate\r\n    const months = this.getMonthsFromHorizon(timeHorizon);\r\n    const rate = data.length / months;\r\n    \r\n    // Simple trend analysis\r\n    const sortedData = data.sort((a, b) => \r\n      new Date(a.published_at || a.filed_date || 0).getTime() - \r\n      new Date(b.published_at || b.filed_date || 0).getTime()\r\n    );\r\n    \r\n    const midpoint = Math.floor(sortedData.length / 2);\r\n    const firstHalf = sortedData.slice(0, midpoint);\r\n    const secondHalf = sortedData.slice(midpoint);\r\n    \r\n    let trend: 'increasing' | 'stable' | 'decreasing' = 'stable';\r\n    if (secondHalf.length > firstHalf.length * 1.2) trend = 'increasing';\r\n    else if (firstHalf.length > secondHalf.length * 1.2) trend = 'decreasing';\r\n    \r\n    return { rate, trend };\r\n  }\r\n\r\n  private extractDeviceTypes(data: any[]): string[] {\r\n    const deviceTypes: Record<string, number> = {};\r\n    \r\n    for (const item of data) {\r\n      const content = (item.title + ' ' + item.content).toLowerCase();\r\n      \r\n      // Extract common device types\r\n      const types = ['cardiac', 'orthopedic', 'diabetes', 'imaging', 'software', 'ivd'];\r\n      for (const type of types) {\r\n        if (this.matchesDeviceCategory(item, type)) {\r\n          deviceTypes[type] = (deviceTypes[type] || 0) + 1;\r\n        }\r\n      }\r\n    }\r\n    \r\n    return Object.entries(deviceTypes)\r\n      .sort(([,a], [,b]) => b - a)\r\n      .map(([type]) => type);\r\n  }\r\n\r\n  private assessDeviceSafetyImpact(deviceType: string): 'low' | 'medium' | 'high' | 'critical' {\r\n    const highRiskDevices = ['cardiac', 'implantable', 'life support'];\r\n    const mediumRiskDevices = ['orthopedic', 'surgical', 'diabetes'];\r\n    \r\n    if (highRiskDevices.some(risk => deviceType.includes(risk))) return 'critical';\r\n    if (mediumRiskDevices.some(risk => deviceType.includes(risk))) return 'high';\r\n    return 'medium';\r\n  }\r\n\r\n  private getTimeframeFromHorizon(horizon: string): string {\r\n    const timeframes: Record<string, string> = {\r\n      '30d': 'Next 30 days',\r\n      '90d': 'Next 3 months',\r\n      '180d': 'Next 6 months',\r\n      '1y': 'Next 12 months'\r\n    };\r\n    return timeframes[horizon] || 'Future period';\r\n  }\r\n\r\n  private getMonthsFromHorizon(horizon: string): number {\r\n    const months: Record<string, number> = {\r\n      '30d': 1,\r\n      '90d': 3,\r\n      '180d': 6,\r\n      '1y': 12\r\n    };\r\n    return months[horizon] || 3;\r\n  }\r\n\r\n  private async identifyRiskFactors(request: PredictionRequest, data: any[]): Promise<RiskFactor[]> {\r\n    const riskFactors: RiskFactor[] = [];\r\n    \r\n    // High-priority items risk\r\n    const highPriorityItems = data.filter(item => \r\n      item.priority === 'high' || item.priority === 'critical'\r\n    );\r\n    \r\n    if (highPriorityItems.length > data.length * 0.2) {\r\n      riskFactors.push({\r\n        factor: 'High volume of critical regulatory activity',\r\n        severity: 'high',\r\n        likelihood: 0.8,\r\n        mitigationStrategies: [\r\n          'Implement enhanced monitoring protocols',\r\n          'Increase regulatory affairs staffing',\r\n          'Establish rapid response procedures'\r\n        ]\r\n      });\r\n    }\r\n    \r\n    // Jurisdiction concentration risk\r\n    const authorities = data.map(item => item.authority);\r\n    const authorityFreq = authorities.reduce((acc: Record<string, number>, auth) => {\r\n      acc[auth] = (acc[auth] || 0) + 1;\r\n      return acc;\r\n    }, {});\r\n    \r\n    const maxAuthorityShare = Math.max(...Object.values(authorityFreq)) / data.length;\r\n    if (maxAuthorityShare > 0.6) {\r\n      riskFactors.push({\r\n        factor: 'Over-concentration in single jurisdiction',\r\n        severity: 'medium',\r\n        likelihood: 0.7,\r\n        mitigationStrategies: [\r\n          'Diversify regulatory portfolio across jurisdictions',\r\n          'Develop regional expertise',\r\n          'Monitor regulatory harmonization trends'\r\n        ]\r\n      });\r\n    }\r\n    \r\n    return riskFactors;\r\n  }\r\n\r\n  private calculateOverallConfidence(predictions: Prediction[]): number {\r\n    if (predictions.length === 0) return 0;\r\n    \r\n    const avgConfidence = predictions.reduce((sum, pred) => sum + pred.confidence, 0) / predictions.length;\r\n    return Math.round(avgConfidence * 100);\r\n  }\r\n\r\n  private generateRecommendations(predictions: Prediction[], riskFactors: RiskFactor[]): string[] {\r\n    const recommendations: string[] = [];\r\n    \r\n    // High-probability predictions\r\n    const highProbPredictions = predictions.filter(p => p.probability > 0.7);\r\n    if (highProbPredictions.length > 0) {\r\n      recommendations.push('Prioritize preparation for high-probability regulatory events');\r\n    }\r\n    \r\n    // High-impact predictions\r\n    const highImpactPredictions = predictions.filter(p => \r\n      p.impactLevel === 'high' || p.impactLevel === 'critical'\r\n    );\r\n    if (highImpactPredictions.length > 0) {\r\n      recommendations.push('Develop contingency plans for high-impact regulatory scenarios');\r\n    }\r\n    \r\n    // Risk factor mitigation\r\n    const highSeverityRisks = riskFactors.filter(r => r.severity === 'high' || r.severity === 'critical');\r\n    if (highSeverityRisks.length > 0) {\r\n      recommendations.push('Implement immediate risk mitigation strategies for identified factors');\r\n    }\r\n    \r\n    // General recommendations\r\n    recommendations.push('Maintain continuous monitoring of regulatory landscape');\r\n    recommendations.push('Regular review and update of predictive models based on new data');\r\n    \r\n    return recommendations;\r\n  }\r\n\r\n  async generateComplianceRiskAssessment(jurisdiction?: string): Promise<ComplianceRisk[]> {\r\n    try {\r\n      console.log('[Predictive] Generating compliance risk assessment');\r\n      \r\n      const allUpdates = await storage.getAllRegulatoryUpdates();\r\n      const jurisdictions = jurisdiction ? [jurisdiction] : \r\n        Array.from(new Set(allUpdates.map(u => u.authority))).slice(0, 5);\r\n      \r\n      const risks: ComplianceRisk[] = [];\r\n      \r\n      for (const juris of jurisdictions) {\r\n        const jurisdictionData = allUpdates.filter(u => u.authority === juris);\r\n        const riskLevel = this.assessJurisdictionRisk(jurisdictionData);\r\n        \r\n        risks.push({\r\n          jurisdiction: juris,\r\n          riskLevel,\r\n          factors: this.identifyJurisdictionRiskFactors(jurisdictionData),\r\n          timeline: 'Next 6 months',\r\n          recommendations: this.generateJurisdictionRecommendations(juris, riskLevel)\r\n        });\r\n      }\r\n      \r\n      console.log(`[Predictive] Generated compliance risk assessment for ${risks.length} jurisdictions`);\r\n      return risks;\r\n    } catch (error) {\r\n      console.error('[Predictive] Error generating compliance risk assessment:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  private assessJurisdictionRisk(data: any[]): 'low' | 'medium' | 'high' | 'critical' {\r\n    const recentData = data.filter(item => {\r\n      const itemDate = new Date(item.published_at || 0);\r\n      const sixMonthsAgo = new Date(Date.now() - 6 * 30 * 24 * 60 * 60 * 1000);\r\n      return itemDate > sixMonthsAgo;\r\n    });\r\n    \r\n    const highPriorityCount = recentData.filter(item => \r\n      item.priority === 'high' || item.priority === 'critical'\r\n    ).length;\r\n    \r\n    if (highPriorityCount > 5) return 'critical';\r\n    if (highPriorityCount > 2) return 'high';\r\n    if (recentData.length > 10) return 'medium';\r\n    return 'low';\r\n  }\r\n\r\n  private identifyJurisdictionRiskFactors(data: any[]): string[] {\r\n    const factors: string[] = [];\r\n    \r\n    const safetyCount = data.filter(item => this.isSafetyRelated(item.title + ' ' + item.content)).length;\r\n    if (safetyCount > data.length * 0.3) {\r\n      factors.push('High volume of safety-related regulatory activity');\r\n    }\r\n    \r\n    const recentChanges = data.filter(item => {\r\n      const itemDate = new Date(item.published_at || 0);\r\n      const threeMonthsAgo = new Date(Date.now() - 3 * 30 * 24 * 60 * 60 * 1000);\r\n      return itemDate > threeMonthsAgo && this.isRegulatoryChange(item.title + ' ' + item.content);\r\n    }).length;\r\n    \r\n    if (recentChanges > 3) {\r\n      factors.push('Frequent regulatory framework updates');\r\n    }\r\n    \r\n    return factors;\r\n  }\r\n\r\n  private generateJurisdictionRecommendations(jurisdiction: string, riskLevel: string): string[] {\r\n    const recommendations: string[] = [];\r\n    \r\n    switch (riskLevel) {\r\n      case 'critical':\r\n        recommendations.push('Immediate compliance audit recommended');\r\n        recommendations.push('Dedicated regulatory specialist assignment');\r\n        break;\r\n      case 'high':\r\n        recommendations.push('Enhanced monitoring and quarterly reviews');\r\n        recommendations.push('Proactive engagement with regulatory consultants');\r\n        break;\r\n      case 'medium':\r\n        recommendations.push('Regular compliance checks and updates');\r\n        recommendations.push('Monitor for emerging regulatory trends');\r\n        break;\r\n      case 'low':\r\n        recommendations.push('Maintain standard monitoring protocols');\r\n        break;\r\n    }\r\n    \r\n    recommendations.push(`Stay informed on ${jurisdiction} regulatory developments`);\r\n    return recommendations;\r\n  }\r\n}"]}