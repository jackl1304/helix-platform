{"version":3,"file":"legalAnalysisService.js","sourceRoot":"","sources":["../../../server/services/legalAnalysisService.ts"],"names":[],"mappings":"AAoBA,MAAM,OAAO,oBAAoB;IAAjC;QAEU,gBAAW,GAAG;YACpB,gBAAgB,EAAE;gBAChB,QAAQ,EAAE,CAAC,mBAAmB,EAAE,kBAAkB,EAAE,wBAAwB,EAAE,eAAe,EAAE,sBAAsB,CAAC;gBACtH,SAAS,EAAE,MAAM;gBACjB,WAAW,EAAE,mDAAmD;aACjE;YACD,2BAA2B,EAAE;gBAC3B,QAAQ,EAAE,CAAC,eAAe,EAAE,mBAAmB,EAAE,oBAAoB,EAAE,2BAA2B,EAAE,yBAAyB,CAAC;gBAC9H,SAAS,EAAE,MAAM;gBACjB,WAAW,EAAE,4CAA4C;aAC1D;YACD,mBAAmB,EAAE;gBACnB,QAAQ,EAAE,CAAC,gBAAgB,EAAE,kBAAkB,EAAE,kBAAkB,EAAE,wBAAwB,EAAE,gBAAgB,CAAC;gBAChH,SAAS,EAAE,QAAQ;gBACnB,WAAW,EAAE,yCAAyC;aACvD;YACD,gBAAgB,EAAE;gBAChB,QAAQ,EAAE,CAAC,qBAAqB,EAAE,uBAAuB,EAAE,WAAW,EAAE,WAAW,EAAE,WAAW,CAAC;gBACjG,SAAS,EAAE,QAAQ;gBACnB,WAAW,EAAE,qCAAqC;aACnD;YACD,aAAa,EAAE;gBACb,QAAQ,EAAE,CAAC,MAAM,EAAE,OAAO,EAAE,iBAAiB,EAAE,SAAS,EAAE,eAAe,EAAE,aAAa,CAAC;gBACzF,SAAS,EAAE,MAAM;gBACjB,WAAW,EAAE,kCAAkC;aAChD;YACD,mBAAmB,EAAE;gBACnB,QAAQ,EAAE,CAAC,yBAAyB,EAAE,kBAAkB,EAAE,WAAW,EAAE,kBAAkB,EAAE,cAAc,CAAC;gBAC1G,SAAS,EAAE,MAAM;gBACjB,WAAW,EAAE,gEAAgE;aAC9E;YACD,eAAe,EAAE;gBACf,QAAQ,EAAE,CAAC,eAAe,EAAE,aAAa,EAAE,wBAAwB,EAAE,cAAc,EAAE,eAAe,CAAC;gBACrG,SAAS,EAAE,MAAM;gBACjB,WAAW,EAAE,qCAAqC;aACnD;YACD,kBAAkB,EAAE;gBAClB,QAAQ,EAAE,CAAC,0BAA0B,EAAE,qBAAqB,EAAE,QAAQ,EAAE,mBAAmB,EAAE,qBAAqB,CAAC;gBACnH,SAAS,EAAE,QAAQ;gBACnB,WAAW,EAAE,uCAAuC;aACrD;SACF,CAAC;QAEM,kBAAa,GAAG;YACtB,IAAI,EAAE,CAAC,eAAe,EAAE,KAAK,EAAE,KAAK,EAAE,SAAS,CAAC;YAChD,IAAI,EAAE,CAAC,gBAAgB,EAAE,QAAQ,EAAE,KAAK,EAAE,KAAK,EAAE,SAAS,CAAC;YAC3D,IAAI,EAAE,CAAC,SAAS,EAAE,aAAa,EAAE,OAAO,EAAE,QAAQ,CAAC;YACnD,IAAI,EAAE,CAAC,gBAAgB,EAAE,SAAS,EAAE,MAAM,EAAE,SAAS,CAAC;YACtD,IAAI,EAAE,CAAC,aAAa,EAAE,YAAY,EAAE,OAAO,CAAC;YAC5C,IAAI,EAAE,CAAC,QAAQ,EAAE,eAAe,EAAE,UAAU,CAAC;YAC7C,IAAI,EAAE,CAAC,WAAW,EAAE,KAAK,EAAE,YAAY,CAAC;YACxC,IAAI,EAAE,CAAC,OAAO,EAAE,MAAM,EAAE,UAAU,CAAC;SACpC,CAAC;IAmVJ,CAAC;IAjVC,KAAK,CAAC,gBAAgB,CAAC,SAAoB;QACzC,IAAI,CAAC;YACH,MAAM,QAAQ,GAAG,GAAG,SAAS,CAAC,KAAK,IAAI,SAAS,CAAC,OAAO,IAAI,SAAS,CAAC,SAAS,EAAE,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE,EAAE,CAAC,WAAW,EAAE,CAAC;YAEjH,MAAM,MAAM,GAAa,EAAE,CAAC;YAC5B,IAAI,cAAc,GAAG,kBAAkB,CAAC;YACxC,IAAI,cAAc,GAA8B,QAAQ,CAAC;YACzD,MAAM,WAAW,GAAa,EAAE,CAAC;YACjC,MAAM,gBAAgB,GAAa,EAAE,CAAC;YAGtC,IAAI,YAAY,GAAG,KAAK,CAAC;YACzB,KAAK,MAAM,CAAC,KAAK,EAAE,IAAI,CAAC,IAAI,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC,WAAW,CAAC,EAAE,CAAC;gBAC7D,IAAI,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,QAAQ,CAAC,QAAQ,CAAC,OAAO,CAAC,WAAW,EAAE,CAAC,CAAC,EAAE,CAAC;oBAC5E,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;oBACnB,IAAI,IAAI,CAAC,SAAS,KAAK,MAAM,EAAE,CAAC;wBAC9B,YAAY,GAAG,MAAM,CAAC;wBACtB,cAAc,GAAG,MAAM,CAAC;oBAC1B,CAAC;yBAAM,IAAI,IAAI,CAAC,SAAS,KAAK,QAAQ,IAAI,YAAY,KAAK,MAAM,EAAE,CAAC;wBAClE,YAAY,GAAG,QAAQ,CAAC;wBACxB,IAAI,cAAc,KAAK,KAAK;4BAAE,cAAc,GAAG,QAAQ,CAAC;oBAC1D,CAAC;gBACH,CAAC;YACH,CAAC;YAGD,IAAI,YAAY,KAAK,MAAM,EAAE,CAAC;gBAC5B,cAAc,GAAG,iDAAiD,CAAC;gBACnE,WAAW,CAAC,IAAI,CAAC,iDAAiD,CAAC,CAAC;gBACpE,WAAW,CAAC,IAAI,CAAC,gDAAgD,CAAC,CAAC;gBACnE,WAAW,CAAC,IAAI,CAAC,2CAA2C,CAAC,CAAC;gBAC9D,gBAAgB,CAAC,IAAI,CAAC,oCAAoC,CAAC,CAAC;gBAC5D,gBAAgB,CAAC,IAAI,CAAC,8BAA8B,CAAC,CAAC;YACxD,CAAC;iBAAM,IAAI,YAAY,KAAK,QAAQ,EAAE,CAAC;gBACrC,cAAc,GAAG,yDAAyD,CAAC;gBAC3E,WAAW,CAAC,IAAI,CAAC,2CAA2C,CAAC,CAAC;gBAC9D,WAAW,CAAC,IAAI,CAAC,sCAAsC,CAAC,CAAC;gBACzD,gBAAgB,CAAC,IAAI,CAAC,uCAAuC,CAAC,CAAC;gBAC/D,gBAAgB,CAAC,IAAI,CAAC,iCAAiC,CAAC,CAAC;YAC3D,CAAC;iBAAM,CAAC;gBACN,cAAc,GAAG,qCAAqC,CAAC;gBACvD,WAAW,CAAC,IAAI,CAAC,sCAAsC,CAAC,CAAC;gBACzD,gBAAgB,CAAC,IAAI,CAAC,oCAAoC,CAAC,CAAC;YAC9D,CAAC;YAGD,IAAI,MAAM,CAAC,QAAQ,CAAC,gBAAgB,CAAC,EAAE,CAAC;gBACtC,gBAAgB,CAAC,IAAI,CAAC,wCAAwC,CAAC,CAAC;gBAChE,gBAAgB,CAAC,IAAI,CAAC,2CAA2C,CAAC,CAAC;YACrE,CAAC;YAED,IAAI,MAAM,CAAC,QAAQ,CAAC,mBAAmB,CAAC,EAAE,CAAC;gBACzC,gBAAgB,CAAC,IAAI,CAAC,oCAAoC,CAAC,CAAC;gBAC5D,gBAAgB,CAAC,IAAI,CAAC,oCAAoC,CAAC,CAAC;YAC9D,CAAC;YAED,IAAI,MAAM,CAAC,QAAQ,CAAC,aAAa,CAAC,EAAE,CAAC;gBACnC,gBAAgB,CAAC,IAAI,CAAC,6BAA6B,CAAC,CAAC;gBACrD,gBAAgB,CAAC,IAAI,CAAC,uCAAuC,CAAC,CAAC;YACjE,CAAC;YAED,IAAI,MAAM,CAAC,QAAQ,CAAC,eAAe,CAAC,EAAE,CAAC;gBACrC,gBAAgB,CAAC,IAAI,CAAC,iCAAiC,CAAC,CAAC;gBACzD,gBAAgB,CAAC,IAAI,CAAC,sCAAsC,CAAC,CAAC;YAChE,CAAC;YAGD,MAAM,gBAAgB,GAAG,IAAI,CAAC,yBAAyB,CAAC,MAAM,EAAE,SAAS,CAAC,YAAY,CAAC,CAAC;YAExF,OAAO;gBACL,MAAM,EAAE,MAAM,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,WAAW,CAAC;gBAClD,cAAc;gBACd,cAAc;gBACd,WAAW;gBACX,gBAAgB;gBAChB,gBAAgB;aACjB,CAAC;QACJ,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,OAAO,CAAC,KAAK,CAAC,6BAA6B,EAAE,KAAK,CAAC,CAAC;YACpD,OAAO;gBACL,MAAM,EAAE,CAAC,eAAe,CAAC;gBACzB,cAAc,EAAE,mCAAmC;gBACnD,cAAc,EAAE,QAAQ;gBACxB,WAAW,EAAE,CAAC,2CAA2C,CAAC;gBAC1D,gBAAgB,EAAE,6CAA6C;gBAC/D,gBAAgB,EAAE,CAAC,mCAAmC,CAAC;aACxD,CAAC;QACJ,CAAC;IACH,CAAC;IAEO,yBAAyB,CAAC,MAAgB,EAAE,YAAqB;QACvE,IAAI,MAAM,GAAG,QAAQ,CAAC;QAEtB,IAAI,MAAM,CAAC,QAAQ,CAAC,2BAA2B,CAAC,IAAI,MAAM,CAAC,QAAQ,CAAC,gBAAgB,CAAC,EAAE,CAAC;YACtF,MAAM,GAAG,6DAA6D,CAAC;QACzE,CAAC;aAAM,IAAI,MAAM,CAAC,QAAQ,CAAC,mBAAmB,CAAC,IAAI,MAAM,CAAC,QAAQ,CAAC,aAAa,CAAC,EAAE,CAAC;YAClF,MAAM,GAAG,yCAAyC,CAAC;QACrD,CAAC;aAAM,IAAI,MAAM,CAAC,QAAQ,CAAC,eAAe,CAAC,IAAI,MAAM,CAAC,QAAQ,CAAC,kBAAkB,CAAC,EAAE,CAAC;YACnF,MAAM,GAAG,wDAAwD,CAAC;QACpE,CAAC;QAED,IAAI,YAAY,EAAE,CAAC;YACjB,MAAM,IAAI,mBAAmB,YAAY,GAAG,CAAC;QAC/C,CAAC;QAED,OAAO,MAAM,CAAC;IAChB,CAAC;IAED,KAAK,CAAC,kBAAkB,CAAC,UAAuB;QAC9C,IAAI,CAAC;YACH,MAAM,mBAAmB,GAAa,EAAE,CAAC;YACzC,MAAM,oBAAoB,GAA8B,EAAE,CAAC;YAC3D,MAAM,YAAY,GAAa,EAAE,CAAC;YAClC,MAAM,eAAe,GAA8B,EAAE,CAAC;YACtD,MAAM,yBAAyB,GAAa,EAAE,CAAC;YAG/C,MAAM,YAAY,GAAG,IAAI,IAAI,EAAE,CAAC;YAChC,YAAY,CAAC,QAAQ,CAAC,YAAY,CAAC,QAAQ,EAAE,GAAG,CAAC,CAAC,CAAC;YAEnD,MAAM,WAAW,GAAG,UAAU,CAAC,MAAM,CAAC,SAAS,CAAC,EAAE;gBAChD,MAAM,QAAQ,GAAG,IAAI,IAAI,CAAC,SAAS,CAAC,WAAW,CAAC,CAAC;gBACjD,OAAO,QAAQ,GAAG,YAAY,CAAC;YACjC,CAAC,CAAC,CAAC;YAGH,KAAK,MAAM,SAAS,IAAI,WAAW,EAAE,CAAC;gBACpC,IAAI,SAAS,CAAC,YAAY,EAAE,CAAC;oBAC3B,oBAAoB,CAAC,SAAS,CAAC,YAAY,CAAC,GAAG,CAAC,oBAAoB,CAAC,SAAS,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC;gBACzG,CAAC;YACH,CAAC;YAGD,MAAM,UAAU,GAA8B,EAAE,CAAC;YAEjD,KAAK,MAAM,SAAS,IAAI,WAAW,EAAE,CAAC;gBACpC,MAAM,QAAQ,GAAG,MAAM,IAAI,CAAC,gBAAgB,CAAC,SAAS,CAAC,CAAC;gBAExD,KAAK,MAAM,KAAK,IAAI,QAAQ,CAAC,MAAM,EAAE,CAAC;oBACpC,UAAU,CAAC,KAAK,CAAC,GAAG,CAAC,UAAU,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC;oBACjD,eAAe,CAAC,KAAK,CAAC,GAAG,CAAC,eAAe,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC;gBAC7D,CAAC;YACH,CAAC;YAGD,MAAM,YAAY,GAAG,MAAM,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,EAAC,CAAC,CAAC,EAAE,CAAC,EAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;YAE5E,IAAI,YAAY,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC;gBAC5B,MAAM,QAAQ,GAAG,YAAY,CAAC,CAAC,CAAC,CAAC;gBACjC,IAAI,QAAQ,CAAC,CAAC,CAAC,GAAG,CAAC,EAAE,CAAC;oBACpB,mBAAmB,CAAC,IAAI,CAAC,eAAe,QAAQ,CAAC,CAAC,CAAC,YAAY,QAAQ,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC;gBACvF,CAAC;YACH,CAAC;YAGD,MAAM,OAAO,GAAG,WAAW,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,CACrC,CAAC,CAAC,KAAK,CAAC,WAAW,EAAE,CAAC,QAAQ,CAAC,IAAI,CAAC;gBACpC,CAAC,CAAC,OAAO,CAAC,WAAW,EAAE,CAAC,QAAQ,CAAC,yBAAyB,CAAC;gBAC3D,CAAC,CAAC,SAAS,EAAE,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,KAAK,CAAC,WAAW,EAAE,CAAC,QAAQ,CAAC,kBAAkB,CAAC,CAAC,CAC7E,CAAC;YAEF,IAAI,OAAO,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC;gBACvB,mBAAmB,CAAC,IAAI,CAAC,0DAA0D,CAAC,CAAC;gBACrF,yBAAyB,CAAC,IAAI,CAAC,gDAAgD,CAAC,CAAC;YACnF,CAAC;YAED,MAAM,UAAU,GAAG,WAAW,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,CACxC,CAAC,CAAC,KAAK,CAAC,WAAW,EAAE,CAAC,QAAQ,CAAC,OAAO,CAAC;gBACvC,CAAC,CAAC,OAAO,CAAC,WAAW,EAAE,CAAC,QAAQ,CAAC,aAAa,CAAC,CAChD,CAAC;YAEF,IAAI,UAAU,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC;gBAC1B,mBAAmB,CAAC,IAAI,CAAC,kCAAkC,CAAC,CAAC;gBAC7D,yBAAyB,CAAC,IAAI,CAAC,oCAAoC,CAAC,CAAC;YACvE,CAAC;YAED,MAAM,SAAS,GAAG,WAAW,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,CACvC,CAAC,CAAC,KAAK,CAAC,WAAW,EAAE,CAAC,QAAQ,CAAC,MAAM,CAAC;gBACtC,CAAC,CAAC,OAAO,CAAC,WAAW,EAAE,CAAC,QAAQ,CAAC,iBAAiB,CAAC,CACpD,CAAC;YAEF,IAAI,SAAS,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC;gBACzB,mBAAmB,CAAC,IAAI,CAAC,oCAAoC,CAAC,CAAC;gBAC/D,yBAAyB,CAAC,IAAI,CAAC,4CAA4C,CAAC,CAAC;YAC/E,CAAC;YAGD,MAAM,aAAa,GAAG,WAAW,CAAC,MAAM,CAAC,KAAK,EAAC,CAAC,EAAC,EAAE;gBACjD,MAAM,QAAQ,GAAG,MAAM,IAAI,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC;gBAChD,OAAO,QAAQ,CAAC,cAAc,KAAK,MAAM,CAAC;YAC5C,CAAC,CAAC,CAAC;YAEH,IAAI,aAAa,CAAC,MAAM,GAAG,WAAW,CAAC,MAAM,GAAG,GAAG,EAAE,CAAC;gBACpD,YAAY,CAAC,IAAI,CAAC,6CAA6C,CAAC,CAAC;YACnE,CAAC;YAGD,MAAM,sBAAsB,GAAG,MAAM,CAAC,OAAO,CAAC,oBAAoB,CAAC;iBAChE,IAAI,CAAC,CAAC,CAAC,EAAC,CAAC,CAAC,EAAE,CAAC,EAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;YAElC,IAAI,sBAAsB,IAAI,sBAAsB,CAAC,CAAC,CAAC,GAAG,CAAC,EAAE,CAAC;gBAC5D,mBAAmB,CAAC,IAAI,CAAC,8BAA8B,sBAAsB,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;gBACpF,yBAAyB,CAAC,IAAI,CAAC,GAAG,sBAAsB,CAAC,CAAC,CAAC,8CAA8C,CAAC,CAAC;YAC7G,CAAC;YAGD,IAAI,mBAAmB,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC;gBACnC,yBAAyB,CAAC,IAAI,CAAC,sDAAsD,CAAC,CAAC;gBACvF,yBAAyB,CAAC,IAAI,CAAC,0DAA0D,CAAC,CAAC;YAC7F,CAAC;YAED,OAAO;gBACL,mBAAmB;gBACnB,oBAAoB;gBACpB,YAAY;gBACZ,eAAe;gBACf,yBAAyB;aAC1B,CAAC;QACJ,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,OAAO,CAAC,KAAK,CAAC,+BAA+B,EAAE,KAAK,CAAC,CAAC;YACtD,OAAO;gBACL,mBAAmB,EAAE,CAAC,8BAA8B,CAAC;gBACrD,oBAAoB,EAAE,EAAE;gBACxB,YAAY,EAAE,CAAC,qCAAqC,CAAC;gBACrD,eAAe,EAAE,EAAE;gBACnB,yBAAyB,EAAE,CAAC,kDAAkD,CAAC;aAChF,CAAC;QACJ,CAAC;IACH,CAAC;IAED,KAAK,CAAC,wBAAwB,CAAC,MAAgB,EAAE,YAAoB;QAMnE,IAAI,SAAS,GAA8B,KAAK,CAAC;QACjD,MAAM,oBAAoB,GAAa,EAAE,CAAC;QAC1C,MAAM,UAAU,GAAa,EAAE,CAAC;QAChC,IAAI,QAAQ,GAAG,YAAY,CAAC;QAG5B,IAAI,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC,gBAAgB,EAAE,2BAA2B,EAAE,mBAAmB,EAAE,aAAa,CAAC,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC;YAC9H,SAAS,GAAG,MAAM,CAAC;YACnB,QAAQ,GAAG,YAAY,CAAC;QAC1B,CAAC;aAAM,IAAI,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC,eAAe,EAAE,kBAAkB,EAAE,mBAAmB,CAAC,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC;YAC5G,SAAS,GAAG,QAAQ,CAAC;YACrB,QAAQ,GAAG,YAAY,CAAC;QAC1B,CAAC;QAGD,QAAQ,YAAY,CAAC,WAAW,EAAE,EAAE,CAAC;YACnC,KAAK,IAAI;gBACP,oBAAoB,CAAC,IAAI,CAAC,2BAA2B,CAAC,CAAC;gBACvD,oBAAoB,CAAC,IAAI,CAAC,6BAA6B,CAAC,CAAC;gBACzD,oBAAoB,CAAC,IAAI,CAAC,iCAAiC,CAAC,CAAC;gBAC7D,UAAU,CAAC,IAAI,CAAC,8BAA8B,CAAC,CAAC;gBAChD,MAAM;YACR,KAAK,IAAI;gBACP,oBAAoB,CAAC,IAAI,CAAC,8BAA8B,CAAC,CAAC;gBAC1D,oBAAoB,CAAC,IAAI,CAAC,mCAAmC,CAAC,CAAC;gBAC/D,oBAAoB,CAAC,IAAI,CAAC,8BAA8B,CAAC,CAAC;gBAC1D,UAAU,CAAC,IAAI,CAAC,yBAAyB,CAAC,CAAC;gBAC3C,MAAM;YACR,KAAK,IAAI;gBACP,oBAAoB,CAAC,IAAI,CAAC,4BAA4B,CAAC,CAAC;gBACxD,oBAAoB,CAAC,IAAI,CAAC,0CAA0C,CAAC,CAAC;gBACtE,UAAU,CAAC,IAAI,CAAC,qCAAqC,CAAC,CAAC;gBACvD,MAAM;QACV,CAAC;QAGD,IAAI,MAAM,CAAC,QAAQ,CAAC,mBAAmB,CAAC,EAAE,CAAC;YACzC,UAAU,CAAC,IAAI,CAAC,6BAA6B,CAAC,CAAC;YAC/C,UAAU,CAAC,IAAI,CAAC,wCAAwC,CAAC,CAAC;QAC5D,CAAC;QAED,IAAI,MAAM,CAAC,QAAQ,CAAC,eAAe,CAAC,EAAE,CAAC;YACrC,UAAU,CAAC,IAAI,CAAC,iCAAiC,CAAC,CAAC;YACnD,UAAU,CAAC,IAAI,CAAC,oCAAoC,CAAC,CAAC;QACxD,CAAC;QAED,OAAO;YACL,SAAS;YACT,oBAAoB;YACpB,UAAU;YACV,QAAQ;SACT,CAAC;IACJ,CAAC;IAED,KAAK,CAAC,yBAAyB,CAAC,QAAgB;QAK9C,MAAM,UAAU,GAAa,EAAE,CAAC;QAChC,MAAM,UAAU,GAAa,EAAE,CAAC;QAChC,MAAM,YAAY,GAAa,EAAE,CAAC;QAElC,MAAM,SAAS,GAAG,QAAQ,CAAC,WAAW,EAAE,CAAC;QAGzC,IAAI,SAAS,CAAC,QAAQ,CAAC,cAAc,CAAC,IAAI,SAAS,CAAC,QAAQ,CAAC,kBAAkB,CAAC,EAAE,CAAC;YACjF,UAAU,CAAC,IAAI,CAAC,kCAAkC,CAAC,CAAC;YACpD,YAAY,CAAC,IAAI,CAAC,8DAA8D,CAAC,CAAC;QACpF,CAAC;QAED,IAAI,SAAS,CAAC,QAAQ,CAAC,kBAAkB,CAAC,IAAI,SAAS,CAAC,QAAQ,CAAC,oBAAoB,CAAC,EAAE,CAAC;YACvF,UAAU,CAAC,IAAI,CAAC,yCAAyC,CAAC,CAAC;YAC3D,YAAY,CAAC,IAAI,CAAC,qDAAqD,CAAC,CAAC;QAC3E,CAAC;QAED,IAAI,SAAS,CAAC,QAAQ,CAAC,uBAAuB,CAAC,IAAI,SAAS,CAAC,QAAQ,CAAC,2BAA2B,CAAC,EAAE,CAAC;YACnG,UAAU,CAAC,IAAI,CAAC,6CAA6C,CAAC,CAAC;YAC/D,YAAY,CAAC,IAAI,CAAC,qEAAqE,CAAC,CAAC;QAC3F,CAAC;QAED,IAAI,SAAS,CAAC,QAAQ,CAAC,iBAAiB,CAAC,IAAI,SAAS,CAAC,QAAQ,CAAC,aAAa,CAAC,EAAE,CAAC;YAC/E,UAAU,CAAC,IAAI,CAAC,4BAA4B,CAAC,CAAC;YAC9C,YAAY,CAAC,IAAI,CAAC,qDAAqD,CAAC,CAAC;QAC3E,CAAC;QAGD,IAAI,SAAS,CAAC,QAAQ,CAAC,eAAe,CAAC,IAAI,SAAS,CAAC,QAAQ,CAAC,WAAW,CAAC,EAAE,CAAC;YAC3E,UAAU,CAAC,IAAI,CAAC,yCAAyC,CAAC,CAAC;QAC7D,CAAC;QAED,IAAI,SAAS,CAAC,QAAQ,CAAC,cAAc,CAAC,IAAI,SAAS,CAAC,QAAQ,CAAC,aAAa,CAAC,EAAE,CAAC;YAC5E,UAAU,CAAC,IAAI,CAAC,oDAAoD,CAAC,CAAC;QACxE,CAAC;QAED,OAAO;YACL,UAAU;YACV,UAAU;YACV,YAAY;SACb,CAAC;IACJ,CAAC;CACF;AAED,MAAM,CAAC,MAAM,oBAAoB,GAAG,IAAI,oBAAoB,EAAE,CAAC","sourcesContent":["import { storage } from \"../storage\";\r\nimport type { LegalCase } from \"@shared/schema\";\r\n\r\ninterface LegalAnalysisResult {\r\n  themes: string[];\r\n  riskAssessment: string;\r\n  precedentValue: 'high' | 'medium' | 'low';\r\n  actionItems: string[];\r\n  complianceImpact: string;\r\n  recommendedSteps: string[];\r\n}\r\n\r\ninterface LegalTrendAnalysis {\r\n  emergingLegalTrends: string[];\r\n  jurisdictionActivity: { [key: string]: number };\r\n  riskPatterns: string[];\r\n  litigationTypes: { [key: string]: number };\r\n  preventiveRecommendations: string[];\r\n}\r\n\r\nexport class LegalAnalysisService {\r\n  \r\n  private legalThemes = {\r\n    'Produkthaftung': {\r\n      keywords: ['product liability', 'defective device', 'manufacturer liability', 'design defect', 'manufacturing defect'],\r\n      riskLevel: 'high',\r\n      description: 'Haftungsrisiken bei fehlerhaften Medizinprodukten'\r\n    },\r\n    'Regulatorische Compliance': {\r\n      keywords: ['FDA violation', 'regulatory breach', 'compliance failure', 'regulatory non-compliance', 'violation of regulation'],\r\n      riskLevel: 'high',\r\n      description: 'Verstöße gegen regulatorische Vorschriften'\r\n    },\r\n    'Klinische Studien': {\r\n      keywords: ['clinical trial', 'informed consent', 'ethics committee', 'clinical investigation', 'study protocol'],\r\n      riskLevel: 'medium',\r\n      description: 'Rechtliche Aspekte klinischer Prüfungen'\r\n    },\r\n    'Patente und IP': {\r\n      keywords: ['patent infringement', 'intellectual property', 'licensing', 'trademark', 'copyright'],\r\n      riskLevel: 'medium',\r\n      description: 'Geistiges Eigentum und Patentrechte'\r\n    },\r\n    'Datenschutz': {\r\n      keywords: ['GDPR', 'DSGVO', 'data protection', 'privacy', 'personal data', 'data breach'],\r\n      riskLevel: 'high',\r\n      description: 'Datenschutzrechtliche Compliance'\r\n    },\r\n    'KI/ML-Regulierung': {\r\n      keywords: ['artificial intelligence', 'machine learning', 'AI device', 'algorithmic bias', 'AI liability'],\r\n      riskLevel: 'high',\r\n      description: 'Rechtliche Herausforderungen bei KI-basierten Medizinprodukten'\r\n    },\r\n    'Cybersecurity': {\r\n      keywords: ['cybersecurity', 'data breach', 'security vulnerability', 'cyber attack', 'data security'],\r\n      riskLevel: 'high',\r\n      description: 'IT-Sicherheit und Cyber-Bedrohungen'\r\n    },\r\n    'Marktüberwachung': {\r\n      keywords: ['post-market surveillance', 'market surveillance', 'recall', 'corrective action', 'field safety notice'],\r\n      riskLevel: 'medium',\r\n      description: 'Marktüberwachung und Rückrufmaßnahmen'\r\n    }\r\n  };\r\n\r\n  private jurisdictions = {\r\n    'US': ['united states', 'usa', 'fda', 'america'],\r\n    'EU': ['european union', 'europe', 'ema', 'mdr', 'ce mark'],\r\n    'DE': ['germany', 'deutschland', 'bfarm', 'german'],\r\n    'UK': ['united kingdom', 'britain', 'mhra', 'british'],\r\n    'CH': ['switzerland', 'swissmedic', 'swiss'],\r\n    'CA': ['canada', 'health canada', 'canadian'],\r\n    'AU': ['australia', 'tga', 'australian'],\r\n    'JP': ['japan', 'pmda', 'japanese']\r\n  };\r\n\r\n  async analyzeLegalCase(legalCase: LegalCase): Promise<LegalAnalysisResult> {\r\n    try {\r\n      const fullText = `${legalCase.title} ${legalCase.summary} ${legalCase.keyIssues?.join(' ') || ''}`.toLowerCase();\r\n      \r\n      const themes: string[] = [];\r\n      let riskAssessment = 'Mittleres Risiko';\r\n      let precedentValue: 'high' | 'medium' | 'low' = 'medium';\r\n      const actionItems: string[] = [];\r\n      const recommendedSteps: string[] = [];\r\n\r\n      // Analyze legal themes\r\n      let maxRiskLevel = 'low';\r\n      for (const [theme, data] of Object.entries(this.legalThemes)) {\r\n        if (data.keywords.some(keyword => fullText.includes(keyword.toLowerCase()))) {\r\n          themes.push(theme);\r\n          if (data.riskLevel === 'high') {\r\n            maxRiskLevel = 'high';\r\n            precedentValue = 'high';\r\n          } else if (data.riskLevel === 'medium' && maxRiskLevel !== 'high') {\r\n            maxRiskLevel = 'medium';\r\n            if (precedentValue === 'low') precedentValue = 'medium';\r\n          }\r\n        }\r\n      }\r\n\r\n      // Determine risk assessment based on themes\r\n      if (maxRiskLevel === 'high') {\r\n        riskAssessment = 'Hohes Risiko - Sofortige Maßnahmen erforderlich';\r\n        actionItems.push('Sofortige rechtliche Bewertung durch Fachanwalt');\r\n        actionItems.push('Prüfung der Auswirkungen auf aktuelle Produkte');\r\n        actionItems.push('Risikobewertung für ähnliche Technologien');\r\n        recommendedSteps.push('Externe Rechtsberatung einbeziehen');\r\n        recommendedSteps.push('Compliance-Audit durchführen');\r\n      } else if (maxRiskLevel === 'medium') {\r\n        riskAssessment = 'Mittleres Risiko - Regelmäßige Überwachung erforderlich';\r\n        actionItems.push('Entwicklungen verfolgen und dokumentieren');\r\n        actionItems.push('Interne Compliance-Prüfung einleiten');\r\n        recommendedSteps.push('Vierteljährliche Bewertung einrichten');\r\n        recommendedSteps.push('Präventive Maßnahmen evaluieren');\r\n      } else {\r\n        riskAssessment = 'Geringes Risiko - Zur Kenntnisnahme';\r\n        actionItems.push('Archivierung für zukünftige Referenz');\r\n        recommendedSteps.push('Jährliche Überprüfung der Relevanz');\r\n      }\r\n\r\n      // Theme-specific recommendations\r\n      if (themes.includes('Produkthaftung')) {\r\n        recommendedSteps.push('Produkthaftungsversicherung überprüfen');\r\n        recommendedSteps.push('Design- und Fertigungsprozesse evaluieren');\r\n      }\r\n\r\n      if (themes.includes('KI/ML-Regulierung')) {\r\n        recommendedSteps.push('KI-Governance-Framework entwickeln');\r\n        recommendedSteps.push('Algorithmus-Transparenz verbessern');\r\n      }\r\n\r\n      if (themes.includes('Datenschutz')) {\r\n        recommendedSteps.push('DSGVO-Compliance überprüfen');\r\n        recommendedSteps.push('Privacy Impact Assessment durchführen');\r\n      }\r\n\r\n      if (themes.includes('Cybersecurity')) {\r\n        recommendedSteps.push('IT-Sicherheitsaudit beauftragen');\r\n        recommendedSteps.push('Incident Response Plan aktualisieren');\r\n      }\r\n\r\n      // Determine compliance impact\r\n      const complianceImpact = this.determineComplianceImpact(themes, legalCase.jurisdiction);\r\n\r\n      return {\r\n        themes: themes.length > 0 ? themes : ['Allgemein'],\r\n        riskAssessment,\r\n        precedentValue,\r\n        actionItems,\r\n        complianceImpact,\r\n        recommendedSteps\r\n      };\r\n    } catch (error) {\r\n      console.error(\"Error analyzing legal case:\", error);\r\n      return {\r\n        themes: ['Analysefehler'],\r\n        riskAssessment: 'Manuelle Überprüfung erforderlich',\r\n        precedentValue: 'medium',\r\n        actionItems: ['Detaillierte manuelle Analyse durchführen'],\r\n        complianceImpact: 'Unbekannt - manuelle Bewertung erforderlich',\r\n        recommendedSteps: ['Externes Rechtsgutachten einholen']\r\n      };\r\n    }\r\n  }\r\n\r\n  private determineComplianceImpact(themes: string[], jurisdiction?: string): string {\r\n    let impact = 'Gering';\r\n    \r\n    if (themes.includes('Regulatorische Compliance') || themes.includes('Produkthaftung')) {\r\n      impact = 'Hoch - Direkte Auswirkungen auf Zulassungsverfahren möglich';\r\n    } else if (themes.includes('KI/ML-Regulierung') || themes.includes('Datenschutz')) {\r\n      impact = 'Mittel - Präventive Maßnahmen empfohlen';\r\n    } else if (themes.includes('Cybersecurity') || themes.includes('Marktüberwachung')) {\r\n      impact = 'Mittel - Überprüfung bestehender Prozesse erforderlich';\r\n    }\r\n\r\n    if (jurisdiction) {\r\n      impact += ` (Jurisdiktion: ${jurisdiction})`;\r\n    }\r\n\r\n    return impact;\r\n  }\r\n\r\n  async analyzeLegalTrends(legalCases: LegalCase[]): Promise<LegalTrendAnalysis> {\r\n    try {\r\n      const emergingLegalTrends: string[] = [];\r\n      const jurisdictionActivity: { [key: string]: number } = {};\r\n      const riskPatterns: string[] = [];\r\n      const litigationTypes: { [key: string]: number } = {};\r\n      const preventiveRecommendations: string[] = [];\r\n\r\n      // Analyze recent cases (last 6 months)\r\n      const sixMonthsAgo = new Date();\r\n      sixMonthsAgo.setMonth(sixMonthsAgo.getMonth() - 6);\r\n      \r\n      const recentCases = legalCases.filter(legalCase => {\r\n        const caseDate = new Date(legalCase.publishedAt);\r\n        return caseDate > sixMonthsAgo;\r\n      });\r\n\r\n      // Count by jurisdiction\r\n      for (const legalCase of recentCases) {\r\n        if (legalCase.jurisdiction) {\r\n          jurisdictionActivity[legalCase.jurisdiction] = (jurisdictionActivity[legalCase.jurisdiction] || 0) + 1;\r\n        }\r\n      }\r\n\r\n      // Analyze themes and trends\r\n      const themeCount: { [key: string]: number } = {};\r\n      \r\n      for (const legalCase of recentCases) {\r\n        const analysis = await this.analyzeLegalCase(legalCase);\r\n        \r\n        for (const theme of analysis.themes) {\r\n          themeCount[theme] = (themeCount[theme] || 0) + 1;\r\n          litigationTypes[theme] = (litigationTypes[theme] || 0) + 1;\r\n        }\r\n      }\r\n\r\n      // Identify emerging trends\r\n      const sortedThemes = Object.entries(themeCount).sort(([,a], [,b]) => b - a);\r\n      \r\n      if (sortedThemes.length > 0) {\r\n        const topTheme = sortedThemes[0];\r\n        if (topTheme[1] > 3) {\r\n          emergingLegalTrends.push(`Zunahme von ${topTheme[0]}-Fällen (${topTheme[1]} Fälle)`);\r\n        }\r\n      }\r\n\r\n      // Specific trend analysis\r\n      const aiCases = recentCases.filter(c => \r\n        c.title.toLowerCase().includes('ai') || \r\n        c.summary.toLowerCase().includes('artificial intelligence') ||\r\n        c.keyIssues?.some(issue => issue.toLowerCase().includes('machine learning'))\r\n      );\r\n\r\n      if (aiCases.length > 2) {\r\n        emergingLegalTrends.push('Verstärkte Regulierung von KI-basierten Medizinprodukten');\r\n        preventiveRecommendations.push('KI-Governance und Ethik-Richtlinien entwickeln');\r\n      }\r\n\r\n      const cyberCases = recentCases.filter(c => \r\n        c.title.toLowerCase().includes('cyber') || \r\n        c.summary.toLowerCase().includes('data breach')\r\n      );\r\n\r\n      if (cyberCases.length > 1) {\r\n        emergingLegalTrends.push('Erhöhte Cybersecurity-Litigation');\r\n        preventiveRecommendations.push('IT-Sicherheitsmaßnahmen verstärken');\r\n      }\r\n\r\n      const gdprCases = recentCases.filter(c => \r\n        c.title.toLowerCase().includes('gdpr') || \r\n        c.summary.toLowerCase().includes('data protection')\r\n      );\r\n\r\n      if (gdprCases.length > 1) {\r\n        emergingLegalTrends.push('Verstärkte Datenschutz-Enforcement');\r\n        preventiveRecommendations.push('DSGVO-Compliance überprüfen und verstärken');\r\n      }\r\n\r\n      // Risk pattern analysis\r\n      const highRiskCases = recentCases.filter(async c => {\r\n        const analysis = await this.analyzeLegalCase(c);\r\n        return analysis.precedentValue === 'high';\r\n      });\r\n\r\n      if (highRiskCases.length > recentCases.length * 0.3) {\r\n        riskPatterns.push('Erhöhte Anzahl von High-Impact Rechtsfällen');\r\n      }\r\n\r\n      // Most active jurisdiction\r\n      const mostActiveJurisdiction = Object.entries(jurisdictionActivity)\r\n        .sort(([,a], [,b]) => b - a)[0];\r\n\r\n      if (mostActiveJurisdiction && mostActiveJurisdiction[1] > 2) {\r\n        emergingLegalTrends.push(`Erhöhte Rechtsaktivität in ${mostActiveJurisdiction[0]}`);\r\n        preventiveRecommendations.push(`${mostActiveJurisdiction[0]}-spezifische Compliance-Strategie entwickeln`);\r\n      }\r\n\r\n      // General recommendations based on trends\r\n      if (emergingLegalTrends.length > 2) {\r\n        preventiveRecommendations.push('Quartalsmäßige Legal Risk Assessments implementieren');\r\n        preventiveRecommendations.push('Proaktive Stakeholder-Kommunikation bei Rechtsänderungen');\r\n      }\r\n\r\n      return {\r\n        emergingLegalTrends,\r\n        jurisdictionActivity,\r\n        riskPatterns,\r\n        litigationTypes,\r\n        preventiveRecommendations\r\n      };\r\n    } catch (error) {\r\n      console.error(\"Error analyzing legal trends:\", error);\r\n      return {\r\n        emergingLegalTrends: ['Trendanalyse nicht verfügbar'],\r\n        jurisdictionActivity: {},\r\n        riskPatterns: ['Manuelle Risikoanalyse erforderlich'],\r\n        litigationTypes: {},\r\n        preventiveRecommendations: ['Externe Rechtsberatung für Trendanalyse einholen']\r\n      };\r\n    }\r\n  }\r\n\r\n  async generateComplianceReport(themes: string[], jurisdiction: string): Promise<{\r\n    riskLevel: 'high' | 'medium' | 'low';\r\n    specificRequirements: string[];\r\n    actionPlan: string[];\r\n    timeline: string;\r\n  }> {\r\n    let riskLevel: 'high' | 'medium' | 'low' = 'low';\r\n    const specificRequirements: string[] = [];\r\n    const actionPlan: string[] = [];\r\n    let timeline = '3-6 Monate';\r\n\r\n    // High-risk themes\r\n    if (themes.some(theme => ['Produkthaftung', 'Regulatorische Compliance', 'KI/ML-Regulierung', 'Datenschutz'].includes(theme))) {\r\n      riskLevel = 'high';\r\n      timeline = '1-3 Monate';\r\n    } else if (themes.some(theme => ['Cybersecurity', 'Marktüberwachung', 'Klinische Studien'].includes(theme))) {\r\n      riskLevel = 'medium';\r\n      timeline = '2-4 Monate';\r\n    }\r\n\r\n    // Jurisdiction-specific requirements\r\n    switch (jurisdiction.toUpperCase()) {\r\n      case 'EU':\r\n        specificRequirements.push('MDR-Compliance überprüfen');\r\n        specificRequirements.push('CE-Kennzeichnung validieren');\r\n        specificRequirements.push('DSGVO-Konformität sicherstellen');\r\n        actionPlan.push('Benannte Stelle konsultieren');\r\n        break;\r\n      case 'US':\r\n        specificRequirements.push('FDA-Registrierung überprüfen');\r\n        specificRequirements.push('510(k) oder PMA-Status validieren');\r\n        specificRequirements.push('QSR-Compliance sicherstellen');\r\n        actionPlan.push('FDA-Beratung beantragen');\r\n        break;\r\n      case 'DE':\r\n        specificRequirements.push('BfArM-Richtlinien befolgen');\r\n        specificRequirements.push('DiGA-Kriterien prüfen (falls zutreffend)');\r\n        actionPlan.push('Deutsche Rechtexperten konsultieren');\r\n        break;\r\n    }\r\n\r\n    // Theme-specific action plans\r\n    if (themes.includes('KI/ML-Regulierung')) {\r\n      actionPlan.push('KI-Ethik-Komitee einrichten');\r\n      actionPlan.push('Algorithmus-Auditierung implementieren');\r\n    }\r\n\r\n    if (themes.includes('Cybersecurity')) {\r\n      actionPlan.push('Penetration Testing durchführen');\r\n      actionPlan.push('ISO 27001 Zertifizierung anstreben');\r\n    }\r\n\r\n    return {\r\n      riskLevel,\r\n      specificRequirements,\r\n      actionPlan,\r\n      timeline\r\n    };\r\n  }\r\n\r\n  async extractKeyLegalPrinciples(caseText: string): Promise<{\r\n    principles: string[];\r\n    precedents: string[];\r\n    implications: string[];\r\n  }> {\r\n    const principles: string[] = [];\r\n    const precedents: string[] = [];\r\n    const implications: string[] = [];\r\n\r\n    const lowerText = caseText.toLowerCase();\r\n\r\n    // Extract legal principles\r\n    if (lowerText.includes('duty of care') || lowerText.includes('sorgfaltspflicht')) {\r\n      principles.push('Sorgfaltspflicht des Herstellers');\r\n      implications.push('Erhöhte Dokumentations- und Qualitätssicherungsanforderungen');\r\n    }\r\n\r\n    if (lowerText.includes('informed consent') || lowerText.includes('aufklärungspflicht')) {\r\n      principles.push('Informed Consent bei klinischen Studien');\r\n      implications.push('Verstärkte Aufklärungs- und Dokumentationspflichten');\r\n    }\r\n\r\n    if (lowerText.includes('regulatory compliance') || lowerText.includes('regulatorische compliance')) {\r\n      principles.push('Strikte Einhaltung regulatorischer Vorgaben');\r\n      implications.push('Kontinuierliche Überwachung von Regulierungsänderungen erforderlich');\r\n    }\r\n\r\n    if (lowerText.includes('data protection') || lowerText.includes('datenschutz')) {\r\n      principles.push('Datenschutz als Grundrecht');\r\n      implications.push('Privacy by Design in Produktentwicklung integrieren');\r\n    }\r\n\r\n    // Extract precedents\r\n    if (lowerText.includes('landmark case') || lowerText.includes('precedent')) {\r\n      precedents.push('Präzedenzfall für ähnliche Technologien');\r\n    }\r\n\r\n    if (lowerText.includes('class action') || lowerText.includes('sammelklage')) {\r\n      precedents.push('Potenzial für Sammelklagen bei ähnlichen Problemen');\r\n    }\r\n\r\n    return {\r\n      principles,\r\n      precedents,\r\n      implications\r\n    };\r\n  }\r\n}\r\n\r\nexport const legalAnalysisService = new LegalAnalysisService();"]}