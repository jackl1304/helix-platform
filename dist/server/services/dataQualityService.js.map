{"version":3,"file":"dataQualityService.js","sourceRoot":"","sources":["../../../server/services/dataQualityService.ts"],"names":[],"mappings":"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","sourcesContent":["export interface DuplicateMatch {\r\n  id: string;\r\n  title: string;\r\n  similarity: number;\r\n  matchType: 'exact' | 'fuzzy' | 'semantic';\r\n}\r\n\r\nexport interface ValidationResult {\r\n  isValid: boolean;\r\n  errors: string[];\r\n  warnings: string[];\r\n  score: number; // 0-100\r\n}\r\n\r\ninterface DataStandardization {\r\n  countryCode?: string;\r\n  normalizedDate?: Date;\r\n  standardizedCategory?: string;\r\n  cleanedTitle?: string;\r\n}\r\n\r\nexport class DataQualityService {\r\n  \r\n  // Country code mapping for standardization\r\n  private countryMapping: Record<string, string> = {\r\n    'USA': 'US',\r\n    'United States': 'US',\r\n    'United States of America': 'US',\r\n    'America': 'US',\r\n    'UK': 'GB',\r\n    'United Kingdom': 'GB',\r\n    'Britain': 'GB',\r\n    'Great Britain': 'GB',\r\n    'Deutschland': 'DE',\r\n    'Germany': 'DE',\r\n    'Schweiz': 'CH',\r\n    'Switzerland': 'CH',\r\n    'Suisse': 'CH',\r\n    'Svizzera': 'CH',\r\n    'European Union': 'EU',\r\n    'EU': 'EU',\r\n    'Europe': 'EU'\r\n  };\r\n\r\n  // Standardized categories\r\n  private categoryMapping: Record<string, string> = {\r\n    '510k': 'FDA 510(k) Clearance',\r\n    '510(k)': 'FDA 510(k) Clearance',\r\n    'pma': 'FDA PMA Approval',\r\n    'recall': 'Safety Recall',\r\n    'guidance': 'Regulatory Guidance',\r\n    'guideline': 'Regulatory Guidance',\r\n    'standard': 'Technical Standard',\r\n    'iso': 'ISO Standard',\r\n    'iec': 'IEC Standard',\r\n    'safety': 'Safety Notice',\r\n    'alert': 'Safety Alert',\r\n    'warning': 'Safety Warning'\r\n  };\r\n\r\n  /**\r\n   * Fuzzy string matching using Levenshtein distance\r\n   */\r\n  private calculateSimilarity(str1: string, str2: string): number {\r\n    const normalize = (s: string) => s.toLowerCase().replace(/[^\\w\\s]/g, '').trim();\r\n    \r\n    const s1 = normalize(str1);\r\n    const s2 = normalize(str2);\r\n    \r\n    if (s1 === s2) return 1.0;\r\n    \r\n    const maxLength = Math.max(s1.length, s2.length);\r\n    if (maxLength === 0) return 1.0;\r\n    \r\n    const distance = this.levenshteinDistance(s1, s2);\r\n    return (maxLength - distance) / maxLength;\r\n  }\r\n\r\n  private levenshteinDistance(str1: string, str2: string): number {\r\n    const matrix = Array(str2.length + 1).fill(null).map(() => Array(str1.length + 1).fill(null));\r\n    \r\n    for (let i = 0; i <= str1.length; i++) matrix[0]![i] = i;\r\n    for (let j = 0; j <= str2.length; j++) matrix[j]![0] = j;\r\n    \r\n    for (let j = 1; j <= str2.length; j++) {\r\n      for (let i = 1; i <= str1.length; i++) {\r\n        const substitutionCost = str1[i - 1] === str2[j - 1] ? 0 : 1;\r\n        matrix[j]![i] = Math.min(\r\n          matrix[j]![i - 1]! + 1, // deletion\r\n          matrix[j - 1]![i]! + 1, // insertion\r\n          matrix[j - 1]![i - 1]! + substitutionCost // substitution\r\n        );\r\n      }\r\n    }\r\n    \r\n    return matrix[str2.length]![str1.length]!;\r\n  }\r\n\r\n  /**\r\n   * Find potential duplicates in a list of items\r\n   */\r\n  async findDuplicates(items: any[], similarityThreshold: number = 0.85): Promise<DuplicateMatch[]> {\r\n    const duplicates: DuplicateMatch[] = [];\r\n    const processed = new Set<string>();\r\n    \r\n    console.log(`[Quality] Checking ${items.length} items for duplicates (threshold: ${similarityThreshold})`);\r\n    \r\n    for (let i = 0; i < items.length; i++) {\r\n      if (processed.has(items[i].id)) continue;\r\n      \r\n      const currentItem = items[i];\r\n      const matches: DuplicateMatch[] = [];\r\n      \r\n      for (let j = i + 1; j < items.length; j++) {\r\n        if (processed.has(items[j].id)) continue;\r\n        \r\n        const compareItem = items[j];\r\n        \r\n        // Exact title match\r\n        if (currentItem.title === compareItem.title) {\r\n          matches.push({\r\n            id: compareItem.id,\r\n            title: compareItem.title,\r\n            similarity: 1.0,\r\n            matchType: 'exact'\r\n          });\r\n          continue;\r\n        }\r\n        \r\n        // Fuzzy matching\r\n        const similarity = this.calculateSimilarity(currentItem.title, compareItem.title);\r\n        if (similarity >= similarityThreshold) {\r\n          matches.push({\r\n            id: compareItem.id,\r\n            title: compareItem.title,\r\n            similarity,\r\n            matchType: 'fuzzy'\r\n          });\r\n        }\r\n        \r\n        // Content-based matching (if available)\r\n        if (currentItem.content && compareItem.content) {\r\n          const contentSimilarity = this.calculateSimilarity(currentItem.content, compareItem.content);\r\n          if (contentSimilarity >= 0.9) {\r\n            matches.push({\r\n              id: compareItem.id,\r\n              title: compareItem.title,\r\n              similarity: contentSimilarity,\r\n              matchType: 'semantic'\r\n            });\r\n          }\r\n        }\r\n      }\r\n      \r\n      if (matches.length > 0) {\r\n        duplicates.push({\r\n          id: currentItem.id,\r\n          title: currentItem.title,\r\n          similarity: 1.0,\r\n          matchType: 'exact'\r\n        });\r\n        \r\n        duplicates.push(...matches);\r\n        \r\n        // Mark all matches as processed\r\n        matches.forEach(match => processed.add(match.id));\r\n        processed.add(currentItem.id);\r\n      }\r\n    }\r\n    \r\n    console.log(`[Quality] Found ${duplicates.length} potential duplicates`);\r\n    return duplicates;\r\n  }\r\n\r\n  /**\r\n   * Validate data quality of a regulatory update\r\n   */\r\n  validateUpdate(update: any): ValidationResult {\r\n    const errors: string[] = [];\r\n    const warnings: string[] = [];\r\n    let score = 100;\r\n\r\n    // Required fields validation\r\n    if (!update.title || update.title.trim().length === 0) {\r\n      errors.push('Title is required');\r\n      score -= 20;\r\n    } else if (update.title.length < 10) {\r\n      warnings.push('Title is very short');\r\n      score -= 5;\r\n    }\r\n\r\n    if (!update.content || update.content.trim().length === 0) {\r\n      errors.push('Content is required');\r\n      score -= 15;\r\n    } else if (update.content.length < 50) {\r\n      warnings.push('Content is very brief');\r\n      score -= 5;\r\n    }\r\n\r\n    if (!update.source) {\r\n      warnings.push('Source is missing');\r\n      score -= 10;\r\n    }\r\n\r\n    if (!update.authority) {\r\n      warnings.push('Authority is missing');\r\n      score -= 10;\r\n    }\r\n\r\n    if (!update.region) {\r\n      warnings.push('Region is missing');\r\n      score -= 10;\r\n    }\r\n\r\n    // Date validation\r\n    if (update.published_at) {\r\n      const publishDate = new Date(update.published_at);\r\n      if (isNaN(publishDate.getTime())) {\r\n        errors.push('Invalid publication date format');\r\n        score -= 10;\r\n      } else if (publishDate > new Date()) {\r\n        warnings.push('Publication date is in the future');\r\n        score -= 5;\r\n      } else if (publishDate < new Date('2000-01-01')) {\r\n        warnings.push('Publication date seems very old');\r\n        score -= 5;\r\n      }\r\n    }\r\n\r\n    // Priority validation\r\n    if (update.priority && !['low', 'medium', 'high', 'critical'].includes(update.priority)) {\r\n      errors.push('Invalid priority value');\r\n      score -= 5;\r\n    }\r\n\r\n    // URL validation for links\r\n    if (update.metadata?.originalLink) {\r\n      try {\r\n        new URL(update.metadata.originalLink);\r\n      } catch {\r\n        warnings.push('Invalid URL in metadata');\r\n        score -= 3;\r\n      }\r\n    }\r\n\r\n    // Content quality checks\r\n    if (update.content) {\r\n      // 🔴 MOCK DATA DETECTION - Check for placeholder content\r\n      const placeholders = ['lorem ipsum', 'placeholder', 'todo', 'coming soon', '🔴 mock data'];\r\n      if (placeholders.some(ph => update.content.toLowerCase().includes(ph))) {\r\n        warnings.push('🔴 MOCK DATA DETECTED - Content contains placeholder text - AUTHENTIC DATA REQUIRED');\r\n        score -= 10;\r\n      }\r\n\r\n      // Check for very repetitive content\r\n      const words = update.content.toLowerCase().split(/\\s+/);\r\n      const uniqueWords = new Set(words);\r\n      if (words.length > 20 && uniqueWords.size / words.length < 0.3) {\r\n        warnings.push('Content appears very repetitive');\r\n        score -= 5;\r\n      }\r\n    }\r\n\r\n    return {\r\n      isValid: errors.length === 0,\r\n      errors,\r\n      warnings,\r\n      score: Math.max(0, score)\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Standardize data formats\r\n   */\r\n  standardizeData(update: any): DataStandardization {\r\n    const result: DataStandardization = {};\r\n\r\n    // Standardize country/region codes\r\n    if (update.region) {\r\n      const standardCountry = this.countryMapping[update.region];\r\n      if (standardCountry) {\r\n        result.countryCode = standardCountry;\r\n      }\r\n    }\r\n\r\n    // Standardize dates to ISO format\r\n    if (update.published_at) {\r\n      try {\r\n        const date = new Date(update.published_at);\r\n        if (!isNaN(date.getTime())) {\r\n          result.normalizedDate = date;\r\n        }\r\n      } catch (error) {\r\n        console.warn('[Quality] Could not parse date:', update.published_at);\r\n      }\r\n    }\r\n\r\n    // Standardize categories\r\n    if (update.type) {\r\n      const lowerType = update.type.toLowerCase();\r\n      for (const [key, value] of Object.entries(this.categoryMapping)) {\r\n        if (lowerType.includes(key)) {\r\n          result.standardizedCategory = value;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    // Clean and standardize title\r\n    if (update.title) {\r\n      result.cleanedTitle = update.title\r\n        .replace(/\\s+/g, ' ') // Normalize whitespace\r\n        .replace(/[^\\w\\s\\-\\(\\):\\.,]/g, '') // Remove special characters\r\n        .trim();\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Generate data quality report\r\n   */\r\n  async generateQualityReport(updates: any[]): Promise<any> {\r\n    console.log(`[Quality] Generating quality report for ${updates.length} updates`);\r\n    \r\n    const validationResults = updates.map(update => ({\r\n      id: update.id,\r\n      ...this.validateUpdate(update)\r\n    }));\r\n\r\n    const duplicates = await this.findDuplicates(updates);\r\n    \r\n    const totalScore = validationResults.reduce((sum, result) => sum + result.score, 0);\r\n    const averageScore = updates.length > 0 ? totalScore / updates.length : 0;\r\n    \r\n    const qualityMetrics = {\r\n      totalUpdates: updates.length,\r\n      validUpdates: validationResults.filter(r => r.isValid).length,\r\n      averageQualityScore: Math.round(averageScore * 100) / 100,\r\n      totalErrors: validationResults.reduce((sum, r) => sum + r.errors.length, 0),\r\n      totalWarnings: validationResults.reduce((sum, r) => sum + r.warnings.length, 0),\r\n      duplicateCount: duplicates.length,\r\n      duplicateGroups: this.groupDuplicates(duplicates)\r\n    };\r\n\r\n    const recommendations = this.generateRecommendations(qualityMetrics, validationResults);\r\n\r\n    return {\r\n      metrics: qualityMetrics,\r\n      validationResults: validationResults.slice(0, 50), // Limit for performance\r\n      duplicates: duplicates.slice(0, 100),\r\n      recommendations,\r\n      generatedAt: new Date().toISOString()\r\n    };\r\n  }\r\n\r\n  private groupDuplicates(duplicates: DuplicateMatch[]): any[] {\r\n    const groups: Record<string, DuplicateMatch[]> = {};\r\n    \r\n    duplicates.forEach(dup => {\r\n      const key = dup.title.toLowerCase().slice(0, 50);\r\n      if (!groups[key]) groups[key] = [];\r\n      groups[key].push(dup);\r\n    });\r\n\r\n    return Object.values(groups).filter(group => group.length > 1);\r\n  }\r\n\r\n  private generateRecommendations(metrics: any, validationResults: any[]): string[] {\r\n    const recommendations: string[] = [];\r\n\r\n    if (metrics.averageQualityScore < 70) {\r\n      recommendations.push('Overall data quality is below acceptable threshold. Review data collection processes.');\r\n    }\r\n\r\n    if (metrics.duplicateCount > metrics.totalUpdates * 0.1) {\r\n      recommendations.push('High number of duplicates detected. Implement better deduplication strategies.');\r\n    }\r\n\r\n    if (metrics.totalErrors > 0) {\r\n      recommendations.push(`${metrics.totalErrors} validation errors found. Address critical data issues.`);\r\n    }\r\n\r\n    const lowQualityCount = validationResults.filter(r => r.score < 60).length;\r\n    if (lowQualityCount > 0) {\r\n      recommendations.push(`${lowQualityCount} updates have low quality scores. Review and improve data sources.`);\r\n    }\r\n\r\n    if (metrics.validUpdates / metrics.totalUpdates < 0.95) {\r\n      recommendations.push('Less than 95% of updates are valid. Strengthen validation at data ingestion.');\r\n    }\r\n\r\n    return recommendations;\r\n  }\r\n\r\n  /**\r\n   * Clean and standardize a batch of updates\r\n   */\r\n  async cleanBatchData(updates: any[]): Promise<any[]> {\r\n    console.log(`[Quality] Cleaning batch of ${updates.length} updates`);\r\n    \r\n    return updates.map(update => {\r\n      const standardization = this.standardizeData(update);\r\n      const validation = this.validateUpdate(update);\r\n      \r\n      return {\r\n        ...update,\r\n        // Apply standardizations\r\n        region: standardization.countryCode || update.region,\r\n        published_at: standardization.normalizedDate || update.published_at,\r\n        type: standardization.standardizedCategory || update.type,\r\n        title: standardization.cleanedTitle || update.title,\r\n        // Add quality metadata\r\n        _quality: {\r\n          score: validation.score,\r\n          isValid: validation.isValid,\r\n          hasWarnings: validation.warnings.length > 0,\r\n          lastCleaned: new Date().toISOString()\r\n        }\r\n      };\r\n    });\r\n  }\r\n}"]}