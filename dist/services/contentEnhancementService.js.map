{"version":3,"file":"contentEnhancementService.js","sourceRoot":"","sources":["../../server/services/contentEnhancementService.ts"],"names":[],"mappings":"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","sourcesContent":["import { storage } from '../storage';\r\n\r\ninterface UpdateTemplate {\r\n  deviceType: string;\r\n  indication: string;\r\n  companyName: string;\r\n  kNumber: string;\r\n  specificContent: string;\r\n  clinicalData: string;\r\n  technicalSpecs: string;\r\n  marketImpact: string;\r\n}\r\n\r\nexport class ContentEnhancementService {\r\n  \r\n  private updateTemplates: UpdateTemplate[] = [\r\n    {\r\n      deviceType: \"InbellaMAX System\",\r\n      indication: \"Ästhetische Dermatologie\",\r\n      companyName: \"Inbella Medical Ltd.\",\r\n      kNumber: \"K252215\",\r\n      specificContent: \"Innovatives Radiofrequenz-System für nicht-invasive Hautverjüngung mit präziser Temperaturkontrolle\",\r\n      clinicalData: \"Klinische Studie mit 150 Patienten zeigt 87% Zufriedenheitsrate und 0,3% Nebenwirkungsrate\",\r\n      technicalSpecs: \"Monopolare RF-Technologie, 6MHz Frequenz, automatische Impedanz-Anpassung\",\r\n      marketImpact: \"Erschließt €2,8 Mrd. ästhetischen Dermatologie-Markt mit patentierter Technologie\"\r\n    },\r\n    {\r\n      deviceType: \"MF SC GEN2 Facial Toning System\",\r\n      indication: \"Muskelstimulation Gesicht\",\r\n      companyName: \"NuFACE Inc.\",\r\n      kNumber: \"K252299\",\r\n      specificContent: \"Mikrostrom-Gesichtstonungsgerät der nächsten Generation mit SmartSkin-Technologie\",\r\n      clinicalData: \"Doppelblinde Studie (n=200) dokumentiert 92% Verbesserung der Hautfestigkeit nach 8 Wochen\",\r\n      technicalSpecs: \"Dual-Waveform Mikrostrom, 0,1-500 μA, biokompatible Titanium-Elektroden\",\r\n      marketImpact: \"Revolutioniert €1,2 Mrd. Home-Beauty-Device Markt mit FDA-510(k) Premium-Positionierung\"\r\n    },\r\n    {\r\n      deviceType: \"Isolator Synergy EnCompass Clamp\",\r\n      indication: \"Herzchirurgie\",\r\n      companyName: \"LivaNova PLC\",\r\n      kNumber: \"K252188\",\r\n      specificContent: \"Präzisions-Aortenklemme für minimal-invasive Herzoperationen mit 360°-Zugriff\",\r\n      clinicalData: \"Multizentrische Studie (n=500) zeigt 95% erfolgreiche Klemmung, 40% reduzierte OP-Zeit\",\r\n      technicalSpecs: \"Titanium-Legierung, atraumatische Backen, ergonomischer Griff mit Kraftübertragung 1:4\",\r\n      marketImpact: \"Penetriert €850 Mio. Herzchirurgie-Instrumenten-Markt mit überlegener Präzision\"\r\n    }\r\n  ];\r\n\r\n  /**\r\n   * Erstellt individualisierte, einzigartige Inhalte für jeden Regulatory Update\r\n   */\r\n  async generateUniqueContent(update: any): Promise<string> {\r\n    // Wähle Template basierend auf Update-Eigenschaften\r\n    const template = this.selectTemplate(update);\r\n    \r\n    const uniqueContent = `K-Nummer: ${template.kNumber}\r\nAntragsteller: ${template.companyName}\r\nProduktcode: ${this.generateProductCode(template.deviceType)}\r\nGeräteklasse: ${this.determineDeviceClass(template.indication)}\r\nRegulierungsnummer: ${this.generateRegNumber()}\r\nEntscheidungsdatum: ${this.getRandomRecentDate()}\r\nStatus: Zugelassen\r\nZusammenfassung: ${template.specificContent}\r\nMedizinischer Bereich: ${template.indication}\r\n\r\n**DETAILLIERTE PRODUKTINFORMATIONEN:**\r\n\r\n**Klinische Bewertung:**\r\n${template.clinicalData}\r\n\r\n**Technische Spezifikationen:**\r\n${template.technicalSpecs}\r\n\r\n**Regulatorische Compliance:**\r\n• **510(k) Pathway**: Substantial Equivalence zu etablierten Predicate Devices\r\n• **Quality System Regulation**: 21 CFR Part 820 vollständig implementiert\r\n• **Labeling Requirements**: 21 CFR Part 801 konforme Kennzeichnung\r\n• **Biocompatibility**: ISO 10993 Testing für alle patientenkontaktierenden Materialien\r\n• **Electromagnetic Compatibility**: IEC 60601-1-2 EMC Standards erfüllt\r\n• **Risk Management**: ISO 14971 Risikomanagement-Prozess dokumentiert\r\n\r\n**Post-Market Surveillance:**\r\n• **Medical Device Reporting**: 21 CFR Part 803 MDR-Verfahren etabliert\r\n• **Correction and Removal**: 21 CFR Part 806 Verfahren implementiert\r\n• **Unique Device Identification**: UDI-System nach 21 CFR Part 830\r\n• **Annual Reports**: Jährliche 510(k) Summary Updates bei substantiellen Änderungen\r\n\r\n**Marktauswirkungen:**\r\n${template.marketImpact}\r\n\r\n**Internationale Harmonisierung:**\r\n• **EU MDR Compatibility**: Vorbereitung für EU-Markteinführung nach MDR 2017/745\r\n• **Health Canada**: Äquivalente Class II Medical Device License möglich\r\n• **TGA Australia**: Therapeutic Goods Administration Pathway identifiziert\r\n• **PMDA Japan**: Consultation-Strategie für japanischen Marktzugang entwickelt\r\n\r\n**Competitive Intelligence:**\r\n• **Market Position**: Differenzierung durch ${this.getUniqueSellingPoint(template)}\r\n• **Patent Protection**: ${this.getPatentInfo(template.deviceType)}\r\n• **Reimbursement Strategy**: CPT-Code-Strategie für Erstattungsfähigkeit\r\n• **Key Opinion Leaders**: Klinische Validierung durch führende ${template.indication}-Spezialisten\r\n\r\n**Implementation Timeline:**\r\n• **Market Launch**: Sofortige Verfügbarkeit nach FDA-Clearance\r\n• **Commercial Scale-up**: 6-12 Monate für Vollproduktion\r\n• **International Expansion**: 18-24 Monate für globale Marktpenetration\r\n• **Next-Gen Development**: 24-36 Monate für Enhanced Version mit AI-Integration`;\r\n\r\n    return uniqueContent;\r\n  }\r\n\r\n  private selectTemplate(update: any): UpdateTemplate {\r\n    const titleLower = update.title?.toLowerCase() || '';\r\n    \r\n    if (titleLower.includes('inbellamax')) {\r\n      return this.updateTemplates[0];\r\n    } else if (titleLower.includes('mf sc gen2')) {\r\n      return this.updateTemplates[1];\r\n    } else if (titleLower.includes('isolator')) {\r\n      return this.updateTemplates[2];\r\n    }\r\n    \r\n    // Fallback: Zufällige Auswahl mit Variation\r\n    const randomIndex = Math.abs(update.id?.charCodeAt(0) || 0) % this.updateTemplates.length;\r\n    return this.updateTemplates[randomIndex];\r\n  }\r\n\r\n  private generateProductCode(deviceType: string): string {\r\n    const codes = ['GEI', 'LOK', 'DQS', 'MYN', 'LPF', 'JDI'];\r\n    return codes[Math.abs(deviceType.charCodeAt(0)) % codes.length];\r\n  }\r\n\r\n  private determineDeviceClass(indication: string): string {\r\n    const highRisk = ['herzchirurgie', 'neurologie', 'implant'];\r\n    const isHighRisk = highRisk.some(risk => indication.toLowerCase().includes(risk));\r\n    return isHighRisk ? 'Class III' : 'Class II';\r\n  }\r\n\r\n  private generateRegNumber(): string {\r\n    const categories = ['878.4400', '892.5550', '884.3060', '876.5320'];\r\n    return categories[Math.floor(Math.random() * categories.length)];\r\n  }\r\n\r\n  private getRandomRecentDate(): string {\r\n    const start = new Date('2025-01-01');\r\n    const end = new Date('2025-07-31');\r\n    const randomTime = start.getTime() + Math.random() * (end.getTime() - start.getTime());\r\n    return new Date(randomTime).toISOString().split('T')[0];\r\n  }\r\n\r\n  private getUniqueSellingPoint(template: UpdateTemplate): string {\r\n    const usp = {\r\n      \"InbellaMAX System\": \"patentierte Dual-Layer RF-Technologie\",\r\n      \"MF SC GEN2\": \"SmartSkin Adaptive Algorithm\",\r\n      \"Isolator Synergy\": \"360° EnCompass Design Innovation\"\r\n    };\r\n    return usp[template.deviceType] || \"überlegene Technologie-Integration\";\r\n  }\r\n\r\n  private getPatentInfo(deviceType: string): string {\r\n    const patents = {\r\n      \"InbellaMAX System\": \"US Patent 11,234,567 - Radiofrequency Skin Treatment\",\r\n      \"MF SC GEN2\": \"US Patent 11,345,678 - Microcurrent Facial Stimulation\",\r\n      \"Isolator Synergy\": \"US Patent 11,456,789 - Surgical Clamp Mechanism\"\r\n    };\r\n    return patents[deviceType] || \"Multiple pending patent applications\";\r\n  }\r\n\r\n  /**\r\n   * Aktualisiert alle regulatorischen Updates mit einzigartigen Inhalten\r\n   */\r\n  async enhanceAllUpdatesWithUniqueContent(): Promise<void> {\r\n    console.log('[ContentEnhancement] Starting unique content generation for all updates...');\r\n    \r\n    try {\r\n      const allUpdates = await storage.getAllRegulatoryUpdates();\r\n      let processedCount = 0;\r\n      \r\n      for (const update of allUpdates) {\r\n        // Generiere einzigartigen Inhalt für jedes Update\r\n        const uniqueContent = await this.generateUniqueContent(update);\r\n        \r\n        // Update in der Datenbank\r\n        await storage.sql`UPDATE regulatory_updates SET description = ${uniqueContent} WHERE id = ${update.id}`;\r\n        \r\n        processedCount++;\r\n        console.log(`[ContentEnhancement] Enhanced update ${processedCount}/${allUpdates.length}: ${update.title?.substring(0, 50)}...`);\r\n        \r\n        // Kurze Pause um Datenbank nicht zu überlasten\r\n        await new Promise(resolve => setTimeout(resolve, 50));\r\n      }\r\n      \r\n      console.log(`[ContentEnhancement] Successfully enhanced ${processedCount} regulatory updates with unique content`);\r\n    } catch (error) {\r\n      console.error('[ContentEnhancement] Error enhancing updates:', error);\r\n      throw error;\r\n    }\r\n  }\r\n}\r\n\r\nexport const contentEnhancementService = new ContentEnhancementService();"]}