{"version":3,"file":"nlpService.js","sourceRoot":"","sources":["../../server/services/nlpService.ts"],"names":[],"mappings":"AAmBA,MAAM,UAAU;IAAhB;QACU,oBAAe,GAAG;YACxB,WAAW,EAAE;gBACX,YAAY,EAAE,aAAa,EAAE,UAAU,EAAE,YAAY,EAAE,SAAS;gBAChE,aAAa,EAAE,YAAY,EAAE,YAAY,EAAE,gBAAgB,EAAE,cAAc;gBAC3E,YAAY,EAAE,QAAQ,EAAE,gBAAgB,EAAE,aAAa,EAAE,YAAY;gBACrE,eAAe,EAAE,eAAe,EAAE,WAAW,EAAE,UAAU,EAAE,OAAO;gBAClE,yBAAyB,EAAE,kBAAkB,EAAE,UAAU,EAAE,YAAY;gBACvE,cAAc,EAAE,mBAAmB,EAAE,gBAAgB,EAAE,YAAY;aACpE;YACD,YAAY,EAAE;gBACZ,IAAI,EAAE,CAAC,WAAW,EAAE,aAAa,EAAE,iBAAiB,EAAE,UAAU,EAAE,UAAU,EAAE,UAAU,CAAC;gBACzF,MAAM,EAAE,CAAC,UAAU,EAAE,YAAY,EAAE,YAAY,EAAE,aAAa,CAAC;gBAC/D,GAAG,EAAE,CAAC,SAAS,EAAE,cAAc,EAAE,kBAAkB,EAAE,SAAS,CAAC;aAChE;YACD,gBAAgB,EAAE;gBAChB,YAAY,EAAE,WAAW,EAAE,UAAU,EAAE,aAAa,EAAE,eAAe;gBACrE,kBAAkB,EAAE,SAAS,EAAE,YAAY,EAAE,aAAa,EAAE,eAAe;gBAC3E,YAAY,EAAE,WAAW,EAAE,gBAAgB,EAAE,oBAAoB;aAClE;YACD,eAAe,EAAE;gBACf,eAAe,EAAE,qBAAqB,EAAE,0BAA0B;gBAClE,oBAAoB,EAAE,iBAAiB,EAAE,kBAAkB;gBAC3D,oBAAoB,EAAE,uBAAuB,EAAE,wBAAwB;aACxE;SACF,CAAC;IAiQJ,CAAC;IA/PC,KAAK,CAAC,iBAAiB,CAAC,OAAe;QACrC,MAAM,iBAAiB,GAAG,OAAO,CAAC,WAAW,EAAE,CAAC;QAEhD,MAAM,UAAU,GAAa,EAAE,CAAC;QAChC,MAAM,WAAW,GAAa,EAAE,CAAC;QACjC,IAAI,SAAS,GAAG,QAAQ,CAAC;QACzB,IAAI,UAAU,GAAG,CAAC,CAAC;QACnB,IAAI,eAAe,GAAG,SAAS,CAAC;QAGhC,KAAK,MAAM,UAAU,IAAI,IAAI,CAAC,eAAe,CAAC,WAAW,EAAE,CAAC;YAC1D,IAAI,iBAAiB,CAAC,QAAQ,CAAC,UAAU,CAAC,WAAW,EAAE,CAAC,EAAE,CAAC;gBACzD,WAAW,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;gBAC7B,UAAU,IAAI,GAAG,CAAC;YACpB,CAAC;QACH,CAAC;QAGD,KAAK,MAAM,IAAI,IAAI,IAAI,CAAC,eAAe,CAAC,gBAAgB,EAAE,CAAC;YACzD,IAAI,iBAAiB,CAAC,QAAQ,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC,EAAE,CAAC;gBACnD,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;gBACtB,eAAe,GAAG,IAAI,CAAC;gBACvB,UAAU,IAAI,GAAG,CAAC;YACpB,CAAC;QACH,CAAC;QAGD,KAAK,MAAM,IAAI,IAAI,IAAI,CAAC,eAAe,CAAC,eAAe,EAAE,CAAC;YACxD,IAAI,iBAAiB,CAAC,QAAQ,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC,EAAE,CAAC;gBACnD,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;gBACtB,UAAU,IAAI,GAAG,CAAC;YACpB,CAAC;QACH,CAAC;QAGD,KAAK,MAAM,CAAC,KAAK,EAAE,QAAQ,CAAC,IAAI,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC,eAAe,CAAC,YAAY,CAAC,EAAE,CAAC;YAClF,KAAK,MAAM,OAAO,IAAI,QAAQ,EAAE,CAAC;gBAC/B,IAAI,iBAAiB,CAAC,QAAQ,CAAC,OAAO,CAAC,WAAW,EAAE,CAAC,EAAE,CAAC;oBACtD,SAAS,GAAG,KAAK,CAAC;oBAClB,UAAU,IAAI,GAAG,CAAC;oBAClB,MAAM;gBACR,CAAC;YACH,CAAC;YACD,IAAI,SAAS,KAAK,KAAK;gBAAE,MAAM;QACjC,CAAC;QAGD,IAAI,iBAAiB,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,iBAAiB,CAAC,QAAQ,CAAC,yBAAyB,CAAC,IAAI,iBAAiB,CAAC,QAAQ,CAAC,kBAAkB,CAAC,EAAE,CAAC;YAChJ,UAAU,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;YACpC,UAAU,IAAI,GAAG,CAAC;QACpB,CAAC;QAED,IAAI,iBAAiB,CAAC,QAAQ,CAAC,eAAe,CAAC,IAAI,iBAAiB,CAAC,QAAQ,CAAC,gBAAgB,CAAC,EAAE,CAAC;YAChG,UAAU,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC;YACjC,UAAU,IAAI,GAAG,CAAC;QACpB,CAAC;QAED,IAAI,iBAAiB,CAAC,QAAQ,CAAC,gBAAgB,CAAC,IAAI,iBAAiB,CAAC,QAAQ,CAAC,gBAAgB,CAAC,EAAE,CAAC;YACjG,UAAU,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;YACnC,UAAU,IAAI,GAAG,CAAC;QACpB,CAAC;QAED,IAAI,iBAAiB,CAAC,QAAQ,CAAC,QAAQ,CAAC,IAAI,iBAAiB,CAAC,QAAQ,CAAC,cAAc,CAAC,EAAE,CAAC;YACvF,UAAU,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;YAChC,UAAU,IAAI,GAAG,CAAC;QACpB,CAAC;QAED,IAAI,iBAAiB,CAAC,QAAQ,CAAC,KAAK,CAAC,IAAI,iBAAiB,CAAC,QAAQ,CAAC,2BAA2B,CAAC,EAAE,CAAC;YACjG,UAAU,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;YAClC,UAAU,IAAI,GAAG,CAAC;QACpB,CAAC;QAED,IAAI,iBAAiB,CAAC,QAAQ,CAAC,KAAK,CAAC,IAAI,iBAAiB,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,iBAAiB,CAAC,QAAQ,CAAC,KAAK,CAAC,EAAE,CAAC;YACjH,UAAU,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;YAClC,UAAU,IAAI,GAAG,CAAC;QACpB,CAAC;QAGD,IAAI,UAAU,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;YAC5B,UAAU,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;YACnC,UAAU,GAAG,GAAG,CAAC;QACnB,CAAC;QAED,IAAI,WAAW,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;YAC7B,WAAW,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;QACrC,CAAC;QAED,OAAO;YACL,UAAU,EAAE,KAAK,CAAC,IAAI,CAAC,IAAI,GAAG,CAAC,UAAU,CAAC,CAAC;YAC3C,UAAU,EAAE,IAAI,CAAC,GAAG,CAAC,UAAU,EAAE,GAAG,CAAC;YACrC,WAAW,EAAE,KAAK,CAAC,IAAI,CAAC,IAAI,GAAG,CAAC,WAAW,CAAC,CAAC;YAC7C,SAAS;YACT,eAAe;SAChB,CAAC;IACJ,CAAC;IAED,KAAK,CAAC,qBAAqB,CAAC,OAAe;QAKzC,MAAM,SAAS,GAAG,OAAO,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;QAG3E,MAAM,iBAAiB,GAAG;YACxB,UAAU,EAAE,aAAa,EAAE,UAAU,EAAE,YAAY,EAAE,UAAU,EAAE,WAAW;YAC5E,QAAQ,EAAE,QAAQ,EAAE,MAAM,EAAE,UAAU,EAAE,YAAY,EAAE,KAAK,EAAE,KAAK,EAAE,SAAS;YAC7E,KAAK,EAAE,eAAe,EAAE,yBAAyB,EAAE,kBAAkB;SACtE,CAAC;QAEF,MAAM,SAAS,GAAG,SAAS,CAAC,MAAM,CAAC,QAAQ,CAAC,EAAE;YAC5C,MAAM,aAAa,GAAG,QAAQ,CAAC,WAAW,EAAE,CAAC;YAC7C,OAAO,iBAAiB,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,aAAa,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC,CAAC;QAC5E,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;QAGf,MAAM,aAAa,GAAG,qCAAqC,CAAC;QAC5D,MAAM,QAAQ,GAAG,KAAK,CAAC,IAAI,CAAC,IAAI,GAAG,CAAC,OAAO,CAAC,KAAK,CAAC,aAAa,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC;QAGzE,MAAM,aAAa,GAAG,CAAC,UAAU,EAAE,WAAW,EAAE,YAAY,EAAE,UAAU,EAAE,UAAU,EAAE,cAAc,EAAE,YAAY,CAAC,CAAC;QACpH,MAAM,aAAa,GAAG,CAAC,QAAQ,EAAE,WAAW,EAAE,SAAS,EAAE,QAAQ,EAAE,UAAU,EAAE,MAAM,EAAE,SAAS,EAAE,WAAW,CAAC,CAAC;QAE/G,MAAM,YAAY,GAAG,OAAO,CAAC,WAAW,EAAE,CAAC;QAC3C,MAAM,aAAa,GAAG,aAAa,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE,CAAC,YAAY,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,MAAM,CAAC;QACvF,MAAM,aAAa,GAAG,aAAa,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE,CAAC,YAAY,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,MAAM,CAAC;QAEvF,IAAI,SAAS,GAAwC,SAAS,CAAC;QAC/D,IAAI,aAAa,GAAG,aAAa;YAAE,SAAS,GAAG,UAAU,CAAC;aACrD,IAAI,aAAa,GAAG,aAAa;YAAE,SAAS,GAAG,UAAU,CAAC;QAE/D,OAAO;YACL,SAAS;YACT,QAAQ,EAAE,QAAQ,CAAC,KAAK,CAAC,CAAC,EAAE,EAAE,CAAC;YAC/B,SAAS;SACV,CAAC;IACJ,CAAC;IAED,KAAK,CAAC,eAAe,CAAC,OAAe,EAAE,YAAoB,GAAG;QAC5D,MAAM,SAAS,GAAG,OAAO,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;QAE3E,IAAI,SAAS,CAAC,MAAM,IAAI,CAAC,EAAE,CAAC;YAC1B,OAAO,OAAO,CAAC,SAAS,CAAC,CAAC,EAAE,SAAS,CAAC,CAAC;QACzC,CAAC;QAGD,MAAM,eAAe,GAAG,SAAS,CAAC,GAAG,CAAC,CAAC,QAAQ,EAAE,KAAK,EAAE,EAAE;YACxD,IAAI,KAAK,GAAG,CAAC,CAAC;YAGd,IAAI,KAAK,GAAG,CAAC;gBAAE,KAAK,IAAI,CAAC,CAAC;YAG1B,MAAM,QAAQ,GAAG,CAAC,UAAU,EAAE,aAAa,EAAE,UAAU,EAAE,QAAQ,EAAE,UAAU,EAAE,YAAY,EAAE,KAAK,EAAE,KAAK,EAAE,KAAK,CAAC,CAAC;YAClH,QAAQ,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE;gBACtB,IAAI,QAAQ,CAAC,WAAW,EAAE,CAAC,QAAQ,CAAC,IAAI,CAAC;oBAAE,KAAK,IAAI,CAAC,CAAC;YACxD,CAAC,CAAC,CAAC;YAGH,KAAK,IAAI,QAAQ,CAAC,MAAM,GAAG,GAAG,CAAC;YAE/B,OAAO,EAAE,QAAQ,EAAE,QAAQ,CAAC,IAAI,EAAE,EAAE,KAAK,EAAE,CAAC;QAC9C,CAAC,CAAC,CAAC;QAGH,eAAe,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,KAAK,GAAG,CAAC,CAAC,KAAK,CAAC,CAAC;QAElD,IAAI,OAAO,GAAG,EAAE,CAAC;QACjB,KAAK,MAAM,IAAI,IAAI,eAAe,EAAE,CAAC;YACnC,IAAI,OAAO,CAAC,MAAM,GAAG,IAAI,CAAC,QAAQ,CAAC,MAAM,IAAI,SAAS,EAAE,CAAC;gBACvD,OAAO,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,QAAQ,CAAC;YACnD,CAAC;iBAAM,CAAC;gBACN,MAAM;YACR,CAAC;QACH,CAAC;QAED,OAAO,OAAO,IAAI,OAAO,CAAC,SAAS,CAAC,CAAC,EAAE,SAAS,CAAC,CAAC;IACpD,CAAC;IAED,KAAK,CAAC,0BAA0B,CAAC,OAAe;QAM9C,MAAM,iBAAiB,GAAG,OAAO,CAAC,WAAW,EAAE,CAAC;QAEhD,MAAM,eAAe,GAAa,EAAE,CAAC;QACrC,MAAM,YAAY,GAAa,EAAE,CAAC;QAClC,MAAM,KAAK,GAAa,EAAE,CAAC;QAC3B,MAAM,eAAe,GAAa,EAAE,CAAC;QAGrC,MAAM,kBAAkB,GAAG;YACzB,KAAK,EAAE,CAAC,KAAK,EAAE,2BAA2B,EAAE,aAAa,CAAC;YAC1D,KAAK,EAAE,CAAC,KAAK,EAAE,MAAM,EAAE,KAAK,EAAE,SAAS,CAAC;YACxC,WAAW,EAAE,CAAC,WAAW,EAAE,oBAAoB,CAAC;YAChD,WAAW,EAAE,CAAC,WAAW,EAAE,iBAAiB,CAAC;YAC7C,WAAW,EAAE,CAAC,WAAW,EAAE,oBAAoB,CAAC;YAChD,eAAe,EAAE,CAAC,eAAe,EAAE,gBAAgB,EAAE,iBAAiB,CAAC;YACvE,qBAAqB,EAAE,CAAC,qBAAqB,EAAE,eAAe,EAAE,wBAAwB,CAAC;SAC1F,CAAC;QAEF,KAAK,MAAM,CAAC,IAAI,EAAE,QAAQ,CAAC,IAAI,MAAM,CAAC,OAAO,CAAC,kBAAkB,CAAC,EAAE,CAAC;YAClE,IAAI,QAAQ,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,iBAAiB,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC,EAAE,CAAC;gBAClE,eAAe,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAC7B,CAAC;QACH,CAAC;QAGD,IAAI,iBAAiB,CAAC,QAAQ,CAAC,qBAAqB,CAAC,EAAE,CAAC;YACtD,YAAY,CAAC,IAAI,CAAC,kCAAkC,CAAC,CAAC;QACxD,CAAC;QACD,IAAI,iBAAiB,CAAC,QAAQ,CAAC,0BAA0B,CAAC,EAAE,CAAC;YAC3D,YAAY,CAAC,IAAI,CAAC,yCAAyC,CAAC,CAAC;QAC/D,CAAC;QACD,IAAI,iBAAiB,CAAC,QAAQ,CAAC,iBAAiB,CAAC,EAAE,CAAC;YAClD,YAAY,CAAC,IAAI,CAAC,iCAAiC,CAAC,CAAC;QACvD,CAAC;QACD,IAAI,iBAAiB,CAAC,QAAQ,CAAC,eAAe,CAAC,EAAE,CAAC;YAChD,YAAY,CAAC,IAAI,CAAC,wCAAwC,CAAC,CAAC;QAC9D,CAAC;QAGD,IAAI,iBAAiB,CAAC,QAAQ,CAAC,QAAQ,CAAC,IAAI,iBAAiB,CAAC,QAAQ,CAAC,SAAS,CAAC,EAAE,CAAC;YAClF,KAAK,CAAC,IAAI,CAAC,8CAA8C,CAAC,CAAC;QAC7D,CAAC;QACD,IAAI,iBAAiB,CAAC,QAAQ,CAAC,gBAAgB,CAAC,IAAI,iBAAiB,CAAC,QAAQ,CAAC,WAAW,CAAC,EAAE,CAAC;YAC5F,KAAK,CAAC,IAAI,CAAC,sDAAsD,CAAC,CAAC;QACrE,CAAC;QACD,IAAI,iBAAiB,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,iBAAiB,CAAC,QAAQ,CAAC,kBAAkB,CAAC,EAAE,CAAC;YACvF,KAAK,CAAC,IAAI,CAAC,4CAA4C,CAAC,CAAC;QAC3D,CAAC;QAGD,IAAI,eAAe,CAAC,QAAQ,CAAC,KAAK,CAAC,EAAE,CAAC;YACpC,eAAe,CAAC,IAAI,CAAC,6CAA6C,CAAC,CAAC;QACtE,CAAC;QACD,IAAI,eAAe,CAAC,QAAQ,CAAC,KAAK,CAAC,EAAE,CAAC;YACpC,eAAe,CAAC,IAAI,CAAC,qCAAqC,CAAC,CAAC;QAC9D,CAAC;QACD,IAAI,eAAe,CAAC,QAAQ,CAAC,eAAe,CAAC,EAAE,CAAC;YAC9C,eAAe,CAAC,IAAI,CAAC,sCAAsC,CAAC,CAAC;QAC/D,CAAC;QACD,IAAI,KAAK,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC;YACrB,eAAe,CAAC,IAAI,CAAC,+BAA+B,CAAC,CAAC;QACxD,CAAC;QAED,OAAO;YACL,eAAe;YACf,YAAY;YACZ,KAAK;YACL,eAAe;SAChB,CAAC;IACJ,CAAC;CACF;AAED,MAAM,CAAC,MAAM,UAAU,GAAG,IAAI,UAAU,EAAE,CAAC","sourcesContent":["interface CategoryResult {\r\n  categories: string[];\r\n  confidence: number;\r\n  deviceTypes: string[];\r\n  riskLevel: string;\r\n  therapeuticArea: string;\r\n}\r\n\r\ninterface ExtractionResult {\r\n  keyPoints: string[];\r\n  entities: string[];\r\n  sentiment: 'positive' | 'negative' | 'neutral';\r\n}\r\n\r\ninterface SummaryOptions {\r\n  maxLength: number;\r\n  extractKeywords: boolean;\r\n}\r\n\r\nclass NLPService {\r\n  private medtechKeywords = {\r\n    deviceTypes: [\r\n      'diagnostic', 'therapeutic', 'surgical', 'monitoring', 'imaging',\r\n      'implantable', 'prosthetic', 'orthopedic', 'cardiovascular', 'neurological',\r\n      'ophthalmic', 'dental', 'dermatological', 'respiratory', 'anesthesia',\r\n      'infusion pump', 'defibrillator', 'pacemaker', 'catheter', 'stent',\r\n      'artificial intelligence', 'machine learning', 'software', 'mobile app',\r\n      'telemedicine', 'remote monitoring', 'digital health', 'ai-enabled'\r\n    ],\r\n    riskKeywords: {\r\n      high: ['class iii', 'implantable', 'life-sustaining', 'critical', 'invasive', 'surgical'],\r\n      medium: ['class ii', 'monitoring', 'diagnostic', 'therapeutic'],\r\n      low: ['class i', 'non-invasive', 'general wellness', 'fitness']\r\n    },\r\n    therapeuticAreas: [\r\n      'cardiology', 'neurology', 'oncology', 'orthopedics', 'ophthalmology',\r\n      'gastroenterology', 'urology', 'gynecology', 'dermatology', 'endocrinology',\r\n      'psychiatry', 'radiology', 'anesthesiology', 'emergency medicine'\r\n    ],\r\n    complianceTerms: [\r\n      'cybersecurity', 'clinical evaluation', 'post-market surveillance',\r\n      'quality management', 'risk management', 'biocompatibility',\r\n      'software lifecycle', 'usability engineering', 'clinical investigation'\r\n    ]\r\n  };\r\n\r\n  async categorizeContent(content: string): Promise<CategoryResult> {\r\n    const normalizedContent = content.toLowerCase();\r\n    \r\n    const categories: string[] = [];\r\n    const deviceTypes: string[] = [];\r\n    let riskLevel = 'medium';\r\n    let confidence = 0;\r\n    let therapeuticArea = 'general';\r\n\r\n    // Identify device types\r\n    for (const deviceType of this.medtechKeywords.deviceTypes) {\r\n      if (normalizedContent.includes(deviceType.toLowerCase())) {\r\n        deviceTypes.push(deviceType);\r\n        confidence += 0.1;\r\n      }\r\n    }\r\n\r\n    // Identify therapeutic areas\r\n    for (const area of this.medtechKeywords.therapeuticAreas) {\r\n      if (normalizedContent.includes(area.toLowerCase())) {\r\n        categories.push(area);\r\n        therapeuticArea = area;\r\n        confidence += 0.1;\r\n      }\r\n    }\r\n\r\n    // Identify compliance terms\r\n    for (const term of this.medtechKeywords.complianceTerms) {\r\n      if (normalizedContent.includes(term.toLowerCase())) {\r\n        categories.push(term);\r\n        confidence += 0.1;\r\n      }\r\n    }\r\n\r\n    // Determine risk level\r\n    for (const [level, keywords] of Object.entries(this.medtechKeywords.riskKeywords)) {\r\n      for (const keyword of keywords) {\r\n        if (normalizedContent.includes(keyword.toLowerCase())) {\r\n          riskLevel = level;\r\n          confidence += 0.2;\r\n          break;\r\n        }\r\n      }\r\n      if (riskLevel === level) break;\r\n    }\r\n\r\n    // Add general categories based on content analysis\r\n    if (normalizedContent.includes('ai') || normalizedContent.includes('artificial intelligence') || normalizedContent.includes('machine learning')) {\r\n      categories.push('AI/ML Technology');\r\n      confidence += 0.2;\r\n    }\r\n\r\n    if (normalizedContent.includes('cybersecurity') || normalizedContent.includes('cyber security')) {\r\n      categories.push('Cybersecurity');\r\n      confidence += 0.2;\r\n    }\r\n\r\n    if (normalizedContent.includes('clinical trial') || normalizedContent.includes('clinical study')) {\r\n      categories.push('Clinical Trials');\r\n      confidence += 0.2;\r\n    }\r\n\r\n    if (normalizedContent.includes('recall') || normalizedContent.includes('safety alert')) {\r\n      categories.push('Safety Alert');\r\n      confidence += 0.3;\r\n    }\r\n\r\n    if (normalizedContent.includes('mdr') || normalizedContent.includes('medical device regulation')) {\r\n      categories.push('MDR Compliance');\r\n      confidence += 0.2;\r\n    }\r\n\r\n    if (normalizedContent.includes('fda') || normalizedContent.includes('510k') || normalizedContent.includes('pma')) {\r\n      categories.push('FDA Regulation');\r\n      confidence += 0.2;\r\n    }\r\n\r\n    // Ensure we have at least some basic categorization\r\n    if (categories.length === 0) {\r\n      categories.push('General MedTech');\r\n      confidence = 0.5;\r\n    }\r\n\r\n    if (deviceTypes.length === 0) {\r\n      deviceTypes.push('Medical Device');\r\n    }\r\n\r\n    return {\r\n      categories: Array.from(new Set(categories)), // Remove duplicates\r\n      confidence: Math.min(confidence, 1.0),\r\n      deviceTypes: Array.from(new Set(deviceTypes)),\r\n      riskLevel,\r\n      therapeuticArea\r\n    };\r\n  }\r\n\r\n  async extractKeyInformation(content: string): Promise<{\r\n    keyPoints: string[];\r\n    entities: string[];\r\n    sentiment: 'positive' | 'negative' | 'neutral';\r\n  }> {\r\n    const sentences = content.split(/[.!?]+/).filter(s => s.trim().length > 0);\r\n    \r\n    // Extract key sentences (simple heuristic: sentences with important keywords)\r\n    const importantKeywords = [\r\n      'guidance', 'requirement', 'standard', 'compliance', 'approval', 'clearance',\r\n      'recall', 'safety', 'risk', 'clinical', 'regulatory', 'fda', 'ema', 'ce mark',\r\n      'mdr', 'cybersecurity', 'artificial intelligence', 'machine learning'\r\n    ];\r\n    \r\n    const keyPoints = sentences.filter(sentence => {\r\n      const lowerSentence = sentence.toLowerCase();\r\n      return importantKeywords.some(keyword => lowerSentence.includes(keyword));\r\n    }).slice(0, 5); // Limit to top 5 key points\r\n\r\n    // Extract entities (simplified - just find capitalized words/phrases)\r\n    const entityPattern = /\\b[A-Z][a-z]+(?:\\s+[A-Z][a-z]+)*\\b/g;\r\n    const entities = Array.from(new Set(content.match(entityPattern) || []));\r\n\r\n    // Simple sentiment analysis based on keywords\r\n    const positiveWords = ['approval', 'clearance', 'authorized', 'improved', 'enhanced', 'breakthrough', 'innovation'];\r\n    const negativeWords = ['recall', 'violation', 'warning', 'denied', 'rejected', 'risk', 'adverse', 'violation'];\r\n    \r\n    const lowerContent = content.toLowerCase();\r\n    const positiveCount = positiveWords.filter(word => lowerContent.includes(word)).length;\r\n    const negativeCount = negativeWords.filter(word => lowerContent.includes(word)).length;\r\n    \r\n    let sentiment: 'positive' | 'negative' | 'neutral' = 'neutral';\r\n    if (positiveCount > negativeCount) sentiment = 'positive';\r\n    else if (negativeCount > positiveCount) sentiment = 'negative';\r\n\r\n    return {\r\n      keyPoints,\r\n      entities: entities.slice(0, 10), // Limit to top 10 entities\r\n      sentiment\r\n    };\r\n  }\r\n\r\n  async generateSummary(content: string, maxLength: number = 200): Promise<string> {\r\n    const sentences = content.split(/[.!?]+/).filter(s => s.trim().length > 0);\r\n    \r\n    if (sentences.length <= 2) {\r\n      return content.substring(0, maxLength);\r\n    }\r\n\r\n    // Score sentences based on keyword frequency and position\r\n    const scoredSentences = sentences.map((sentence, index) => {\r\n      let score = 0;\r\n      \r\n      // First sentences are more important\r\n      if (index < 2) score += 2;\r\n      \r\n      // Sentences with key terms are more important\r\n      const keyTerms = ['guidance', 'requirement', 'approval', 'recall', 'standard', 'compliance', 'fda', 'ema', 'mdr'];\r\n      keyTerms.forEach(term => {\r\n        if (sentence.toLowerCase().includes(term)) score += 1;\r\n      });\r\n      \r\n      // Longer sentences might contain more information\r\n      score += sentence.length / 100;\r\n      \r\n      return { sentence: sentence.trim(), score };\r\n    });\r\n\r\n    // Sort by score and take top sentences\r\n    scoredSentences.sort((a, b) => b.score - a.score);\r\n    \r\n    let summary = '';\r\n    for (const item of scoredSentences) {\r\n      if (summary.length + item.sentence.length <= maxLength) {\r\n        summary += (summary ? '. ' : '') + item.sentence;\r\n      } else {\r\n        break;\r\n      }\r\n    }\r\n    \r\n    return summary || content.substring(0, maxLength);\r\n  }\r\n\r\n  async detectRegulatoryCompliance(content: string): Promise<{\r\n    complianceAreas: string[];\r\n    requirements: string[];\r\n    risks: string[];\r\n    recommendations: string[];\r\n  }> {\r\n    const normalizedContent = content.toLowerCase();\r\n    \r\n    const complianceAreas: string[] = [];\r\n    const requirements: string[] = [];\r\n    const risks: string[] = [];\r\n    const recommendations: string[] = [];\r\n\r\n    // Detect compliance areas\r\n    const compliancePatterns = {\r\n      'MDR': ['mdr', 'medical device regulation', 'eu 2017/745'],\r\n      'FDA': ['fda', '510k', 'pma', 'de novo'],\r\n      'ISO 13485': ['iso 13485', 'quality management'],\r\n      'ISO 14971': ['iso 14971', 'risk management'],\r\n      'IEC 62304': ['iec 62304', 'software lifecycle'],\r\n      'Cybersecurity': ['cybersecurity', 'cyber security', 'data protection'],\r\n      'Clinical Evaluation': ['clinical evaluation', 'clinical data', 'clinical investigation']\r\n    };\r\n\r\n    for (const [area, patterns] of Object.entries(compliancePatterns)) {\r\n      if (patterns.some(pattern => normalizedContent.includes(pattern))) {\r\n        complianceAreas.push(area);\r\n      }\r\n    }\r\n\r\n    // Detect requirements\r\n    if (normalizedContent.includes('clinical evaluation')) {\r\n      requirements.push('Klinische Bewertung erforderlich');\r\n    }\r\n    if (normalizedContent.includes('post-market surveillance')) {\r\n      requirements.push('Post-Market Surveillance implementieren');\r\n    }\r\n    if (normalizedContent.includes('risk management')) {\r\n      requirements.push('Risikomanagement nach ISO 14971');\r\n    }\r\n    if (normalizedContent.includes('cybersecurity')) {\r\n      requirements.push('Cybersecurity-Maßnahmen implementieren');\r\n    }\r\n\r\n    // Detect risks\r\n    if (normalizedContent.includes('recall') || normalizedContent.includes('warning')) {\r\n      risks.push('Sicherheitsrisiko - Überwachung erforderlich');\r\n    }\r\n    if (normalizedContent.includes('non-compliance') || normalizedContent.includes('violation')) {\r\n      risks.push('Compliance-Risiko - Sofortige Maßnahmen erforderlich');\r\n    }\r\n    if (normalizedContent.includes('ai') || normalizedContent.includes('machine learning')) {\r\n      risks.push('KI-Risiko - Spezielle Regulierung beachten');\r\n    }\r\n\r\n    // Generate recommendations\r\n    if (complianceAreas.includes('MDR')) {\r\n      recommendations.push('MDR-Compliance überprüfen und dokumentieren');\r\n    }\r\n    if (complianceAreas.includes('FDA')) {\r\n      recommendations.push('FDA-Submission-Strategie entwickeln');\r\n    }\r\n    if (complianceAreas.includes('Cybersecurity')) {\r\n      recommendations.push('Cybersecurity-Assessment durchführen');\r\n    }\r\n    if (risks.length > 0) {\r\n      recommendations.push('Risikobewertung aktualisieren');\r\n    }\r\n\r\n    return {\r\n      complianceAreas,\r\n      requirements,\r\n      risks,\r\n      recommendations\r\n    };\r\n  }\r\n}\r\n\r\nexport const nlpService = new NLPService();"]}