{"version":3,"file":"realFDAApiService.js","sourceRoot":"","sources":["../../server/services/realFDAApiService.ts"],"names":[],"mappings":"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","sourcesContent":["import { apiManagementService } from './apiManagementService';\r\nimport { storage } from '../storage';\r\nimport type { InsertRegulatoryUpdate } from '@shared/schema';\r\n\r\n/**\r\n * Echter FDA OpenFDA API Service\r\n * Implementiert die offiziellen FDA API Endpunkte\r\n * Dokumentation: https://open.fda.gov/apis/\r\n */\r\n\r\ninterface OpenFDADevice {\r\n  k_number?: string;\r\n  device_name?: string;\r\n  applicant?: string;\r\n  date_received?: string;\r\n  decision_date?: string;\r\n  decision?: string;\r\n  product_code?: string;\r\n  regulation_number?: string;\r\n  clearance_type?: string;\r\n  statement_or_summary?: string;\r\n  openfda?: {\r\n    device_name?: string[];\r\n    medical_specialty_description?: string[];\r\n    regulation_number?: string[];\r\n    device_class?: string;\r\n  };\r\n}\r\n\r\ninterface OpenFDARecall {\r\n  recall_number?: string;\r\n  reason_for_recall?: string;\r\n  status?: string;\r\n  product_description?: string;\r\n  recall_initiation_date?: string;\r\n  recalling_firm?: string;\r\n  classification?: string;\r\n  openfda?: {\r\n    device_name?: string[];\r\n    device_class?: string;\r\n    regulation_number?: string[];\r\n  };\r\n}\r\n\r\ninterface OpenFDAEnforcement {\r\n  recall_number?: string;\r\n  reason_for_recall?: string;\r\n  status?: string;\r\n  distribution_pattern?: string;\r\n  product_description?: string;\r\n  recall_initiation_date?: string;\r\n  classification?: string;\r\n  recalling_firm?: string;\r\n  city?: string;\r\n  state?: string;\r\n  country?: string;\r\n}\r\n\r\nexport class RealFDAApiService {\r\n  private readonly sourceId = 'fda_openfda';\r\n  private readonly baseEndpoints = {\r\n    devices510k: '/device/510k.json',\r\n    devicesPMA: '/device/pma.json', \r\n    devicesRecalls: '/device/recall.json',\r\n    devicesEnforcement: '/device/enforcement.json',\r\n    deviceClassification: '/device/classification.json'\r\n  };\r\n\r\n  /**\r\n   * Fetch 510(k) clearances from FDA\r\n   */\r\n  async fetch510kClearances(limit: number = 100, skip: number = 0): Promise<OpenFDADevice[]> {\r\n    try {\r\n      const endpoint = `${this.baseEndpoints.devices510k}?limit=${limit}&skip=${skip}`;\r\n      const response = await apiManagementService.callAPI(this.sourceId, endpoint);\r\n      \r\n      if (!response.success) {\r\n        console.error('[Real FDA API] 510k fetch failed:', response.error);\r\n        return [];\r\n      }\r\n\r\n      return response.data?.results || [];\r\n    } catch (error) {\r\n      console.error('[Real FDA API] 510k fetch error:', error);\r\n      return [];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Fetch PMA approvals from FDA\r\n   */\r\n  async fetchPMAApprovals(limit: number = 100, skip: number = 0): Promise<OpenFDADevice[]> {\r\n    try {\r\n      const endpoint = `${this.baseEndpoints.devicesPMA}?limit=${limit}&skip=${skip}`;\r\n      const response = await apiManagementService.callAPI(this.sourceId, endpoint);\r\n      \r\n      if (!response.success) {\r\n        console.error('[Real FDA API] PMA fetch failed:', response.error);\r\n        return [];\r\n      }\r\n\r\n      return response.data?.results || [];\r\n    } catch (error) {\r\n      console.error('[Real FDA API] PMA fetch error:', error);\r\n      return [];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Fetch device recalls from FDA\r\n   */\r\n  async fetchDeviceRecalls(limit: number = 100, skip: number = 0): Promise<OpenFDARecall[]> {\r\n    try {\r\n      const endpoint = `${this.baseEndpoints.devicesRecalls}?limit=${limit}&skip=${skip}`;\r\n      const response = await apiManagementService.callAPI(this.sourceId, endpoint);\r\n      \r\n      if (!response.success) {\r\n        console.error('[Real FDA API] Recalls fetch failed:', response.error);\r\n        return [];\r\n      }\r\n\r\n      return response.data?.results || [];\r\n    } catch (error) {\r\n      console.error('[Real FDA API] Recalls fetch error:', error);\r\n      return [];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Fetch enforcement actions from FDA\r\n   */\r\n  async fetchEnforcementActions(limit: number = 100, skip: number = 0): Promise<OpenFDAEnforcement[]> {\r\n    try {\r\n      const endpoint = `${this.baseEndpoints.devicesEnforcement}?limit=${limit}&skip=${skip}`;\r\n      const response = await apiManagementService.callAPI(this.sourceId, endpoint);\r\n      \r\n      if (!response.success) {\r\n        console.error('[Real FDA API] Enforcement fetch failed:', response.error);\r\n        return [];\r\n      }\r\n\r\n      return response.data?.results || [];\r\n    } catch (error) {\r\n      console.error('[Real FDA API] Enforcement fetch error:', error);\r\n      return [];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Search devices by specific criteria\r\n   */\r\n  async searchDevices(searchQuery: string, limit: number = 50): Promise<OpenFDADevice[]> {\r\n    try {\r\n      const encodedQuery = encodeURIComponent(searchQuery);\r\n      const endpoint = `${this.baseEndpoints.devices510k}?search=${encodedQuery}&limit=${limit}`;\r\n      const response = await apiManagementService.callAPI(this.sourceId, endpoint);\r\n      \r\n      if (!response.success) {\r\n        console.error('[Real FDA API] Device search failed:', response.error);\r\n        return [];\r\n      }\r\n\r\n      return response.data?.results || [];\r\n    } catch (error) {\r\n      console.error('[Real FDA API] Device search error:', error);\r\n      return [];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Convert FDA 510k data to Helix regulatory update format\r\n   */\r\n  private convert510kToRegulatoryUpdate(device: OpenFDADevice): InsertRegulatoryUpdate {\r\n    const deviceName = device.device_name || \r\n                      device.openfda?.device_name?.[0] || \r\n                      'Unknown Device';\r\n    \r\n    const specialty = device.openfda?.medical_specialty_description?.[0] || 'General';\r\n    \r\n    return {\r\n      title: `510(k) Clearance: ${deviceName}`,\r\n      content: this.buildDeviceContent(device),\r\n      summary: `FDA 510(k) clearance for ${deviceName} by ${device.applicant || 'Unknown'}`,\r\n      source: 'FDA OpenFDA API',\r\n      sourceUrl: `https://open.fda.gov/apis/device/510k/`,\r\n      publishedAt: device.decision_date ? new Date(device.decision_date) : new Date(),\r\n      region: 'United States',\r\n      regulatoryBody: 'FDA',\r\n      documentType: '510k_clearance',\r\n      impactLevel: 'medium',\r\n      deviceTypes: [specialty.toLowerCase().replace(/\\s+/g, '-')],\r\n      isActive: true,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Convert FDA recall data to Helix regulatory update format\r\n   */\r\n  private convertRecallToRegulatoryUpdate(recall: OpenFDARecall): InsertRegulatoryUpdate {\r\n    const deviceName = recall.product_description || \r\n                      recall.openfda?.device_name?.[0] || \r\n                      'Unknown Device';\r\n    \r\n    const classification = recall.classification || 'Unknown';\r\n    const impactLevel = classification.includes('Class I') ? 'high' : \r\n                       classification.includes('Class II') ? 'medium' : 'low';\r\n    \r\n    return {\r\n      title: `Device Recall: ${deviceName}`,\r\n      content: this.buildRecallContent(recall),\r\n      summary: `FDA device recall - ${recall.reason_for_recall || 'Reason not specified'}`,\r\n      source: 'FDA OpenFDA API',\r\n      sourceUrl: `https://open.fda.gov/apis/device/recall/`,\r\n      publishedAt: recall.recall_initiation_date ? new Date(recall.recall_initiation_date) : new Date(),\r\n      region: 'United States',\r\n      regulatoryBody: 'FDA',\r\n      documentType: 'recall',\r\n      impactLevel: impactLevel as 'low' | 'medium' | 'high',\r\n      deviceTypes: recall.openfda?.device_name?.map(name => name.toLowerCase().replace(/\\s+/g, '-')) || ['unknown'],\r\n      isActive: true,\r\n    };\r\n  }\r\n\r\n  private buildDeviceContent(device: OpenFDADevice): string {\r\n    const sections = [];\r\n    \r\n    sections.push(`**Geräteinformationen:**`);\r\n    sections.push(`- Gerätename: ${device.device_name || 'Nicht angegeben'}`);\r\n    sections.push(`- Antragsteller: ${device.applicant || 'Nicht angegeben'}`);\r\n    sections.push(`- K-Nummer: ${device.k_number || 'Nicht angegeben'}`);\r\n    sections.push(`- Produktcode: ${device.product_code || 'Nicht angegeben'}`);\r\n    \r\n    if (device.openfda) {\r\n      sections.push(`\\n**Regulatorische Details:**`);\r\n      sections.push(`- Geräteklasse: ${device.openfda.device_class || 'Nicht angegeben'}`);\r\n      sections.push(`- Medizinische Spezialisierung: ${device.openfda.medical_specialty_description?.join(', ') || 'Nicht angegeben'}`);\r\n      sections.push(`- Regulierungsnummer: ${device.openfda.regulation_number?.join(', ') || 'Nicht angegeben'}`);\r\n    }\r\n    \r\n    sections.push(`\\n**Verfahrensinformationen:**`);\r\n    sections.push(`- Entscheidungsdatum: ${device.decision_date || 'Nicht angegeben'}`);\r\n    sections.push(`- Entscheidung: ${device.decision || 'Nicht angegeben'}`);\r\n    sections.push(`- Clearance-Typ: ${device.clearance_type || 'Standard'}`);\r\n    \r\n    if (device.statement_or_summary) {\r\n      sections.push(`\\n**Zusammenfassung:**`);\r\n      sections.push(device.statement_or_summary);\r\n    }\r\n    \r\n    return sections.join('\\n');\r\n  }\r\n\r\n  private buildRecallContent(recall: OpenFDARecall): string {\r\n    const sections = [];\r\n    \r\n    sections.push(`**Rückruf-Informationen:**`);\r\n    sections.push(`- Rückruf-Nummer: ${recall.recall_number || 'Nicht angegeben'}`);\r\n    sections.push(`- Status: ${recall.status || 'Nicht angegeben'}`);\r\n    sections.push(`- Klassifizierung: ${recall.classification || 'Nicht angegeben'}`);\r\n    sections.push(`- Rückrufendes Unternehmen: ${recall.recalling_firm || 'Nicht angegeben'}`);\r\n    \r\n    sections.push(`\\n**Produktdetails:**`);\r\n    sections.push(`- Produktbeschreibung: ${recall.product_description || 'Nicht angegeben'}`);\r\n    \r\n    if (recall.openfda) {\r\n      sections.push(`- Gerätename: ${recall.openfda.device_name?.join(', ') || 'Nicht angegeben'}`);\r\n      sections.push(`- Geräteklasse: ${recall.openfda.device_class || 'Nicht angegeben'}`);\r\n    }\r\n    \r\n    sections.push(`\\n**Rückrufgrund:**`);\r\n    sections.push(recall.reason_for_recall || 'Grund nicht spezifiziert');\r\n    \r\n    sections.push(`\\n**Initiierungsdatum:**`);\r\n    sections.push(recall.recall_initiation_date || 'Nicht angegeben');\r\n    \r\n    return sections.join('\\n');\r\n  }\r\n\r\n  /**\r\n   * Sync all FDA data and store in database\r\n   */\r\n  async syncAllFDAData(): Promise<{ success: boolean; processed: number; errors: number }> {\r\n    console.log('[Real FDA API] Starting comprehensive FDA data sync...');\r\n    \r\n    let processed = 0;\r\n    let errors = 0;\r\n\r\n    try {\r\n      // Sync 510(k) clearances\r\n      console.log('[Real FDA API] Syncing 510(k) clearances...');\r\n      const devices510k = await this.fetch510kClearances(50);\r\n      for (const device of devices510k) {\r\n        try {\r\n          const update = this.convert510kToRegulatoryUpdate(device);\r\n          await storage.createRegulatoryUpdate(update);\r\n          processed++;\r\n        } catch (error) {\r\n          console.error('[Real FDA API] Error processing 510k device:', error);\r\n          errors++;\r\n        }\r\n      }\r\n\r\n      // Sync device recalls\r\n      console.log('[Real FDA API] Syncing device recalls...');\r\n      const recalls = await this.fetchDeviceRecalls(50);\r\n      for (const recall of recalls) {\r\n        try {\r\n          const update = this.convertRecallToRegulatoryUpdate(recall);\r\n          await storage.createRegulatoryUpdate(update);\r\n          processed++;\r\n        } catch (error) {\r\n          console.error('[Real FDA API] Error processing recall:', error);\r\n          errors++;\r\n        }\r\n      }\r\n\r\n      console.log(`[Real FDA API] Sync completed: ${processed} processed, ${errors} errors`);\r\n      return { success: true, processed, errors };\r\n\r\n    } catch (error) {\r\n      console.error('[Real FDA API] Sync failed:', error);\r\n      return { success: false, processed, errors: errors + 1 };\r\n    }\r\n  }\r\n}\r\n\r\nexport const realFDAApiService = new RealFDAApiService();"]}